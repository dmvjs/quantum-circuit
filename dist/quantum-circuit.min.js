var pe=(Kt,Lt)=>()=>(Lt||Kt((Lt={exports:{}}).exports,Lt),Lt.exports),me=pe((Kt,Lt)=>{/**
 * @license
 *
 * Copyright (c) 2016, Petar KorponaiÄ‡ <petar.korponaic@gmail.com>
 *
 * This source code is licensed under the MIT License, found in
 * the LICENSE.txt file in the root directory of this source tree.
 */var v=require("mathjs"),re=require("./qasm_import/QASMImport.js"),Bt=function(a,e,t){t=t||{};var n=Yt(a,t),s=JSON.parse(JSON.stringify(t));s.plusChar="+";var r=Yt(e,s);return n+r+(t.iotaChar?t.iotaChar:"i")},Yt=function(a,e){e=e||{},e.decimalPlaces&&(a=v.round(a,e.decimalPlaces));var t=a+"";e.fixedWidth&&(t=a.toFixed(e.decimalPlaces||14));var n=e.plusChar;return e.fixedWidth&&!n&&(n=" "),n&&a>=0&&(t=n+t),t},St=function(a,e){maxN=e||a+1,maxN>0&&(maxN=maxN-1),maxLen=maxN.toString(26).length;for(var t=a.toString(26);t.length<maxLen;)t="0"+t;for(var n="",s=0;s<t.length;s++){var r=t.charCodeAt(s);n+=String.fromCharCode(r<97?r+49:r+10)}return n},g=function(a){this.basicGates={id:{description:"Single qubit identity gate",matrix:[[1,0],[0,1]],params:[],drawingInfo:{connectors:["box"],label:"ID"},exportInfo:{quil:{name:"I"},cirq:{name:"I",notTfqSupported:!0},quest:{name:"compactUnitary",params:{alpha:"(Complex) { .real = 1, .imag = 0 }",beta:"(Complex) {.real = 0, .imag = 0}"}},qsharp:{name:"I"},qiskit:{name:"id"},braket:{name:"i"},aqasm:{name:"I"}}},x:{description:'Pauli X (PI rotation over X-axis) aka "NOT" gate',matrix:[[0,1],[1,0]],params:[],drawingInfo:{connectors:["box"],label:"X"},exportInfo:{quil:{name:"X"},cirq:{name:"X"},quest:{name:"pauliX"},qsharp:{name:"X"},quirk:{name:"X"},braket:{name:"x"},aqasm:{name:"X"},ionq:{names:["x","not"]}}},y:{description:"Pauli Y (PI rotation over Y-axis)",matrix:[[0,"-i"],["i",0]],params:[],drawingInfo:{connectors:["box"],label:"Y"},exportInfo:{quil:{name:"Y"},cirq:{name:"Y"},quest:{name:"pauliY"},qsharp:{name:"Y"},quirk:{name:"Y"},braket:{name:"y"},aqasm:{name:"Y"},ionq:{name:"y"}}},z:{description:"Pauli Z (PI rotation over Z-axis)",matrix:[[1,0],[0,-1]],params:[],drawingInfo:{connectors:["box"],label:"Z"},exportInfo:{quil:{name:"Z"},cirq:{name:"Z"},quest:{name:"pauliZ"},qsharp:{name:"Z"},quirk:{name:"Z"},braket:{name:"z"},aqasm:{name:"Z"},ionq:{name:"z"}}},h:{description:"Hadamard gate",matrix:[["1 / sqrt(2)","1 / sqrt(2)"],["1 / sqrt(2)","-1 / sqrt(2)"]],params:[],drawingInfo:{connectors:["box"],label:"H"},exportInfo:{quil:{name:"H"},cirq:{name:"H"},quest:{name:"hadamard"},qsharp:{name:"H"},quirk:{name:"H"},braket:{name:"h"},aqasm:{name:"H"},ionq:{name:"h"}}},srn:{description:"Square root of NOT",matrix:[["0.5+0.5i","0.5-0.5i"],["0.5-0.5i","0.5+0.5i"]],params:[],drawingInfo:{connectors:["box"],label:"&#x221A;X"},exportInfo:{quil:{name:"srn",defgate:`DEFGATE srn:
    0.5+0.5i, 0.5-0.5i
    0.5-0.5i, 0.5+0.5i`},pyquil:{name:"srn",array:"[[0.5+0.5j, 0.5-0.5j], [0.5-0.5j, 0.5+0.5j]]"},cirq:{name:"X**(1/2)"},quest:{name:"unitary",matrix:[[["0.5","0.5"],["0.5","-0.5"]],[["0.5","-0.5"],["0.5","0.5"]]]},qasm:{name:"sx"},qiskit:{name:"sx"},braket:{name:"v"},aqasm:{matrix:[["0.5+0.5i","0.5-0.5i"],["0.5-0.5i","0.5+0.5i"]],array:"[[0.5+0.5j, 0.5-0.5j], [0.5-0.5j, 0.5+0.5j]]"},ionq:{name:"v"}}},srndg:{description:"Inverse square root of NOT",matrix:[["0.5-0.5i","0.5+0.5i"],["0.5+0.5i","0.5-0.5i"]],params:[],drawingInfo:{connectors:["box"],label:"&#x221A;X&#8224;"},exportInfo:{quil:{name:"srndg",defgate:`DEFGATE srndg:
    0.5-0.5i, 0.5+0.5i
    0.5+0.5i, 0.5-0.5i`},pyquil:{name:"srndg",array:"[[0.5-0.5j, 0.5+0.5j], [0.5+0.5j, 0.5-0.5j]]"},cirq:{name:"X**(-1/2)"},quest:{name:"unitary",matrix:[[["0.5","-0.5"],["0.5","0.5"]],[["0.5","0.5"],["0.5","-0.5"]]]},qasm:{name:"sxdg"},qiskit:{name:"sxdg"},braket:{name:"vi"},aqasm:{matrix:[["0.5-0.5i","0.5+0.5i"],["0.5+0.5i","0.5-0.5i"]],array:"[[0.5-0.5j, 0.5+0.5j], [0.5+0.5j, 0.5-0.5j]]"},ionq:{name:"vi"}}},r2:{description:'PI/2 rotation over Z-axis aka "Phase PI/2"',matrix:[[1,0],[0,"exp(i * pi / 2)"]],params:[],drawingInfo:{connectors:["box"],label:"Z&#x1D6D1;/2"},exportInfo:{quil:{replacement:{name:"s"}},cirq:{replacement:{name:"s"}},quest:{name:"sGate"},qsharp:{replacement:{name:"s"}},qasm:{replacement:[{name:"s",params:{}}]},qiskit:{replacement:[{name:"s",params:{}}]},quirk:{name:"Z^\xBD"},braket:{name:"s"},aqasm:{name:"S"}}},r4:{description:'PI/4 rotation over Z-axis aka "Phase PI/4"',matrix:[[1,0],[0,"exp(i * pi / 4)"]],params:[],drawingInfo:{connectors:["box"],label:"Z&#x1D6D1;/4"},exportInfo:{quil:{replacement:{name:"t"}},cirq:{replacement:{name:"t"}},quest:{name:"tGate"},qsharp:{replacement:{name:"t"}},qasm:{replacement:[{name:"t",params:{}}]},qiskit:{replacement:[{name:"t",params:{}}]},quirk:{name:"Z^\xBC"},braket:{name:"t"},aqasm:{name:"T"}}},r8:{description:'PI/8 rotation over Z-axis aka "Phase PI/8"',matrix:[[1,0],[0,"exp(i * pi / 8)"]],params:[],drawingInfo:{connectors:["box"],label:"Z&#x1D6D1;/8"},exportInfo:{quil:{replacement:{name:"u1",params:{lambda:"pi/8"}}},cirq:{replacement:{name:"u1",params:{lambda:"pi/8"}}},quest:{name:"phaseShift",params:{theta:"M_PI/8"}},qsharp:{replacement:{name:"u1",params:{lambda:"pi/8"}}},qasm:{replacement:[{name:"u1",params:{lambda:"pi/8"}}]},qiskit:{replacement:[{name:"u1",params:{lambda:"pi/8"}}]},quirk:{name:"Z^\u215B"},braket:{name:"phaseshift",params:{theta:"pi/8"}},aqasm:{matrix:[[1,0],[0,"exp(i * pi / 8)"]],array:"[[1,0],[0,np.exp(1j * np.pi / 8)]]"}}},rx:{description:"Rotation around the X-axis by given angle",matrix:[["cos(theta / 2)","-i * sin(theta / 2)"],["-i * sin(theta / 2)","cos(theta / 2)"]],params:["theta"],drawingInfo:{connectors:["box"],label:"RX"},exportInfo:{quil:{name:"RX",params:["theta"]},cirq:{name:"rx",params:["theta"]},quest:{name:"rotateX",params:["theta"]},qsharp:{name:"Rx",params:["theta"]},braket:{name:"rx",params:["theta"]},aqasm:{name:"RX"},ionq:{name:"rx",paramsKey:"rotation"}}},ry:{description:"Rotation around the Y-axis by given angle",matrix:[["cos(theta / 2)","-1 * sin(theta / 2)"],["sin(theta / 2)","cos(theta / 2)"]],params:["theta"],drawingInfo:{connectors:["box"],label:"RY"},exportInfo:{quil:{name:"RY",params:["theta"]},cirq:{name:"ry",params:["theta"]},quest:{name:"rotateY",params:["theta"]},qsharp:{name:"Ry",params:["theta"]},braket:{name:"ry",params:["theta"]},aqasm:{name:"RY"},ionq:{name:"ry",paramsKey:"rotation"}}},rz:{description:"Rotation around the Z-axis by given angle",matrix:[["cos(phi / 2) - i * sin(phi / 2)",0],[0,"cos(phi / 2) + i * sin(phi / 2)"]],params:["phi"],drawingInfo:{connectors:["box"],label:"RZ"},exportInfo:{quil:{name:"RZ",params:["phi"]},cirq:{name:"rz",params:["theta"]},qsharp:{name:"Rz",params:["theta"]},braket:{name:"rz",params:["phi"]},aqasm:{name:"RZ"},ionq:{name:"rz",paramsKey:"rotation"}}},u1:{description:"Single-qubit rotation about the Z axis",matrix:[[1,0],[0,"exp(i * lambda)"]],params:["lambda"],drawingInfo:{connectors:["box"],label:"U1"},exportInfo:{quil:{name:"PHASE",params:["lambda"]},cirq:{name:"u1",params:["lambda"],array:"[[1, 0], [0, np.exp(1j*p_lambda)]]",notTfqSupported:!0},quest:{name:"phaseShift",params:["lambda"]},braket:{name:"phaseshift",params:["lambda"]},qiskit:{name:"p"},aqasm:{name:"PH"}}},u2:{description:"Single-qubit rotation about the X+Z axis",matrix:[["1 / sqrt(2)","-exp(i * lambda) * 1 / sqrt(2)"],["exp(i * phi) * 1 / sqrt(2)","exp(i * lambda + i * phi) * 1 / sqrt(2)"]],params:["phi","lambda"],drawingInfo:{connectors:["box"],label:"U2"},exportInfo:{quil:{name:"u2",params:["phi","lambda"],defgate:`DEFGATE u2(%phi, %lambda):
    1/SQRT(2), -1*EXP(i*%lambda)*1/SQRT(2)
    EXP(i*%phi)*1/SQRT(2), EXP(i*%lambda + i*%phi)*1/SQRT(2)`},pyquil:{name:"u2",params:["phi","lambda"],array:"[[1/quil_sqrt(2),-quil_exp(1j*p_lambda)*1/quil_sqrt(2)],[quil_exp(1j*p_phi)*1/quil_sqrt(2),quil_exp(1j*p_lambda+1j*p_phi)*1/quil_sqrt(2)]]"},cirq:{name:"u2",params:["phi","lambda"],array:"[[1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)], [np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]",notTfqSupported:!0},quest:{name:"unitary",params:["phi","lambda"],matrix:[[["1/sqrt(2)","0"],["-cos(lambda)/sqrt(2)","-sin(lambda)/sqrt(2)"]],[["cos(phi)/sqrt(2)","sin(phi)/sqrt(2)"],["cos(lambda+phi)/sqrt(2)","sin(lambda+phi)/sqrt(2)"]]]},braket:{name:"unitary",params:["phi","lambda"],array:"[[1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)], [np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]"},aqasm:{matrix:[["1 / sqrt(2)","-exp(i * lambda) * 1 / sqrt(2)"],["exp(i * phi) * 1 / sqrt(2)","exp(i * lambda + i * phi) * 1 / sqrt(2)"]],array:"[[1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)], [np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]",params:["phi","lambda"]},qiskit:{replacement:[{name:"u3",params:{theta:"pi/2",phi:"phi",lambda:"lambda"}}]}}},u3:{description:"Generic single-qubit rotation gate with 3 Euler angles",matrix:[["cos(theta/2)","-exp(i * lambda) * sin(theta / 2)"],["exp(i * phi) * sin(theta / 2)","exp(i * lambda + i * phi) * cos(theta / 2)"]],params:["theta","phi","lambda"],drawingInfo:{connectors:["box"],label:"U3"},exportInfo:{quil:{name:"u3",params:["theta","phi","lambda"],defgate:`DEFGATE u3(%theta, %phi, %lambda):
    COS(%theta/2), -1*EXP(i*%lambda)*SIN(%theta/2)
    EXP(i*%phi)*SIN(%theta/2), EXP(i*%lambda + i*%phi)*COS(%theta/2)`},pyquil:{name:"u3",params:["theta","phi","lambda"],array:"[[quil_cos(p_theta/2),-quil_exp(1j*p_lambda)*quil_sin(p_theta/2)],[quil_exp(1j*p_phi)*quil_sin(p_theta/2),quil_exp(1j*p_lambda+1j*p_phi)*quil_cos(p_theta/2)]]"},cirq:{name:"u3",params:["theta","phi","lambda"],array:"[[np.cos(p_theta/2), -np.exp(1j*p_lambda)*np.sin(p_theta/2)], [np.exp(1j*p_phi)*np.sin(p_theta/2), np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]",notTfqSupported:!0},quest:{name:"unitary",params:["theta","phi","lambda"],matrix:[[["cos(theta/2)","0"],["-cos(lambda)*sin(theta/2)","-sin(lambda)*sin(theta/2)"]],[["cos(phi)*sin(theta/2)","sin(phi)*sin(theta/2)"],["cos(lambda+phi)*cos(theta/2)","sin(lambda+phi)*cos(theta/2)"]]]},braket:{name:"unitary",params:["theta","phi","lambda"],array:"[[np.cos(p_theta/2), -np.exp(1j*p_lambda)*np.sin(p_theta/2)], [np.exp(1j*p_phi)*np.sin(p_theta/2), np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]"},qiskit:{name:"u"},aqasm:{matrix:[["cos(theta/2)","-exp(i * lambda) * sin(theta / 2)"],["exp(i * phi) * sin(theta / 2)","exp(i * lambda + i * phi) * cos(theta / 2)"]],array:"[[np.cos(p_theta/2), -np.exp(1j*p_lambda)*np.sin(p_theta/2)], [np.exp(1j*p_phi)*np.sin(p_theta/2), np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]",params:["theta","phi","lambda"]}}},s:{description:"PI/2 rotation over Z-axis (synonym for `r2`)",matrix:[[1,0],[0,"exp(i * pi / 2)"]],params:[],drawingInfo:{connectors:["box"],label:"S"},exportInfo:{quil:{name:"S"},cirq:{name:"S"},quest:{name:"sGate"},qsharp:{name:"S"},quirk:{name:"Z^\xBD"},braket:{name:"s"},aqasm:{name:"S"},ionq:{name:"s"}}},t:{description:"PI/4 rotation over Z-axis (synonym for `r4`)",matrix:[[1,0],[0,"exp(i * pi / 4)"]],params:[],drawingInfo:{connectors:["box"],label:"T"},exportInfo:{quil:{name:"T"},cirq:{name:"T"},quest:{name:"tGate"},qsharp:{name:"T"},quirk:{name:"Z^\xBC"},braket:{name:"t"},aqasm:{name:"T"},ionq:{name:"t"}}},sdg:{description:"(-PI/2) rotation over Z-axis",matrix:[[1,0],[0,"exp(-i * pi / 2)"]],params:[],drawingInfo:{connectors:["box"],label:"S&#8224;"},exportInfo:{quil:{replacement:{name:"u1",params:{lambda:"-pi/2"}}},cirq:{replacement:{name:"u1",params:{lambda:"-pi/2"}}},quest:{name:"phaseShift",params:{theta:"-M_PI/2"}},qsharp:{replacement:{name:"u1",params:{lambda:"-pi/2"}}},quirk:{name:"Z^-\xBD"},braket:{name:"si"},aqasm:{name:"S",dagger:!0},ionq:{name:"si"}}},tdg:{description:"(-PI/4) rotation over Z-axis",matrix:[[1,0],[0,"exp(-i * pi / 4)"]],params:[],drawingInfo:{connectors:["box"],label:"T&#8224;"},exportInfo:{quil:{replacement:{name:"u1",params:{lambda:"-pi/4"}}},cirq:{replacement:{name:"u1",params:{lambda:"-pi/4"}}},quest:{name:"phaseShift",params:{theta:"-M_PI/4"}},qsharp:{replacement:{name:"u1",params:{lambda:"-pi/4"}}},quirk:{name:"Z^-\xBC"},braket:{name:"ti"},aqasm:{name:"T",dagger:!0},ionq:{name:"ti"}}},gpi:{description:"GPi gate",matrix:[[0,"exp(-i*phi)"],["exp(i*phi)",0]],params:["phi"],drawingInfo:{connectors:["box"],label:"GPi"},exportInfo:{quil:{name:"gpi",params:["phi"],defgate:`DEFGATE gpi(%phi):
    0, EXP(-i * %phi)
    EXP(i * %phi), 0`},pyquil:{name:"gpi",params:["phi"],array:"[ [ 0, quil_exp(-1j*p_phi) ], [ quil_exp(1j*p_phi), 0 ] ]"},cirq:{name:"gpi"},quest:{name:"gpi",func:"TODO"},qasm:{equivalent:[{name:"u3",params:{theta:"pi",phi:"phi",lambda:"pi-phi"},wires:[0]}]},qiskit:{equivalent:[{name:"u3",params:{theta:"pi",phi:"phi",lambda:"pi-phi"},wires:[0]}]},braket:{name:"unitary",params:["phi"],array:"[ [ 0, np.exp(-1j*p_phi) ], [ np.exp(1j*p_phi), 0 ] ]"},aqasm:{matrix:[[0,"exp(-i*phi)"],["exp(i*phi)",0]],array:"[ [ 0, np.exp(-1j*p_phi) ], [ np.exp(1j*p_phi), 0 ] ]",params:["phi"]},ionq:{name:"gpi",paramsKey:"phase"}}},gpi2:{description:"GPi2 gate",matrix:[["1/sqrt(2)","(-i*exp(-i*phi))/sqrt(2)"],["(-i*exp(i*phi))/sqrt(2)","1/sqrt(2)"]],params:["phi"],drawingInfo:{connectors:["box"],label:"GPi2"},exportInfo:{quil:{name:"gpi2",params:["phi"],defgate:`DEFGATE gpi2(%phi):
    1/SQRT(2), (-i*EXP(-i * %phi)) / SQRT(2)
    (-i*EXP(i * %phi)) / SQRT(2), 1/SQRT(2)`},pyquil:{name:"gpi2",params:["phi"],array:"[ [ 1/quil_sqrt(2), (-1j*quil_exp(-1j*p_phi))/quil_sqrt(2) ], [ (-1j*quil_exp(1j*p_phi))/quil_sqrt(2), 1/quil_sqrt(2) ] ]"},cirq:{name:"gpi2"},quest:{name:"gpi2",func:"TODO"},qasm:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"phi-(pi/2)",lambda:"(pi/2)-phi"},wires:[0]}]},qiskit:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"phi-(pi/2)",lambda:"(pi/2)-phi"},wires:[0]}]},braket:{name:"unitary",params:["phi"],array:"[ [ 1/np.sqrt(2), (-1j*np.exp(-1j*p_phi))/np.sqrt(2) ], [ (-1j*np.exp(1j*p_phi))/np.sqrt(2), 1/np.sqrt(2) ] ]"},aqasm:{matrix:[["1/sqrt(2)","(-i*exp(-i*phi))/sqrt(2)"],["(-i*exp(i*phi))/sqrt(2)","1/sqrt(2)"]],array:"[ [ 1/np.sqrt(2), (-1j*np.exp(-1j*p_phi))/np.sqrt(2) ], [ (-1j*np.exp(1j*p_phi))/np.sqrt(2), 1/np.sqrt(2) ] ]",params:["phi"]},ionq:{name:"gpi2",paramsKey:"phase"}}},vz:{description:"VirtualZ gate",matrix:[["exp(-i*theta/2)",0],[0,"exp(i*theta/2)"]],params:["theta"],drawingInfo:{connectors:["box"],label:"VrtZ"},exportInfo:{quil:{name:"vz",params:["theta"],defgate:`DEFGATE vz(%theta):
    EXP(-i * %theta/2), 0
    0, EXP(-i * %theta/2)`},pyquil:{name:"vz",params:["theta"],array:"[ [ quil_exp(-1j*p_theta/2), 0 ], [ 0, quil_exp(1j*p_theta/2) ] ]"},cirq:{name:"vz"},quest:{name:"vz",func:"TODO"},qasm:{equivalent:[{name:"rz",params:{phi:"theta"},wires:[0]}]},qiskit:{equivalent:[{name:"rz",params:{phi:"theta"},wires:[0]}]},braket:{name:"unitary",params:["theta"],array:"[ [ np.exp(-1j*p_theta/2), 0 ], [ 0, np.exp(1j*p_theta/2) ] ]"},aqasm:{matrix:[["exp(-i*theta/2)",0],[0,"exp(i*theta/2)"]],array:"[ [ np.exp(-1j*p_theta/2), 0 ], [ 0, np.exp(1j*p_theta/2) ] ]",params:["theta"]},ionq:{name:"vz",paramsKey:"phase"}}},cx:{description:"Controlled NOT (CNOT) gate",matrix:[[1,0,0,0],[0,1,0,0],[0,0,0,1],[0,0,1,0]],numTargetQubits:1,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","not"],label:"X",root:"x"},exportInfo:{quil:{name:"CNOT"},cirq:{name:"CNOT"},quest:{name:"controlledNot"},qsharp:{name:"CNOT"},quirk:{name:"X",controlled:!0},braket:{name:"cnot"},aqasm:{name:"CNOT"},ionq:{name:"cnot"}}},cy:{description:"Controlled Y gate (controlled rotation over Y-axis by PI)",matrix:[[1,0,0,0],[0,1,0,0],[0,0,0,"-i"],[0,0,"i",0]],numTargetQubits:1,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","box"],label:"Y",root:"y"},exportInfo:{quest:{name:"controlledPauliY"},cirq:{replacement:{name:"y",type:"controlled",notTfqSupported:!0}},quil:{name:"cy",defgate:`DEFGATE cy:
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, 0, -i
    0, 0, i, 0`},pyquil:{name:"cy",array:"[[1,0,0,0],[0,1,0,0],[0,0,0,-1j],[0,0,1j,0]]"},qsharp:{name:"Controlled Y"},quirk:{name:"Y",controlled:!0},braket:{name:"cy"},aqasm:{name:"Y",controlled:!0}}},cz:{description:"Controlled Z gate (controlled rotation over Z-axis by PI)",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,-1]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","dot"],label:"Z",root:"z"},exportInfo:{quil:{name:"CZ"},cirq:{name:"CZ"},quest:{name:"controlledPhaseFlip"},qsharp:{name:"Controlled Z"},quirk:{name:"Z",controlled:!0},braket:{name:"cz"},aqasm:{name:"CSIGN"}}},ch:{description:"Controlled Hadamard gate",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"1 / sqrt(2)","1 / sqrt(2)"],[0,0,"1 / sqrt(2)","-1 / sqrt(2)"]],numTargetQubits:1,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","box"],label:"H",root:"h"},exportInfo:{quest:{name:"controlledUnitary",matrix:[[["1/sqrt(2)","0"],["1/sqrt(2)","0"]],[["1/sqrt(2)","0"],["-1/sqrt(2)","0"]]]},cirq:{replacement:{name:"h",type:"controlled",notTfqSupported:!0}},quil:{name:"ch",defgate:`DEFGATE ch:
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, 0.7071067811865475, 0.7071067811865475
    0, 0, 0.7071067811865475, -0.7071067811865475`},pyquil:{name:"ch",array:"[[1,0,0,0],[0,1,0,0],[0,0,1/np.sqrt(2),1/np.sqrt(2)],[0,0,1/np.sqrt(2),-1/np.sqrt(2)]]"},qsharp:{name:"Controlled H"},quirk:{name:"H",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0,0,1/np.sqrt(2),1/np.sqrt(2)],[0,0,1/np.sqrt(2),-1/np.sqrt(2)]]"},aqasm:{name:"H",controlled:!0}}},csrn:{description:"Controlled square root of NOT",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"0.5+0.5i","0.5-0.5i"],[0,0,"0.5-0.5i","0.5+0.5i"]],numTargetQubits:1,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","box"],label:"&#x221A;X",root:"srn"},exportInfo:{quest:{name:"controlledUnitary",matrix:[[["-1/sqrt(2)","0"],["-1/sqrt(2)","0"]],[["-1/sqrt(2)","0"],["1/sqrt(2)","0"]]]},cirq:{replacement:{name:"srn",type:"controlled",notTfqSupported:!0}},quil:{name:"csrn",defgate:`DEFGATE csrn:
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, 0.5+0.5i, 0.5-0.5i
    0, 0, 0.5-0.5i, 0.5+0.5i`},qasm:{name:"csx"},qiskit:{name:"csx"},pyquil:{name:"csrn",array:"[[1,0,0,0],[0,1,0,0],[0,0,0.5+0.5j,0.5-0.5j],[0,0,0.5-0.5j,0.5+0.5j]]"},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0,0,0.5+0.5j,0.5-0.5j],[0,0,0.5-0.5j,0.5+0.5j]]"},aqasm:{matrix:[[1,0,0,0],[0,1,0,0],[0,0,"0.5+0.5i","0.5-0.5i"],[0,0,"0.5-0.5i","0.5+0.5i"]],array:"[[1,0,0,0],[0,1,0,0],[0,0,0.5+0.5j,0.5-0.5j],[0,0,0.5-0.5j,0.5+0.5j]]"}}},swap:{description:"Swaps the state of two qubits.",matrix:[[1,0,0,0],[0,0,1,0],[0,1,0,0],[0,0,0,1]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["x","x"],label:"SWP"},exportInfo:{quil:{name:"SWAP"},cirq:{name:"SWAP"},quest:{name:"swap",func:`void swap(Qureg qubits, const int q1, const int q2) {
    controlledNot(qubits, q1, q2);
    controlledNot(qubits, q2, q1);
    controlledNot(qubits, q1, q2);
}`},qsharp:{name:"SWAP"},quirk:{name:"Swap"},braket:{name:"swap"},aqasm:{name:"SWAP"},ionq:{name:"swap"}}},srswap:{description:"Square root of swap",matrix:[[1,0,0,0],[0,"0.5 * (1 + i)","0.5 * (1 - i)",0],[0,"0.5 * (1 - i)","0.5 * (1 + i)",0],[0,0,0,1]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["box","box"],label:"&#x221A;SWP"},exportInfo:{quil:{name:"srswap",defgate:`DEFGATE srswap:
    1, 0, 0, 0
    0, 0.5+0.5i, 0.5-0.5i, 0
    0, 0.5-0.5i, 0.5+0.5i, 0
    0, 0, 0, 1`},cirq:{name:"SWAP**(1/2)"},pyquil:{name:"srswap",array:"[[1,0,0,0],[0,0.5 * (1 + 1j),0.5 * (1 - 1j),0],[0,0.5 * (1 - 1j),0.5 * (1 + 1j),0],[0,0,0,1]]"},quest:{name:"srswap",func:`void srswap(Qureg qubits, const int q1, const int q2) {
    controlledNot(qubits, q2, q1);
    rotateY(qubits, q2, M_PI/2);
    rotateZ(qubits, q2, M_PI/16);
    controlledNot(qubits, q1, q2);
    rotateZ(qubits, q1, M_PI/8);
    rotateZ(qubits, q2, -M_PI/8);
    controlledNot(qubits, q1, q2);
    rotateZ(qubits, q2, M_PI/16);
    rotateY(qubits, q2, -M_PI/2);
    controlledNot(qubits, q2, q1);
}`},qasm:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"pi/2",lambda:"-1*pi"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"pi"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/4",phi:"-1*pi/2",lambda:"-1*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"7*pi/4"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/4",phi:"-1*pi",lambda:"-1*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"pi",lambda:"pi/2"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"-3*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"pi/2",lambda:"0"},wires:[1]}]},qiskit:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"pi/2",lambda:"-1*pi"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"pi"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/4",phi:"-1*pi/2",lambda:"-1*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"7*pi/4"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/4",phi:"-1*pi",lambda:"-1*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"pi",lambda:"pi/2"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"-3*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"pi/2",lambda:"0"},wires:[1]}]},braket:{name:"unitary",array:"[[1,0,0,0],[0,0.5 * (1 + 1j),0.5 * (1 - 1j),0],[0,0.5 * (1 - 1j),0.5 * (1 + 1j),0],[0,0,0,1]]"},aqasm:{name:"SQRTSWAP"}}},iswap:{description:"Swaps the state of two qubits, applying a -i phase to q1 when it is in the 1 state and a -i phase to q2 when it is in the 0 state",matrix:[[1,0,0,0],[0,0,"0+i",0],[0,"0+i",0,0],[0,0,0,1]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["box","box"],label:"iSWP"},exportInfo:{quil:{name:"ISWAP"},cirq:{name:"ISWAP"},qasm:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"-1*pi"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"pi"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"3*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"3*pi/2",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"0"},wires:[0]},{name:"u3",params:{theta:"pi",phi:"pi/4",lambda:"-1*pi/4"},wires:[1]}]},qiskit:{equivalent:[{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"-1*pi"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"-1*pi/2",lambda:"pi"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"3*pi/2"},wires:[0]},{name:"u3",params:{theta:"pi/2",phi:"3*pi/2",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"pi/2",phi:"0",lambda:"0"},wires:[0]},{name:"u3",params:{theta:"pi",phi:"pi/4",lambda:"-1*pi/4"},wires:[1]}]},braket:{name:"iswap"},aqasm:{name:"ISWAP"}}},xx:{description:"XX gate",matrix:[["cos(theta)",0,0,"-i*sin(theta)"],[0,"cos(theta)","-i*sin(theta)",0],[0,"-i*sin(theta)","cos(theta)",0],["-i*sin(theta)",0,0,"cos(theta)"]],numTargetQubits:2,numControlQubits:0,params:["theta"],drawingInfo:{connectors:["box","box"],label:"XX"},exportInfo:{quil:{name:"xx",params:["theta"],defgate:`DEFGATE xx(%theta):
    COS(%theta), 0, 0, -i*SIN(%theta)
    0, COS(%theta), -i*SIN(%theta), 0
    0, -i*SIN(%theta), COS(%theta), 0
    -i*SIN(%theta), 0, 0, COS(%theta)`},pyquil:{name:"xx",params:["theta"],array:"[ [quil_cos(p_theta), 0, 0, -1j*quil_sin(p_theta)], [0, quil_cos(p_theta), -1j*quil_sin(p_theta), 0], [0, -1j*quil_sin(p_theta), quil_cos(p_theta), 0], [-1j*quil_sin(p_theta), 0, 0, quil_cos(p_theta)] ]"},cirq:{name:"xx"},quest:{name:"xx",func:"TODO"},qasm:{name:"rxx"},qiskit:{name:"rxx"},braket:{name:"unitary",params:["theta"],array:"[[np.cos(p_theta), 0, 0, -1j*np.sin(p_theta)], [0, np.cos(p_theta), -1j*np.sin(p_theta), 0], [0, -1j*np.sin(p_theta), np.cos(p_theta), 0], [-1j*np.sin(p_theta), 0, 0, np.cos(p_theta)] ]"},aqasm:{matrix:[["cos(theta)",0,0,"-i*sin(theta)"],[0,"cos(theta)","-i*sin(theta)",0],[0,"-i*sin(theta)","cos(theta)",0],["-i*sin(theta)",0,0,"cos(theta)"]],array:"[[np.cos(p_theta), 0, 0, -1j*np.sin(p_theta)], [0, np.cos(p_theta), -1j*np.sin(p_theta), 0], [0, -1j*np.sin(p_theta), np.cos(p_theta), 0], [-1j*np.sin(p_theta), 0, 0, np.cos(p_theta)] ]",params:["theta"]},ionq:{name:"xx",paramsKey:"phase"}}},yy:{description:"YY gate",matrix:[["cos(theta)",0,0,"i*sin(theta)"],[0,"cos(theta)","-i*sin(theta)",0],[0,"-i*sin(theta)","cos(theta)",0],["i*sin(theta)",0,0,"cos(theta)"]],numTargetQubits:2,numControlQubits:0,params:["theta"],drawingInfo:{connectors:["box","box"],label:"YY"},exportInfo:{quil:{name:"yy",params:["theta"],defgate:`DEFGATE yy(%theta):
    COS(%theta), 0, 0, i*SIN(%theta)
    0, COS(%theta), -i*SIN(%theta), 0
    0, -i*SIN(%theta), COS(%theta), 0
    i*SIN(%theta), 0, 0, COS(%theta)`},cirq:{name:"YY"},pyquil:{name:"yy",params:["theta"],array:"[ [quil_cos(p_theta), 0, 0, 1j*quil_sin(p_theta)], [0, quil_cos(p_theta), -1j*quil_sin(p_theta), 0], [0, -1j*quil_sin(p_theta), quil_cos(p_theta), 0], [1j*quil_sin(p_theta), 0, 0, quil_cos(p_theta)] ]"},quest:{name:"yy",func:"TODO"},braket:{name:"yy",params:["theta"]},aqasm:{matrix:[["cos(theta)",0,0,"i*sin(theta)"],[0,"cos(theta)","-i*sin(theta)",0],[0,"-i*sin(theta)","cos(theta)",0],["i*sin(theta)",0,0,"cos(theta)"]],array:"[[np.cos(p_theta), 0, 0, 1j*np.sin(p_theta)], [0, np.cos(p_theta), -1j*np.sin(p_theta), 0], [0, -1j*np.sin(p_theta), np.cos(p_theta), 0], [1j*np.sin(p_theta), 0, 0, np.cos(p_theta)] ]",params:["theta"]},qasm:{name:"ryy"},qiskit:{name:"ryy"},ionq:{name:"yy",paramsKey:"phase"}}},zz:{description:"Parametric 2-qubit rotation about ZZ",matrix:[["exp(-i * theta / 2)",0,0,0],[0,"exp(i * theta / 2)",0,0],[0,0,"exp(i * theta / 2)",0],[0,0,0,"exp(-i * theta / 2)"]],numTargetQubits:2,numControlQubits:0,params:["theta"],drawingInfo:{connectors:["box","box"],label:"ZZ"},exportInfo:{quil:{name:"zz",params:["theta"],defgate:`DEFGATE zz(%theta):
    EXP(-i * %theta / 2), 0, 0, 0
    0, EXP(i * %theta / 2), 0, 0
    0, 0, EXP(i * %theta / 2), 0
    0, 0, 0, EXP(-i * %theta / 2)`},pyquil:{name:"zz",params:["theta"],array:"[ [ quil_exp(-1j * p_theta / 2), 0, 0, 0 ], [ 0, quil_exp(1j * p_theta / 2), 0, 0], [ 0, 0, quil_exp(1j * p_theta / 2), 0 ], [ 0, 0, 0, quil_exp(-1j * p_theta / 2) ] ]"},qasm:{name:"rzz"},qiskit:{name:"rzz"},ionq:{name:"zz",paramsKey:"phase"}}},xy:{description:"XY gate",matrix:[[1,0,0,0],[0,"cos(phi / 2)","i * sin(phi / 2)",0],[0,"i * sin(phi / 2)","cos(phi / 2)",0],[0,0,0,1]],numTargetQubits:2,numControlQubits:0,params:["phi"],drawingInfo:{connectors:["box","box"],label:"XY"},exportInfo:{quil:{name:"XY",params:["phi"]},qasm:{equivalent:[{name:"rz",params:{phi:"3*pi/4"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"-3*pi/4"},wires:[1]},{name:"rx",params:{theta:"pi/2"},wires:[1]},{name:"cz",wires:[1,0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"phi/2"},wires:[0]},{name:"rx",params:{theta:"-1*pi/2"},wires:[0]},{name:"rz",params:{phi:"pi/2"},wires:[1]},{name:"rx",params:{theta:"pi/2"},wires:[1]},{name:"rz",params:{phi:"phi/2"},wires:[1]},{name:"rx",params:{theta:"-1*pi/2"},wires:[1]},{name:"cz",wires:[1,0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"pi/4"},wires:[0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[1]},{name:"rx",params:{theta:"-1*pi/2"},wires:[1]},{name:"rz",params:{phi:"3*pi/4"},wires:[1]}]},qiskit:{equivalent:[{name:"rz",params:{phi:"3*pi/4"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"-3*pi/4"},wires:[1]},{name:"rx",params:{theta:"pi/2"},wires:[1]},{name:"cz",wires:[1,0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"phi/2"},wires:[0]},{name:"rx",params:{theta:"-1*pi/2"},wires:[0]},{name:"rz",params:{phi:"pi/2"},wires:[1]},{name:"rx",params:{theta:"pi/2"},wires:[1]},{name:"rz",params:{phi:"phi/2"},wires:[1]},{name:"rx",params:{theta:"-1*pi/2"},wires:[1]},{name:"cz",wires:[1,0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[0]},{name:"rx",params:{theta:"pi/2"},wires:[0]},{name:"rz",params:{phi:"pi/4"},wires:[0]},{name:"rz",params:{phi:"-1*pi/2"},wires:[1]},{name:"rx",params:{theta:"-1*pi/2"},wires:[1]},{name:"rz",params:{phi:"3*pi/4"},wires:[1]}]},cirq:{name:"xy",params:["phi"],array:"[[1, 0, 0, 0], [0, np.cos(p_phi/2), 1j*np.sin(p_phi/2), 0], [0, 1j*np.sin(p_phi/2), np.cos(p_phi/2), 0], [0, 0, 0, 1]]",notTfqSupported:!0},braket:{name:"xy",params:["phi"]},aqasm:{matrix:[[1,0,0,0],[0,"cos(phi / 2)","i * sin(phi / 2)",0],[0,"i * sin(phi / 2)","cos(phi / 2)",0],[0,0,0,1]],array:"[[1, 0, 0, 0], [0, np.cos(p_phi/2), 1j*np.sin(p_phi/2), 0], [0, 1j*np.sin(p_phi/2), np.cos(p_phi/2), 0], [0, 0, 0, 1]]",params:["phi"]}}},ms:{description:"M\xF8lmer-S\xF8rensen gate",matrix:[["1/sqrt(2)",0,0,"(-i*exp(-i*(phi0+phi1)))/sqrt(2)"],[0,"1/sqrt(2)","(-i*exp(-i*(phi0-phi1)))/sqrt(2)",0],[0,"(-i*exp(i*(phi0-phi1)))/sqrt(2)","1/sqrt(2)",0],["(-i*exp(i*(phi0+phi1)))/sqrt(2)",0,0,"1/sqrt(2)"]],numTargetQubits:2,numControlQubits:0,params:["phi0","phi1"],drawingInfo:{connectors:["box","box"],label:"MS"},exportInfo:{quil:{name:"ms",params:["phi0","phi1"],defgate:`DEFGATE ms(%phi0, %phi1):
    1/SQRT(2), 0, 0, (-i*EXP(-i*(%phi0+%phi1)))/SQRT(2)
    0, 1/SQRT(2), (-i*EXP(-i*(%phi0-%phi1)))/SQRT(2), 0
    0, (-i*EXP(i*(%phi0-%phi1)))/SQRT(2), 1/SQRT(2), 0
    (-i*EXP(i*(%phi0+%phi1)))/SQRT(2), 0, 0, 1/SQRT(2)`},pyquil:{name:"ms",params:["phi0","phi1"],array:"[ [ 1/quil_sqrt(2), 0, 0, (-1j*quil_exp(-1j*(p_phi0+p_phi1)))/quil_sqrt(2) ], [ 0, 1/quil_sqrt(2), (-1j*quil_exp(-1j*(p_phi0-p_phi1)))/quil_sqrt(2), 0 ], [ 0, (-1j*quil_exp(1j*(p_phi0-p_phi1)))/quil_sqrt(2), 1/quil_sqrt(2), 0 ], [ (-1j*quil_exp(1j*(p_phi0+p_phi1)))/quil_sqrt(2), 0, 0, 1/quil_sqrt(2) ] ]"},cirq:{name:"ms"},quest:{name:"ms",func:"TODO"},qasm:{name:"ms"},qiskit:{name:"ms"},braket:{name:"unitary",params:["phi0","phi1"],array:"[ [ 1/np.sqrt(2), 0, 0, (-1j*np.exp(-1j*(p_phi0+p_phi1)))/np.sqrt(2) ], [ 0, 1/np.sqrt(2), (-1j*np.exp(-1j*(p_phi0-p_phi1)))/np.sqrt(2), 0 ], [ 0, (-1j*np.exp(1j*(p_phi0-p_phi1)))/np.sqrt(2), 1/np.sqrt(2), 0 ], [ (-1j*np.exp(1j*(p_phi0+p_phi1)))/np.sqrt(2), 0, 0, 1/np.sqrt(2) ] ]"},aqasm:{matrix:[["1/sqrt(2)",0,0,"(-1i*exp(-1i*(phi0+phi1)))/sqrt(2)"],[0,"1/sqrt(2)","(-1i*exp(-1i*(phi0-phi1)))/sqrt(2)",0],[0,"(-1i*exp(1i*(phi0-phi1)))/sqrt(2)","1/sqrt(2)",0],["(-1i*exp(1i*(phi0+phi1)))/sqrt(2)",0,0,"1/sqrt(2)"]],array:"[ [ 1/np.sqrt(2), 0, 0, (-1j*np.exp(-1j*(p_phi0+p_phi1)))/np.sqrt(2) ], [ 0, 1/np.sqrt(2), (-1j*np.exp(-1j*(p_phi0-p_phi1)))/np.sqrt(2), 0 ], [ 0, (-1j*np.exp(1j*(p_phi0-p_phi1)))/np.sqrt(2), 1/np.sqrt(2), 0 ], [ (-1j*np.exp(1j*(p_phi0+p_phi1)))/np.sqrt(2), 0, 0, 1/np.sqrt(2) ] ]",params:["phi0","phi1"]},ionq:{name:"ms",paramsKey:"phases"}}},cr2:{description:"Controlled PI/2 rotation over Z-axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 2)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"Z&#x1D6D1;/2",root:"r2"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},cirq:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},quest:{name:"controlledPhaseShift",params:{theta:"M_PI/2"}},qsharp:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"pi/2"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"pi/2"}}]},quirk:{name:"Z^\xBD",controlled:!0},braket:{name:"unitary",array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j * np.pi / 2)] ]"},aqasm:{name:"S",controlled:!0}}},cr4:{description:"Controlled PI/4 rotation over Z-axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 4)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"Z&#x1D6D1;/4",root:"r4"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},cirq:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},quest:{name:"controlledPhaseShift",params:{theta:"M_PI/4"}},qsharp:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"pi/4"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"pi/4"}}]},quirk:{name:"Z^\xBC",controlled:!0},braket:{name:"unitary",array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j * np.pi / 4)] ]"},aqasm:{name:"T",controlled:!0}}},cr8:{description:"Controlled PI/8 rotation over Z-axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 8)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"Z&#x1D6D1;/8",root:"r8"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"pi/8"}}},cirq:{replacement:{name:"cu1",params:{lambda:"pi/8"}}},quest:{name:"controlledPhaseShift",params:{theta:"M_PI/8"}},qsharp:{replacement:{name:"cu1",params:{lambda:"pi/8"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"pi/8"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"pi/8"}}]},quirk:{name:"Z^\u215B",controlled:!0},braket:{name:"unitary",array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j * np.pi / 8)] ]"},aqasm:{matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 8)"]],array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j * np.pi / 8)] ]"}}},crx:{description:"Controlled rotation around the X-axis by given angle",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"cos(theta / 2)","-i * sin(theta / 2)"],[0,0,"-i * sin(theta / 2)","cos(theta / 2)"]],numTargetQubits:1,numControlQubits:1,params:["theta"],drawingInfo:{connectors:["dot","box"],label:"RX",root:"rx"},exportInfo:{quil:{name:"crx",params:["theta"],defgate:`DEFGATE crx(%theta):
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, COS(%theta/2), -i*SIN(%theta/2)
    0, 0, -i*SIN(%theta/2), COS(%theta/2)`},cirq:{replacement:{name:"rx",params:{theta:"theta"},type:"controlled",notTfqSupported:!0}},pyquil:{name:"crx",params:["theta"],array:"[[ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, quil_cos(p_theta / 2), -1j*quil_sin(p_theta / 2) ], [ 0, 0, -1j*quil_sin(p_theta / 2), quil_cos(p_theta / 2) ]]"},quest:{name:"controlledUnitary",params:["theta"],matrix:[[["cos(theta/2)","0"],["0","-sin(theta/2)"]],[["0","-sin(theta/2)"],["cos(theta/2)","0"]]]},qsharp:{name:"Controlled Rx",params:["theta"]},qasm:{replacement:[{name:"cu3",params:{theta:"theta",phi:"-1*pi/2",lambda:"pi/2"}}]},qiskit:{replacement:[{name:"cu3",params:{theta:"theta",phi:"-1*pi/2",lambda:"pi/2"}}]},braket:{name:"unitary",params:["theta"],array:"[[ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, np.cos(p_theta / 2), -1j*np.sin(p_theta / 2) ], [ 0, 0, -1j*np.sin(p_theta / 2), np.cos(p_theta / 2) ]]"},aqasm:{name:"RX",controlled:!0}}},cry:{description:"Controlled rotation around the Y-axis by given angle",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"cos(theta / 2)","-1 * sin(theta / 2)"],[0,0,"sin(theta / 2)","cos(theta / 2)"]],numTargetQubits:1,numControlQubits:1,params:["theta"],drawingInfo:{connectors:["dot","box"],label:"RY",root:"ry"},exportInfo:{quil:{name:"cry",params:["theta"],defgate:`DEFGATE cry(%theta):
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, COS(%theta/2), -1*SIN(%theta/2)
    0, 0, SIN(%theta/2), COS(%theta/2)`},cirq:{replacement:{name:"ry",params:{theta:"theta"},type:"controlled",notTfqSupported:!0}},pyquil:{name:"cry",params:["theta"],array:"[[ 1, 0, 0, 0 ],[ 0, 1, 0, 0 ],[ 0, 0, quil_cos(p_theta / 2), -1*quil_sin(p_theta / 2) ],[ 0, 0, quil_sin(p_theta / 2), quil_cos(p_theta / 2) ]]"},quest:{name:"controlledUnitary",params:["theta"],matrix:[[["cos(theta/2)","0"],["-sin(theta/2)","0"]],[["sin(theta/2)","0"],["cos(theta/2)","0"]]]},qsharp:{name:"Controlled Ry",params:["theta"]},qasm:{equivalent:[{name:"u3",params:{theta:"theta/2",phi:"0",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"-1*theta / 2",phi:"0",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]}]},qiskit:{equivalent:[{name:"u3",params:{theta:"theta/2",phi:"0",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]},{name:"u3",params:{theta:"-1*theta / 2",phi:"0",lambda:"0"},wires:[1]},{name:"cx",wires:[0,1]}]},braket:{name:"unitary",params:["theta"],array:"[[ 1, 0, 0, 0 ],[ 0, 1, 0, 0 ],[ 0, 0, np.cos(p_theta / 2), -1*np.sin(p_theta / 2) ],[ 0, 0, np.sin(p_theta / 2), np.cos(p_theta / 2) ]]"},aqasm:{name:"RY",controlled:!0}}},crz:{description:"Controlled rotation around the Z-axis by given angle",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"cos(phi / 2) - i * sin(phi / 2)",0],[0,0,0,"cos(phi / 2) + i * sin(phi / 2)"]],numTargetQubits:1,numControlQubits:1,params:["phi"],drawingInfo:{connectors:["dot","dot"],label:"RZ",root:"rz"},exportInfo:{quil:{name:"crz",params:["phi"],defgate:`DEFGATE crz(%phi):
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, COS(%phi / 2) - i * SIN(%phi / 2), 0
    0, 0, 0, COS(%phi / 2) + i * SIN(%phi / 2)`},pyquil:{name:"crz",params:["phi"],array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, quil_cos(p_phi / 2) - 1j * quil_sin(p_phi / 2), 0], [0, 0, 0, quil_cos(p_phi / 2) + 1j * quil_sin(p_phi / 2)]]"},cirq:{replacement:{name:"rz",params:{phi:"phi"},type:"controlled"}},quest:{name:"controlledRotateZ",params:["theta"]},qsharp:{name:"Controlled Rz",params:["phi"]},braket:{name:"unitary",params:["phi"],array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, np.cos(p_phi / 2) - 1j * np.sin(p_phi / 2), 0], [0, 0, 0, np.cos(p_phi / 2) + 1j * np.sin(p_phi / 2)]]"},aqasm:{name:"RZ",controlled:!0}}},cu1:{description:"Controlled rotation about the Z axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * lambda)"]],numTargetQubits:2,numControlQubits:0,params:["lambda"],drawingInfo:{connectors:["dot","box"],label:"CU1",root:"u1"},exportInfo:{quil:{name:"CPHASE",params:["lambda"]},cirq:{name:"cu1",params:["lambda"],array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j*p_lambda)]]",notTfqSupported:!0},quest:{name:"controlledPhaseShift",params:["theta"]},braket:{name:"unitary",params:["lambda"],array:"[[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, np.exp(1j*p_lambda)]]"},aqasm:{name:"PH",controlled:!0},qiskit:{name:"cp"}}},cu2:{description:"Controlled rotation about the X+Z axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"1 / sqrt(2)","-exp(i * lambda) * 1 / sqrt(2)"],[0,0,"exp(i * phi) * 1 / sqrt(2)","exp(i * lambda + i * phi) * 1 / sqrt(2)"]],numTargetQubits:1,numControlQubits:1,params:["phi","lambda"],drawingInfo:{connectors:["dot","box"],label:"CU2",root:"u2"},exportInfo:{quil:{name:"cu2",params:["phi","lambda"],defgate:`DEFGATE cu2(%phi, %lambda):
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, 1/SQRT(2), -1*EXP(i*%lambda)*1/SQRT(2)
    0, 0, EXP(i*%phi)*1/SQRT(2), EXP(i*%lambda + i*%phi)*1/SQRT(2)`},pyquil:{name:"cu2",params:["phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1/quil_sqrt(2), -quil_exp(1j*p_lambda)*1/quil_sqrt(2)],[0, 0, quil_exp(1j*p_phi)*1/quil_sqrt(2), quil_exp(1j*p_lambda+1j*p_phi)*1/quil_sqrt(2)]]"},cirq:{name:"cu2",params:["phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)],[0, 0, np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]",notTfqSupported:!0},quest:{name:"controlledUnitary",params:["phi","lambda"],matrix:[[["1/sqrt(2)","0"],["-cos(lambda)/sqrt(2)","-sin(lambda)/sqrt(2)"]],[["cos(phi)/sqrt(2)","sin(phi)/sqrt(2)"],["cos(lambda+phi)/sqrt(2)","sin(lambda+phi)/sqrt(2)"]]]},qasm:{replacement:[{name:"cu3",params:{theta:"pi/2",phi:"phi",lambda:"lambda"}}]},qiskit:{replacement:[{name:"cu3",params:{theta:"pi/2",phi:"phi",lambda:"lambda"}}]},braket:{name:"unitary",params:["phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)],[0, 0, np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]"},aqasm:{matrix:[[1,0,0,0],[0,1,0,0],[0,0,"1 / sqrt(2)","-exp(i * lambda) * 1 / sqrt(2)"],[0,0,"exp(i * phi) * 1 / sqrt(2)","exp(i * lambda + i * phi) * 1 / sqrt(2)"]],array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1/np.sqrt(2), -np.exp(1j*p_lambda)*1/np.sqrt(2)],[0, 0, np.exp(1j*p_phi)*1/np.sqrt(2), np.exp(1j*p_lambda+1j*p_phi)*1/np.sqrt(2)]]",params:["phi","lambda"]}}},cu3:{description:"Controlled rotation gate with 3 Euler angles",matrix:[[1,0,0,0],[0,1,0,0],[0,0,"cos(theta/2)","-exp(i * lambda) * sin(theta / 2)"],[0,0,"exp(i * phi) * sin(theta / 2)","exp(i * lambda + i * phi) * cos(theta / 2)"]],numTargetQubits:1,numControlQubits:1,params:["theta","phi","lambda"],drawingInfo:{connectors:["dot","box"],label:"CU3",root:"u3"},exportInfo:{quil:{name:"cu3",params:["theta","phi","lambda"],defgate:`DEFGATE cu3(%theta, %phi, %lambda):
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, COS(%theta/2), -1*EXP(i*%lambda)*SIN(%theta/2)
    0, 0, EXP(i*%phi)*SIN(%theta/2), EXP(i*%lambda + i*%phi)*COS(%theta/2)`},pyquil:{name:"cu3",params:["theta","phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, quil_cos(p_theta/2),-quil_exp(1j*p_lambda)*quil_sin(p_theta/2)],[0, 0, quil_exp(1j*p_phi)*quil_sin(p_theta/2),quil_exp(1j*p_lambda+1j*p_phi)*quil_cos(p_theta/2)]]"},cirq:{name:"cu3",params:["theta","phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, np.cos(p_theta/2),-np.exp(1j*p_lambda)*np.sin(p_theta/2)],[0, 0, np.exp(1j*p_phi)*np.sin(p_theta/2),np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]",notTfqSupported:!0},quest:{name:"controlledUnitary",params:["theta","phi","lambda"],matrix:[[["cos(theta/2)","0"],["-cos(lambda)*sin(theta/2)","-sin(lambda)*sin(theta/2)"]],[["cos(phi)*sin(theta/2)","sin(phi)*sin(theta/2)"],["cos(lambda+phi)*cos(theta/2)","sin(lambda+phi)*cos(theta/2)"]]]},braket:{name:"unitary",params:["theta","phi","lambda"],array:"[[1,0,0,0],[0,1,0,0],[0, 0, np.cos(p_theta/2),-np.exp(1j*p_lambda)*np.sin(p_theta/2)],[0, 0, np.exp(1j*p_phi)*np.sin(p_theta/2),np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]"},aqasm:{matrix:[[1,0,0,0],[0,1,0,0],[0,0,"cos(theta/2)","-exp(i * lambda) * sin(theta / 2)"],[0,0,"exp(i * phi) * sin(theta / 2)","exp(i * lambda + i * phi) * cos(theta / 2)"]],array:"[[1,0,0,0],[0,1,0,0],[0, 0, np.cos(p_theta/2),-np.exp(1j*p_lambda)*np.sin(p_theta/2)],[0, 0, np.exp(1j*p_phi)*np.sin(p_theta/2),np.exp(1j*p_lambda+1j*p_phi)*np.cos(p_theta/2)]]",params:["theta","phi","lambda"]},qiskit:{name:"cu"}}},cs:{description:"Controlled PI/2 rotation over Z-axis (synonym for `cr2`)",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 2)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"S",root:"s"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},cirq:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},quest:{name:"controlledPhaseShift",params:{theta:"M_PI/2"}},qsharp:{replacement:{name:"cu1",params:{lambda:"pi/2"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"pi/2"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"pi/2"}}]},quirk:{name:"Z^\xBD",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1, 0],[0, 0, 0, np.exp(1j * np.pi / 2)]]"},aqasm:{name:"S",controlled:!0}}},ct:{description:"Controlled PI/4 rotation over Z-axis (synonym for `cr4`)",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(i * pi / 4)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"T",root:"t"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},cirq:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},quest:{name:"controlledPhaseShift",params:{theta:"M_PI/4"}},qsharp:{replacement:{name:"cu1",params:{lambda:"pi/4"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"pi/4"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"pi/4"}}]},quirk:{name:"Z^\xBC",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1, 0],[0, 0, 0, np.exp(1j * np.pi / 4)]]"},aqasm:{name:"T",controlled:!0}}},csdg:{description:"Controlled (-PI/2) rotation over Z-axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(-i * pi / 2)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"S&#8224;",root:"sdg"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"-pi/2"}}},cirq:{replacement:{name:"cu1",params:{lambda:"-pi/2"}}},quest:{name:"controlledPhaseShift",params:{theta:"-M_PI/2"}},qsharp:{replacement:{name:"cu1",params:{lambda:"-pi/2"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"-1*pi/2"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"-1*pi/2"}}]},quirk:{name:"Z^-\xBD",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1, 0],[0, 0, 0, np.exp(-1j * np.pi / 2)]]"},aqasm:{name:"S",controlled:!0,dagger:!0}}},ctdg:{description:"Controlled (-PI/4) rotation over Z-axis",matrix:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,"exp(-i * pi / 4)"]],numTargetQubits:2,numControlQubits:0,params:[],drawingInfo:{connectors:["dot","box"],label:"T&#8224;",root:"tdg"},exportInfo:{quil:{replacement:{name:"cu1",params:{lambda:"-pi/4"}}},cirq:{replacement:{name:"cu1",params:{lambda:"-pi/4"}}},quest:{name:"controlledPhaseShift",params:{theta:"-M_PI/4"}},qsharp:{replacement:{name:"cu1",params:{lambda:"-pi/4"}}},qasm:{replacement:[{name:"cu1",params:{lambda:"-1*pi/4"}}]},qiskit:{replacement:[{name:"cu1",params:{lambda:"-1*pi/4"}}]},quirk:{name:"Z^-\xBC",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0],[0,1,0,0],[0, 0, 1, 0],[0, 0, 0, np.exp(-1j * np.pi / 4)]]"},aqasm:{name:"T",controlled:!0,dagger:!0}}},ccx:{description:'Toffoli aka "CCNOT" gate',matrix:[[1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,1,0]],numTargetQubits:1,numControlQubits:2,params:[],drawingInfo:{connectors:["dot","dot","not"],label:"CCNOT",root:"x"},exportInfo:{quil:{name:"CCNOT"},cirq:{name:"CCX",notTfqSupported:!0},quest:{name:"ccx",func:`void ccx(Qureg qubits, const int q1, const int q2, const int q3) {
    hadamard(qubits, q3);
    controlledNot(qubits, q2, q3);
    phaseShift(qubits, q3, -M_PI/4);
    controlledNot(qubits, q1, q3);
    tGate(qubits, q3);
    controlledNot(qubits, q2, q3);
    phaseShift(qubits, q3, -M_PI/4);
    controlledNot(qubits, q1, q3);
    tGate(qubits, q2);
    tGate(qubits, q3);
    controlledNot(qubits, q1, q2);
    hadamard(qubits, q3);
    tGate(qubits, q1);
    phaseShift(qubits, q2, -M_PI/4);
    controlledNot(qubits, q1, q2);
}`},qsharp:{name:"CCNOT"},quirk:{name:"X",controlled:!0},braket:{name:"ccnot"},aqasm:{name:"CCNOT"}}},cswap:{description:'Controlled swap aka "Fredkin" gate',matrix:[[1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0],[0,0,0,0,0,0,1,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,1]],numTargetQubits:2,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","x","x"],label:"SWP",root:"swap"},exportInfo:{cirq:{name:"CSWAP"},quest:{name:"cswap",func:`void cswap(Qureg qubits, const int q1, const int q2, const int q3) {
    controlledNot(qubits, q3, q2);
    hadamard(qubits, q3);
    controlledNot(qubits, q2, q3);
    phaseShift(qubits, q3, -M_PI/4);
    controlledNot(qubits, q1, q3);
    tGate(qubits, q3);
    controlledNot(qubits, q2, q3);
    phaseShift(qubits, q3, -M_PI/4);
    controlledNot(qubits, q1, q3);
    tGate(qubits, q2);
    tGate(qubits, q3);
    hadamard(qubits, q3);
    controlledNot(qubits, q1, q2);
    tGate(qubits, q1);
    phaseShift(qubits, q2, -M_PI/4);
    controlledNot(qubits, q2, q3);
    controlledNot(qubits, q3, q2);
}`},qsharp:{name:"Controlled SWAP"},quil:{name:"CSWAP"},pyquil:{name:"CSWAP"},quirk:{name:"Swap",controlled:!0},braket:{name:"unitary",array:"[[1,0,0,0,0,0,0,0], [0,1,0,0,0,0,0,0], [0,0,1,0,0,0,0,0], [0,0,0,1,0,0,0,0], [0,0,0,0,1,0,0,0], [0,0,0,0,0,0,1,0], [0,0,0,0,0,1,0,0], [0,0,0,0,0,0,0,1]]"},aqasm:{name:"SWAP",controlled:!0}}},csrswap:{description:"Controlled square root of swap",matrix:[[1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0],[0,0,0,0,0,"0.5 * (1 + i)","0.5 * (1 - i)",0],[0,0,0,0,0,"0.5 * (1 - i)","0.5 * (1 + i)",0],[0,0,0,0,0,0,0,1]],numTargetQubits:2,numControlQubits:1,params:[],drawingInfo:{connectors:["dot","box","box"],label:"&#x221A;SWP",root:"srswap"},exportInfo:{quest:{name:"csrswap",func:"TODO"},cirq:{replacement:{name:"srswap",type:"controlled",notTfqSupported:!0}},quil:{name:"csrswap",defgate:`DEFGATE csrswap:
    1, 0, 0, 0, 0, 0, 0, 0
    0, 1, 0, 0, 0, 0, 0, 0
    0, 0, 1, 0, 0, 0, 0, 0
    0, 0, 0, 1, 0, 0, 0, 0
    0, 0, 0, 0, 1, 0, 0, 0
    0, 0, 0, 0, 0, 0.5+0.5i, 0.5-0.5i, 0
    0, 0, 0, 0, 0, 0.5-0.5i, 0.5+0.5i, 0
    0, 0, 0, 0, 0, 0, 0, 1`},pyquil:{name:"csrswap",array:"[[1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0],[0,0,0,0,0,0.5 * (1 + 1j),0.5 * (1 - 1j),0],[0,0,0,0,0,0.5 * (1 - 1j),0.5 * (1 + 1j),0],[0,0,0,0,0,0,0,1]]"},braket:{name:"unitary",array:"[[1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0],[0,0,0,0,0,0.5 * (1 + 1j),0.5 * (1 - 1j),0],[0,0,0,0,0,0.5 * (1 - 1j),0.5 * (1 + 1j),0],[0,0,0,0,0,0,0,1]]"},aqasm:{name:"SQRTSWAP",controlled:!0}}},reset:{description:"Resets qubit",matrix:[],params:[],drawingInfo:{connectors:["box"],label:"RST"},exportInfo:{quil:{name:"RESET"},cirq:{name:"reset",notTfqSupported:!0},quest:{name:"reset",func:"TODO"},qsharp:{name:"Reset"}}},measure:{description:"Measures qubit and stores chance (0 or 1) into classical bit",matrix:[],params:[],drawingInfo:{connectors:["gauge"],label:""},exportInfo:{quil:{name:"MEASURE"},cirq:{name:"measure"},quest:{name:"measure"},qsharp:{name:"M"}}}},this.init(a)};g.prototype.defaultHybridOptions=function(){return{optimizer:"Powell",tolerance:.001,costFunction:{python:"",javascript:""}}},g.prototype.init=function(a,e){e=e||{},this.numQubits=a||1,this.gates=[],this.partitionMap=[],this.partitionCount=0,this.partitionInfo={},this.params=[],this.options={params:{},hybrid:!1,hybridOptions:this.defaultHybridOptions()},e.keepCustomGates||(this.customGates={}),this.cregs={},this.collapsed=[],this.prob=[],this.measureResetsQubit=!1,this.reverseBitOrder=!1,this.clear()},g.prototype.clearGates=function(){this.gates=[];for(var a=0;a<this.numQubits;a++)this.gates.push([])},g.prototype.clear=function(){this.clearGates(),this.initState()},g.prototype.resetState=function(){this.state={},this.stateBits=0,this.partitionCache={};for(var a in this.cregs){var e=this.cregs[a].length||0;this.cregs[a]=[];for(var t=0;t<e;t++)this.cregs[a].push(0)}this.collapsed=[],this.prob=[],this.stats={duration:0}},g.prototype.initState=function(){this.resetState(),this.state[0]=v.complex(1,0)},g.prototype.formatComplex=function(a,e){return Bt(a.re,a.im,e)},g.prototype.multiplySquareMatrices=function(a,e){for(var t=a.length,n=t,s=t,r=t,o=[];n--;)for(o[n]=[],s=t;s--;)for(o[n][s]=0,r=t;r--;)a[n][r]&&e[r][s]&&(o[n][s]?o[n][s]=v.add(o[n][s],v.multiply(a[n][r],e[r][s])):o[n][s]=v.multiply(a[n][r],e[r][s]));return o},g.prototype.isIdentityMatrix=function(a,e){typeof e>"u"&&(e=14);for(var t=0;t<a.length;t++)for(var n=0;n<a.length;n++)if(v.round(a[t][n],e)!=(t==n?1:0))return!1;return!0},g.prototype.isUnitaryMatrix=function(a,e){return this.isIdentityMatrix(v.multiply(a,v.ctranspose(a)),e)},g.prototype.isHermitianMatrix=function(a,e){var t=this.matrixDiff(a,v.ctranspose(a));return t<=v.pow(10,-1*(e||14))},g.prototype.matrixDiff=function(a,e){for(var t=0,n=0,s=0;s<a.length;s++)for(var r=a[s],o=e[s],l=0;l<r.length;l++){var p=r[l],d=o[l],f=typeof p=="object"?p:v.complex(p),h=typeof d=="object"?d:v.complex(d),c=v.abs(v.subtract(f,h));t+=c,n++}var m=n?t/n:0;return m},g.prototype.parseMathString=function(a){var e=[],t=function(r,o){if(r.isSymbolNode){if(r.name=="j")return"i";e.indexOf(r.name)<0&&e.push(r.name)}},n=v.parse(a.replace(/[\t\n\r]/gm,"")),s=n.toString({handler:t});return{expression:s,variables:e,node:n}},g.prototype.evalMathString=function(a,e){e=e||{};var t=this.parseMathString(a),n=v.evaluate(t.expression,e);return n instanceof v.Matrix?n.toArray():n},g.prototype.parseMatrix=function(a,e){var t=this,n=null;typeof a=="string"?n=t.evalMathString(a,e):n=a;var s=[];return n.map(function(r,o){Array.isArray(r)?(s.push([]),r.map(function(l,p){typeof l=="string"?s[o].push(t.evalMathString(l,e)):s[o].push(l)})):typeof r=="string"?s.push(t.evalMathString(r,e)):s.push(r)}),s},g.prototype.matrixHasComplexElement=function(a){for(var e=0;e<a.length;e++){var t=a[e];if(t instanceof Array)for(var n=0;n<t.length;n++){var s=t[n];if(s instanceof v.Complex||typeof s=="object"&&(s.mathjs&&s.mathjs=="Complex"||s.type&&s.type=="Complex"))return!0}else if(t instanceof v.Complex||typeof t=="object"&&(t.mathjs&&t.mathjs=="Complex"||t.type&&t.type=="Complex"))return!0}return!1},g.prototype.matrixZeroImagToReal=function(a){for(var e=0;e<a.length;e++){var t=a[e];if(t instanceof Array)for(var n=0;n<t.length;n++){var s=t[n];(s instanceof v.Complex||typeof s=="object"&&(s.mathjs&&s.mathjs=="Complex"||s.type&&s.type=="Complex"))&&v.im(s)==0&&(a[e][n]=v.re(s))}else(t instanceof v.Complex||typeof t=="object"&&(t.mathjs&&t.mathjs=="Complex"||t.type&&t.type=="Complex"))&&v.im(t)==0&&(a[e]=v.re(t))}return a},g.prototype.stringifyMatrix=function(a,e){var t=this,n=a.toArray?a.toArray():a;e=e||{};var s=!1;e.fixedWidth&&(s=this.matrixHasComplexElement(n));var r="";return r+="[",n.map(function(o,l){l>0&&(r+=","),e.minify?r+=" ":r+=`
  `,o instanceof Array?(r+="[",o.map(function(p,d){d>0&&(r+=", "),p instanceof v.Complex?r+=t.formatComplex(p,e):typeof p=="object"&&(p.mathjs&&p.mathjs=="Complex"||p.type&&p.type=="Complex")?r+=Bt(p.re,p.im,e):typeof p=="string"?r+=p:s?r+=Bt(p,0,e):r+=Yt(p,e)}),r+="]"):o instanceof v.Complex?r+=t.formatComplex(o,e):typeof o=="object"&&(o.mathjs&&o.mathjs=="Complex"||o.type&&o.type=="Complex")?r+=Bt(el.re,el.im,e):typeof o=="string"?r+=o:s?r+=Bt(o,0,e):r+=Yt(o,e)}),n.length&&(e.minify?r+=" ":r+=`
`),r+="]",r},g.prototype.matrixRe=function(a){for(var e=[],t=0;t<a.length;t++){var n=a[t];if(Array.isArray(n)){for(var s=[],r=0;r<n.length;r++)typeof n[r]=="object"?s.push(n[r].re):s.push(n[r]);e.push(s)}else typeof n=="object"?s.push(n.re):s.push(n)}return e},g.prototype.matrixIm=function(a){for(var e=[],t=0;t<a.length;t++){var n=a[t];if(Array.isArray(n)){for(var s=[],r=0;r<n.length;r++)typeof n[r]=="object"?s.push(n[r].im):s.push(0);e.push(s)}else typeof n=="object"?s.push(n.im):s.push(0)}return e},g.prototype.matrixAbs=function(a){for(var e=[],t=0;t<a.length;t++){var n=a[t];if(Array.isArray(n)){for(var s=[],r=0;r<n.length;r++)s.push(v.abs(n[r]));e.push(s)}else e.push(v.abs(n))}return e},g.prototype.matrixArg=function(a){for(var e=[],t=0;t<a.length;t++){var n=a[t];if(Array.isArray(n)){for(var s=[],r=0;r<n.length;r++)s.push(v.arg(n[r]));e.push(s)}else e.push(v.arg(n))}return e},g.prototype.setCombinedState=function(a){for(var e={},t=0,n=0,s=0;s<a.length;s++){var r=a[s];r.wires.map(function(Q){Q+1>n&&(n=Q+1)})}for(var o=[],s=0;s<a.length;s++){var r=a[s],l=[];r.wires.map(function(S,j){l.push({and:1<<n-1-S,or:1<<r.circuit.numQubits-1-j})}),o.push(l)}for(var p=1<<n,d=0;d<p;d++){for(var f=null,s=0;s<a.length;s++){for(var h=o[s],c=0,m=0;m<h.length;m++)d&h[m].and&&(c|=h[m].or);var r=a[s],q=r.circuit.state[c];q?f==null?f=q:f=v.multiply(q,f):f=v.complex(0,0)}f&&(f.re||f.im)&&(e[d]=f,t|=d)}if(this.resetState(),this.numQubits<n){for(this.numQubits=n;this.gates.length<this.numQubits;)this.gates.push([]);for(var u=this.numCols(),m=0;m<this.gates.length;m++)for(;this.gates[m].length<u;)this.gates[m].push(null)}this.state=e,this.stateBits=t,this.stateBits==0&&Object.keys(this.state).length==0&&(this.state[0]=v.complex(1,0))},g.prototype._setCombinedState=function(a,e,t){t=t||{};var n=a.numQubits,s=e.numQubits;if(!t.wireMap){t.wireMap={c1:[],c2:[]};for(var r=0;r<n;r++)t.wireMap.c1.push(r);for(var r=0;r<s;r++)t.wireMap.c2.push(r+n)}var o=0;t.wireMap.c1.map(function(O){O+1>o&&(o=O+1)}),t.wireMap.c2.map(function(O){O+1>o&&(o=O+1)});var l=[];t.wireMap.c1.map(function(O,C){l.push({and:1<<o-1-O,or:1<<n-1-C})});var p=[];t.wireMap.c2.map(function(O,C){p.push({and:1<<o-1-O,or:1<<s-1-C})});for(var d=0,r=0;r<o;r++)t.wireMap.c1.indexOf(r)<0&&t.wireMap.c2.indexOf(r)<0&&(d|=1<<o-1-r);for(var f={},h=0,c=1<<o,m=0;m<c;m++)if(!(m&d)){for(var q=0,r=0;r<l.length;r++)m&l[r].and&&(q|=l[r].or);for(var u=0,r=0;r<p.length;r++)m&p[r].and&&(u|=p[r].or);var Q=a.state[q];if(Q){var _=e.state[u];if(_){var S=v.multiply(Q,_);(S.re||S.im)&&(f[m]=S,h|=m)}}}if(this.resetState(),this.numQubits<o){for(this.numQubits=o;this.gates.length<this.numQubits;)this.gates.push([]);for(var j=this.numCols(),r=0;r<this.gates.length;r++)for(;this.gates[r].length<j;)this.gates[r].push(null)}this.state=f,this.stateBits=h,this.stateBits==0&&Object.keys(this.state).length==0&&(this.state[0]=v.complex(1,0))},g.prototype.appendQubits=function(a){var e=new g(a);this._setCombinedState(this,e)},g.prototype.numAmplitudes=function(a){if(a){var e=0;for(var t in this.state){var n=v.round(this.state[t],14);(n.re||n.im)&&e++}return e}return v.pow(2,this.numQubits)},g.prototype.numCols=function(){return this.gates.length?this.gates[0].length:0},g.prototype.numGates=function(a){var e=null;a?(e=new g,e.load(this.save(!0))):e=this;for(var t=0,n=e.numCols(),s=0;s<n;s++)for(var r=0;r<e.numQubits;r++){var o=e.getGateAt(s,r);o&&o.connector==0&&t++}return t},g.prototype.isEmptyCell=function(a,e){if(this.gates[e]&&this.gates[e][a])return!1;for(var t=0;t<this.numQubits;t++){var n=this.getGateAt(a,t);if(n&&(n.name=="measure"||n.options&&n.options.condition&&n.options.condition.creg||Math.min.apply(null,n.wires)<e&&Math.max.apply(null,n.wires)>e))return!1}return!0},g.prototype.isEmptyPlace=function(a,e,t){var n=Math.min.apply(null,e),s=Math.max.apply(null,e);if(t){var r=this.numQubits-1;r>s&&(s=r)}for(var o=!0,l=n;l<=s;l++)if(!this.isEmptyCell(a,l)){o=!1;break}return o},g.prototype.lastNonEmptyPlace=function(a,e){var t=this.numCols(),n=!0,s=Math.min.apply(null,a),r=Math.max.apply(null,a);if(e){var o=this.numQubits-1;o>r&&(r=o)}for(;n&&t--;)for(var l=s;l<=r;l++)if(!this.isEmptyCell(t,l)){n=!1;break}return t},g.prototype.insertColumn=function(a){for(var e=0;e<this.numQubits;e++)this.gates[e].splice(a||0,0,null)},g.prototype.randomString=function(a){a=a||17;var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";e+=t.charAt(Math.floor(Math.random()*t.length)),t+="0123456789";for(var n=0;n<a;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},g.prototype.addGate=function(a,e,t,n){var s=[];if(Array.isArray(t))for(var r=0;r<t.length;r++)s.push(t[r]);else s.push(t);e<0&&(e=this.lastNonEmptyPlace(s,a=="measure"||n&&n.condition&&n.condition.creg)+1);for(var o=s.length,l=this.randomString(),p=0;p<o;p++){var d=s[p];for(d+1>this.numQubits&&(this.numQubits=d+1);this.gates.length<this.numQubits;)this.gates.push([]);var f=this.numCols();e+1>f&&(f=e+1);for(var r=0;r<this.gates.length;r++)for(;this.gates[r].length<f;)this.gates[r].push(null);var h={id:l,name:a,connector:p,options:{}};if(n&&(h.options=n,n.creg&&n.creg.name&&typeof n.creg.bit<"u")){var c=parseInt(n.creg.bit||0);isNaN(c)&&(c=0);var m=this.cregs[n.creg.name]||[],q=m.length>c?m[n.creg.bit]:0;this.setCregBit(n.creg.name,c,q)}this.gates[d][e]=h}return l},g.prototype.appendGate=function(a,e,t){return this.addGate(a,-1,e,t)},g.prototype.insertGate=function(a,e,t,n){var s=[];if(Array.isArray(t))for(var r=0;r<t.length;r++)s.push(t[r]);else s.push(t);e<0&&(e=this.lastNonEmptyPlace(s,!!a&&a=="measure"||n&&n.condition&&n.condition.creg)+1);for(var o=s.length,l=0;l<o;l++){var p=s[l];for(p+1>this.numQubits&&(this.numQubits=p+1);this.gates.length<this.numQubits;)this.gates.push([]);var d=this.numCols();e+1>d&&(d=e+1);for(var r=0;r<this.gates.length;r++)for(;this.gates[r].length<d;)this.gates[r].push(null)}this.isEmptyPlace(e,s,!!a&&a=="measure"||n&&n.condition&&n.condition.creg)||this.insertColumn(e);var f=null;return a&&(f=this.addGate(a,e,s,n)),f},g.prototype.insertSpace=function(a,e){return this.insertGate(null,a,e,null)},g.prototype.removeGateAt=function(a,e){if(this.gates[e]){var t=this.gates[e][a];if(t)for(var n=t.id,s=this.gates.length,r=0;r<s;r++){var o=this.gates[r][a];o&&o.id==n&&(this.gates[r][a]=null)}}},g.prototype.removeGate=function(a){var e=this.getGatePosById(a);!e||e.col<0||!e.wires.length||this.removeGateAt(e.col,e.wires[0])},g.prototype.addMeasure=function(a,e,t){this.addGate("measure",-1,a,{creg:{name:e,bit:t}})},g.prototype.appendCircuit=function(a,e){for(var t=this.numCols(),n=a.numCols(),s=0;s<n;s++)for(var r=0;r<a.numQubits;r++){var o=a.getGateAt(s,r);o&&o.connector==0&&(!this.basicGates[o.name]&&a.customGates[o.name]&&this.registerGate(o.name,a.customGates[o.name]),this.addGate(o.name,s+t,o.wires,o.options))}},g.prototype.removeTrailingColumns=function(){for(var a=this.numCols(),e=a-1;e>=0;e--){for(var t=!0,n=0;n<this.numQubits;n++){var s=this.gates[n][e];if(s){t=!1;break}}if(!t)return;for(var n=0;n<this.numQubits;n++)this.gates[n].pop()}},g.prototype.removeLeadingColumns=function(){for(var a=0,e=this.numCols(),t=0;t<e;t++){for(var n=!0,s=0;s<this.numQubits;s++){var r=this.gates[s][t];if(r){n=!1;break}}if(!n)break;a++}for(var o=0;o<a;o++)for(var s=0;s<this.numQubits;s++)this.gates[s].shift()},g.prototype.removeTrailingRows=function(){for(var a=this.numCols(),e=this.numQubits-1;e>=0;e--){for(var t=!0,n=0;n<a;n++){var s=this.gates[e][n];if(s){t=!1;break}}if(!t)return;this.gates.pop(),this.numQubits--}},g.prototype.removeQubit=function(a){if(this.gates[a]){this.resetState();for(var e=this.numCols(),t=0;t<e;t++)this.removeGateAt(t,a);for(var n=a+1;n<this.numQubits;n++)for(var t=0;t<e;t++)this.gates[n-1][t]=this.gates[n][t];this.gates.pop(),this.numQubits--}},g.prototype.flipVertically=function(){this.resetState();for(var a=this.numCols(),e=this.numQubits-1,t=0;t<this.numQubits/2;t++)for(var n=0;n<a;n++){var s=this.gates[t][n];this.gates[t][n]=this.gates[e-t][n],this.gates[e-t][n]=s}},g.prototype.flipHorizontally=function(){this.resetState();for(var a=this.numCols(),e=a-1,t=0;t<this.numQubits;t++)for(var n=0;n<a/2;n++){var s=this.gates[t][n];this.gates[t][n]=this.gates[t][e-n],this.gates[t][e-n]=s}},g.prototype.applyTransform=function(a,e){var t={},n=0;if(e=e.slice(0),this.reverseBitOrder)for(var s=0;s<e.length;s++)e[s]=this.numQubits-1-e[s];e.reverse();for(var r=[],s=0;s<this.numQubits;s++)e.indexOf(s)<0&&r.push(s);var o=r.length,l=1<<o;function p(A){var b=0;return e.map(function(L,k){A&1<<k&&(b|=1<<L)}),b}function d(){var A=0;return e.map(function(b,L){A|=1<<b}),A+1}function f(){var A=0;return r.map(function(b,L){A|=1<<b}),A}for(var h=v.complex(0,0),c=0;c<a.length;c++)for(var m=p(c),q=0;q<a[c].length;q++){var u=p(q);if((this.stateBits&u)==u){var Q=a[c][q];if(Q)for(var _=m,S=u,j=l,O=p(0),C=d(),P=f(),y=O;j--;){var x=this.state[S];x&&(_=y|m,Q==1?t[_]=v.add(t[_]||h,x):t[_]=v.add(t[_]||h,v.multiply(Q,x)),n|=_),y=y+C&P,S=y|u}}}this.state=t,this.stateBits=n,this.stateBits==0&&Object.keys(this.state).length==0&&(this.state[0]=v.complex(1,0))},g.prototype.transformMatrix=function(a,e,t,n){t=t.slice(0);var s=!1;if(n?s=n=="big":s=!this.reverseBitOrder,s)for(var r=0;r<t.length;r++)t[r]=a-1-t[r];t.reverse();for(var o=[],r=0;r<a;r++)t.indexOf(r)<0&&o.push(r);var l=o.length,p=1<<l;function d(A){var b=0;return t.map(function(L,k){A&1<<k&&(b|=1<<L)}),b}function f(){var A=0;return t.map(function(b,L){A|=1<<b}),A+1}function h(){var A=0;return o.map(function(b,L){A|=1<<b}),A}for(var c=v.zeros([1<<a,1<<a]),m=0;m<e.length;m++)for(var q=d(m),u=0;u<e[m].length;u++){var Q=d(u),_=e[m][u];if(_)for(var S=q,j=Q,O=p,C=d(0),P=f(),y=h(),x=C;O--;)S=x|q,c[S][j]=_,x=x+P&y,j=x|Q}return c},g.prototype.circuitMatrix=function(a){var e=new g;if(e.load(this.save(!0)),e.gotClassicalControl())return[];for(var t=[],n=e.numCols()-1;n>=0;n--)for(var s=e.numQubits-1;s>=0;s--){var r=e.getGateAt(n,s);if(r&&r.connector==0){var o=e.basicGates[r.name];if(!o)throw new Error('Unknown gate "'+r.name+'"');if(o.matrix&&o.matrix.length){var l=e.getRawGate(o,r.options),p=e.transformMatrix(e.numQubits,l,r.wires,a);!t||!t.length?t=p:t=this.multiplySquareMatrices(t,p)}}}return t},g.prototype.eigenvalues2x2=function(a){var e=this.parseMatrix(a),t=[0,0],n=v.add(e[0][0],e[1][1]);return t[0]=v.divide(v.add(n,v.sqrt(v.add(v.multiply(v.multiply(4,e[0][1]),e[1][0]),v.pow(v.subtract(e[0][0],e[1][1]),2)))),2),t[1]=v.divide(v.subtract(n,v.sqrt(v.add(v.multiply(v.multiply(4,e[0][1]),e[1][0]),v.pow(v.subtract(e[0][0],e[1][1]),2)))),2),t},g.prototype.getBipartiteState=function(a,e){var t={},n=0;function s(f,h){var c=v.add(f,h),m=c.arg();return v.complex({abs:v.sqrt(v.pow(v.abs(f),2)+v.pow(v.abs(h),2)),arg:m})}for(var r in this.state){var o=parseInt(r),l=0,p=o&1<<a?1:0,d=o&1<<e?2:0;l|=p,l|=d,typeof t[l]<"u"?t[l]=s(t[l],this.state[r]):t[l]=this.state[r],n++}return n||(t[0]=v.complex(1,0)),t},g.prototype.chanceMap=function(){for(var a={},e=0;e<this.numQubits;e++)for(var t=0;t<this.numQubits;t++)a[e]||(a[e]={}),t==e?a[e][t]=null:a[e][t]={};for(var e=0;e<this.numQubits;e++)for(var t=e+1;t<this.numQubits;t++){var n=this.getBipartiteState(e,t),s=new g(2);s.state=n;var r=v.abs(s.angles()[0].radius),o=v.round(1-v.pow(r,2),7);a[e][t].entangled=o>0,a[e][t].concurence=o,a[e][t].concurencePercent=v.round(o*100,2),a[t][e].entangled=o>0,a[t][e].concurence=o,a[t][e].concurencePercent=v.round(o*100,2)}return a};function $t(a,e){for(var t=a.toString(2);t.length<e;)t="0"+t;return t}function te(a,e){return parseInt($t(a,e).split("").reverse().join(""),2)}g.prototype.resetQubit=function(a,e){var t=[[0,0],[0,0]],n=null;this.reverseBitOrder?n=v.pow(2,this.numQubits-1-a):n=v.pow(2,a);var s=0;for(var r in this.state){var o=parseInt(r);(e?o&n:!(o&n))&&(s+=v.pow(v.abs(this.state[r]),2))}s=v.round(s,14),s!=1&&(e?s==0?t[1][0]=1:t[1][1]=v.sqrt(1/s):s==0?t[0][1]=1:t[0][0]=v.sqrt(1/s),this.collapsed=[],this.prob=[],this.applyTransform(t,[a]))},g.prototype.applyGate=function(a,e,t,n){if(a=="measure"){if(!n.creg)throw'Error: "measure" gate requires destination.';var s=this.measure(t[0],n.creg.name,n.creg.bit),r=this.measureResetsQubit;if(!r)for(var o=e;o<this.numCols();o++){for(var l=o==e?t[0]:0,p=l;p<this.numQubits;p++){var d=this.gates[p][o];if(d&&d.name!="measure"){r=!0;break}}if(r)break}r&&this.resetQubit(t[0],s);return}if(a=="reset"){this.resetQubit(t[0],0);return}var f=this.basicGates[a];if(!f){console.log('Unknown gate "'+a+'".');return}var h=this.getRawGate(f,n);this.collapsed=[],this.prob=[],this.applyTransform(h,t)},g.prototype.getRawGate=function(a,e,t){var n=t&&t.params?t.params:this.options&&this.options.params?this.options.params:{},n=JSON.parse(JSON.stringify(n));for(var s in n)n[s]=v.evaluate(n[s]);var r=[];return a.matrix.map(function(o){var l=[];o.map(function(p){if(typeof p=="string"){var d=e?e.params||{}:{},f={};a.params.map(function(c,m){Array.isArray(d)?f[c]=d.length>m?v.evaluate(d[m],n):null:f[c]=v.evaluate(d[c],n)});var h=v.evaluate(p,f);l.push(h)}else l.push(p)}),r.push(l)}),r},g.prototype.countParameterizedGates=function(){for(var a=0,e=this.numCols(),t=0;t<e;t++)for(var n=0;n<this.numQubits;n++){var s=this.getGateAt(t,n);if(s&&s.connector==0&&s.options&&s.options.params){var r=0;for(paramName in s.options.params)r++;r>0&&a++}}return a},g.prototype.findGlobalParams=function(){for(var a={globalParams:[],cells:[]},e=function(c){var m=[],q=function(Q,_){Q.isSymbolNode&&!Q.isFunctionNode&&!v[Q.name]&&m.push(Q.name)},u=v.parse(c);return u.toString({handler:q}),m},t=this.numCols(),n=0;n<t;n++)for(var s=0;s<this.numQubits;s++){var r=this.getGateAt(n,s);if(r&&r.connector==0&&r.options&&r.options.params){var o=!1;for(var l in r.options.params){var p=r.options.params[l];if(typeof p=="string"){var d=e(p);if(d.length){for(var f=0;f<d.length;f++)a.globalParams.indexOf(d[f])<0&&a.globalParams.push(d[f]);if(!o){var h=Math.max.apply(null,r.wires);a.cells.push([n,h]),o=!0}}}}}}return a},g.prototype.getGlobalParams=function(){var a=this.findGlobalParams().globalParams;return a},g.prototype.gotGlobalParams=function(){var a=this.getGlobalParams();return a.length>0},g.prototype.updateGlobalParams=function(){this.params=this.getGlobalParams(),this.options=this.options||{},this.options.params=this.options.params||{};for(var a=0;a<this.params.length;a++){var e=this.params[a];typeof this.options.params[e]>"u"&&(this.options.params[e]=0)}for(var e in this.options.params)this.params.indexOf(e)<0&&delete this.options.params[e];return this.params},g.prototype.makeAllParamsGlobal=function(){for(var a=this.getGlobalParams(),e=function(q){var u=[],Q=function(S,j){S.isSymbolNode&&!S.isFunctionNode&&!v[S.name]&&u.push(S.name)},_=v.parse(q);return _.toString({handler:Q}),u},t=this.numCols(),n=0;n<t;n++)for(var s=0;s<this.numQubits;s++){var r=this.getGateAt(n,s);if(r&&r.connector==0&&r.options&&r.options.params)for(var o in r.options.params){var l=r.options.params[o],p=!1;if(typeof l=="string"){var d=e(l);d.length&&(p=!0)}if(!p){for(var f=0;a.indexOf("var"+f)>=0;)f++;var h="var"+f;a.push(h);for(var c=0;c<r.wires.length;c++){var m=this.gates[r.wires[c]][n];m.options.params[o]=h}this.params.push(h),this.options.params[h]=l}}}},g.prototype.decompose=function(a){if(!a.gates.length)return a;this.updateGlobalParams();function e(C,P,y){return C.slice(0,y).concat(P).concat(C.slice(y))}for(var t=0;t<a.gates[0].length;t++)for(var n=0;n<a.numQubits;n++){var s=a.gates[n][t];if(s&&s.connector==0&&!this.basicGates[s.name]){var r=new g,o=a.customGates[s.name];if(o){if(r.load(o),r.params.length&&s.options&&s.options.params)for(var l=s.options.params,p=0;p<r.gates[0].length;p++)for(var d=0;d<r.numQubits;d++){var f=r.gates[d][p];if(f&&f.connector==0&&f.options&&f.options.params)for(var h in f.options.params){var c=v.parse(f.options.params[h]),m=c.transform(function(C,P,y){return C.isSymbolNode&&l.hasOwnProperty(C.name)?v.parse("("+l[C.name]+")"):C});f.options.params[h]=m.toString()}}if(s.options&&s.options.condition)for(var p=0;p<r.gates[0].length;p++)for(var d=0;d<r.numQubits;d++){var f=r.gates[d][p];f&&(f.options=f.options||{},f.options.condition=s.options.condition)}var q=r.save(!0);if(!q.gates[0].length)for(var u=0;u<q.gates.length;u++)q.gates[u].push(null);for(var Q=[],_=0;_<q.gates[0].length-1;_++)Q.push(null);for(var S=0;S<a.numQubits;S++){var j=a.gates[S][t];if(j&&j.id==s.id){a.gates[S].splice(t,1);for(var O=JSON.parse(JSON.stringify(q.gates[j.connector])),u=0;u<O.length;u++)O[u]&&(O[u].id=O[u].id+"_"+s.id);a.gates[S]=e(a.gates[S],O,t)}else a.gates[S]=e(a.gates[S],Q,t+1)}}}}return a.customGates={},a},g.prototype.decomposeGateAt=function(a,e){var t=this,n=this.getGateAt(a,e);if(n&&this.customGates[n.name]){var s=new g;s.load(this.save());for(var r=0;r<s.gates[0].length;r++)for(var o=0;o<s.numQubits;o++){var l=s.gates[o][r];l&&l.id!=n.id&&s.removeGateAt(r,o)}var p=new g;p.load(s.save(!0)),p.removeLeadingColumns(),p.removeTrailingColumns();for(var d=0;d<p.gates[0].length-1;d++)this.insertSpace(a+d,n.wires);this.removeGate(n.id);for(var f=a,r=0;r<p.gates[0].length;r++){var h=p.getGatesAtColumn(r);h.map(function(m){t.addGate(m.name,f,m.wires,m.options)}),f++}return p}},g.prototype.removeMeasurementAndClassicalControl=function(){for(var a=this.numCols(),e=0;e<a;e++)for(var t=0;t<this.numQubits;t++){var n=this.gates[t][e];n&&n.name=="measure"&&(this.gates[t][e]=null,n=null),n&&n.options&&n.options.condition&&delete this.gates[t][e].options.condition}this.cregs={},this.options&&(this.options.hybrid=!1,this.options.hybridOptions&&delete this.options.hybridOptions)},g.prototype.convertToCustomGate=function(a,e,t){for(var n=this.numCols(),s=0;s<n;s++)for(var r=0;r<this.numQubits;r++){var o=this.gates[r][s];o&&o.name=="measure"&&(this.gates[r][s]=null,o=null),o&&o.options&&o.options.condition&&delete this.gates[r][s].options.condition}this.cregs={};var l=this.save(e);if(l.options&&(l.options.hybrid=!1,l.options.hybridOptions&&delete l.options.hybridOptions),this.clear(),this.customGates[a]=l,t){for(var p=[],d=0;d<this.numQubits;d++)p.push(d);var f=JSON.parse(JSON.stringify(this.customGates[a].options));this.addGate(a,-1,p,f)}else this.removeTrailingRows()},g.prototype.validCustomGateName=function(a){a=(a||"sub")+"";var e=[];if(this.customGates){if(!this.basicGates[a]&&!this.customGates[a])return a;for(var t in this.basicGates)e.push(t);for(var t in this.customGates)e.push(t)}var n=0,s="";do n++,s=a+n;while(e.indexOf(s)>=0);return s},g.prototype.splitIntoBlocks=function(a,e){e=e||{};var t=[],n="{}",s=!0,r=null,o=new g;o.load(this.save(!0));for(var l=o.numCols(),p=0;p<l;p++)for(var d=0;d<o.numQubits;d++){var f=o.getGateAt(p,d);if(f&&f.connector==0&&!f.addedToBlock){var h=this.basicGates[f.name],c=f.options&&f.options.condition?JSON.stringify(f.options.condition):"{}",m=h&&!!(h.matrix&&h.matrix.length),q=JSON.parse(JSON.stringify(r?r.wires:[]));if(f.wires.map(function(B){q.indexOf(B)<0&&q.push(B)}),!t.length||c!=n||!m||!s||!(q.length<=a)?(r={wires:f.wires,gates:[f]},t.push(r),f.options&&f.options.condition&&(r.condition=f.options.condition)):(r.wires=q,r.gates.push(f)),f.wires.map(function(B){o.gates[B][p].addedToBlock=!0}),n=c,s=m,!e.verticalOnly){var u=p+1,Q=JSON.parse(JSON.stringify(r.wires));for(Q.sort();u<l&&Q.length;){for(extWire=Q[0];Q.length&&extWire<=Q[Q.length-1];){var _=o.getGateAt(u,extWire);if(_&&!_.addedToBlock){var S=this.basicGates[_.name],j=_.options&&_.options.condition?JSON.stringify(_.options.condition):"{}",O=S&&!!(S.matrix&&S.matrix.length),C=O&&j==c;if(C){for(var P=0;P<_.wires.length;P++)if(Q.indexOf(_.wires[P])<0){C=!1;break}}if(C)r.gates.push(_),_.wires.map(function(B){o.gates[B][u].addedToBlock=!0});else{for(var y=[],P=0;P<Q.length;P++){var x=Q[P];_.wires.indexOf(x)<0&&y.push(x)}Q=y}}if(Q.length){for(var A=Q[Q.length-1]+1,P=Q.length-1;P>=0;P--){var x=Q[P];x>extWire&&(A=x)}extWire=A}}u++}}}}for(var b=new g,L=0,k=0;k<t.length;k++){var N=t[k],W=!1;if(N.wires.length<=a||e.flexibleBlockSize)for(var R=0;R<N.gates.length;R++){var f=N.gates[R],h=this.basicGates[f.name];h.matrix&&h.matrix.length&&(W=!0)}if(W){L++;for(var F=new g,R=0;R<N.gates.length;R++){var f=N.gates[R];f.options.condition&&delete f.options.condition;var V=[];f.wires.map(function(U){V.push(N.wires.indexOf(U))}),f.wires=V,F.appendGate(f.name,V,f.options)}var G="block"+L;b.registerGate(G,F);var Z={};N.condition&&(Z.condition=N.condition),b.appendGate(G,N.wires,Z)}else N.gates.map(function(B){b.appendGate(B.name,B.wires,B.options)})}this.load(b.save(!1))},g.prototype.usedGates=function(a){a=a||{};var e=new g;e.load(this.save(!0));for(var t=[],n=0;n<e.numQubits;n++)for(var s=0;s<e.numCols();s++){var r=e.gates[n][s];if(r&&t.indexOf(r.name)<0){var o=!1;if(a.unitariesOnly){var l=e.basicGates[r.name];(!l||!l.matrix||!l.matrix.length)&&(o=!0)}o||t.push(r.name)}}if(!a.noCustomGates)for(var p in this.customGates)this.customGates[p],t.indexOf(p)<0&&t.push(p);return t},g.prototype.countOps=function(a,e){e=e||{},e.shallow=e.shallow||!1,a||(a=this);for(var t={},n=0;n<a.gates.length;n++)for(var s=0;s<a.gates[n].length;s++){var r=a.gates[n][s];if(r&&r.connector==0){var o=this.basicGates[r.name];if(o)t[r.name]?t[r.name]++:t[r.name]=1;else{var l=this.customGates[r.name];if(l&&(t[r.name]?t[r.name]++:t[r.name]=1,!e.shallow)){var p=this.countOps(l,e);for(subName in p)t[subName]?t[subName]+=p[subName]:t[subName]=p[subName]}}}}return t},g.prototype.getCouplingMap=function(a){a=a||{};var e="",t=new g;t.load(this.save(!0));for(var n=0;n<t.numQubits;n++)for(var s=0;s<t.numCols();s++){var r=t.getGateAt(s,n);if(r&&r.connector==0){var o=!1;if(a.unitariesOnly){var l=t.basicGates[r.name];(!l||!l.matrix||!l.matrix.length)&&(o=!0)}if(!o){var p=JSON.stringify(r.wires);e.indexOf(p)<0&&(e&&(e+=","),e+=p)}}}return JSON.parse("["+e+"]")},g.prototype.getGateDef=function(a){var e=this.basicGates[a];return e||(e=this.customGates[a]),e},g.prototype.importRaw=function(a,e){var t=a&&a.qubits||0;if(this.init(t),!a)if(e)e([]);else return;if(a.cregs)for(var n=0;n<a.cregs.length;n++){var s=a.cregs[n];if(!s.name){var r="Classical register "+n+` doesn't have a "name".`;if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}this.createCreg(s.name,s.len||0)}if(a.program)for(var n=0;n<a.program.length;n++){var o=a.program[n];if(!o.name){var r="Gate "+n+` doesn't have a "name". Name is optional and this is OK for QubitToaster but we cannot import gate from matrix. Not implemented yet.`;if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}var l=this.basicGates[o.name];if(!l){var r='Unknown gate "'+o.name+'". Name is optional and this is OK for QubitToaster but we cannot import gate from matrix. We can import only gates by name from set of known gates.';if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}var p=JSON.parse(JSON.stringify(o.wires||[])),d=JSON.parse(JSON.stringify(o.options||{})),f=l.matrix&&l.matrix.length?v.log2(l.matrix.length):1;if(p.length!=f){var r='Gate "'+o.name+'" has '+p.length+" wires but should have "+f+" wires.";if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}if(l.params&&l.params.length){if(!d.params){var r='Missing parameters for gate "'+o.name+'". Expecting '+l.params.length+" parameters.";if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}for(var h=0;h<l.params.length;h++){var c=l.params[h];if(typeof d.params[c]>"u"){var r='Missing parameter "'+c+'" for gate "'+o.name+'".';if(e){e([{msg:r,line:0,col:0}]);return}else throw new Error(r)}}}this.appendGate(o.name,p,d)}e&&e([])},g.prototype.exportRaw=function(){var a=this.options&&this.options.params?this.options.params:{},a=JSON.parse(JSON.stringify(a));for(var e in a)a[e]=v.evaluate(a[e]);var t=new g;t.load(this.save(!0));for(var n=t.numCols(),s=[],r=0;r<n;r++)for(var o=0;o<t.numQubits;o++){var l=t.getGateAt(r,o);if(l&&l.connector==0){var p=t.basicGates[l.name];if(!p){console.log('Unknown gate "'+l.name+'".');return}var d=t.getRawGate(p,l.options),f=[];d.map(function(u){var Q=[];u.map(function(_){_=JSON.parse(JSON.stringify(_)),typeof _=="object"&&_.mathjs&&typeof _.mathjs=="string"&&(_.type=_.mathjs.toLowerCase(),delete _.mathjs),Q.push(_)}),f.push(Q)});var h={};if(l.options&&(h=JSON.parse(JSON.stringify(l.options))),h.params)for(var c in h.params)h.params[c]=v.evaluate(h.params[c],a);s.push({name:l.name,matrix:f,wires:l.wires,options:h})}}var m=[];for(var q in t.cregs)m.push({name:q,len:t.cregs[q].length||0});return{qubits:t.numQubits,cregs:m,program:s}},g.prototype.exportToGenerator=function(a){a=a||{};var e=this.exportQASM(null,!1,null,!1,!0),t=this.usedGates({noCustomGates:!0,unitariesOnly:!0}),n=this.getCouplingMap({unitariesOnly:!0}),s={source:{circuit:{qasm:e}},problem:[],type:"circuit",settings:{allowed_gates:t.join(","),coupling_map:n}},r=new g;if(r.load(this.save(!0)),a.fromMatrix){var o=r.circuitMatrix(),l=[];return o.map(function(m){m.map(function(q){typeof q=="object"?l.push([q.re,q.im]):l.push(q)})}),s.problem.push({unitary:l}),s}if(!a.noVectors){for(var p=new g,d=a.numSamples||(this.numQubits<3?8:this.numQubits<5?(1<<this.numQubits)+1:this.numQubits<9?this.numQubits*4:this.numQubits),f=0;f<d+1;f++){var h={input:[],output:[]},c=[];f>0?(p.randomCircuit(this.numQubits,20,{useGates:a.useGates||["u3","cx"],noClassicControl:!0,noMeasure:!0,noReset:!0}),p.run(),p.stateAsArray().map(function(m){h.input.push([m.amplitude.re,m.amplitude.im])}),c=p.state):(r.initState(),r.stateAsArray().map(function(m){h.input.push([m.amplitude.re,m.amplitude.im])}),c=r.state),r.run(null,{initialState:c}),r.stateAsArray().map(function(m){h.output.push([m.amplitude.re,m.amplitude.im])}),s.problem.push(h)}return s}return s},g.prototype.save=function(a,e){this.updateGlobalParams();var t={numQubits:this.numQubits,params:JSON.parse(JSON.stringify(this.params)),options:JSON.parse(JSON.stringify(this.options)),gates:JSON.parse(JSON.stringify(this.gates)),customGates:JSON.parse(JSON.stringify(this.customGates)),cregs:JSON.parse(JSON.stringify(this.cregs))},n=null;if(a?n=this.decompose(t):n=t,e&&(n.gates&&n.gates.map(function(o){o&&o.map(function(l){l&&l.id&&delete l.id})}),n.customGates))for(var s in n.customGates){var r=n.customGates[s];r&&r.gates&&r.gates.map(function(o){o&&o.map(function(l){l&&l.id&&delete l.id})})}return n},g.prototype.load=function(a){this.numQubits=a.numQubits||1,this.clear(),this.params=JSON.parse(JSON.stringify(a.params||[])),this.options=JSON.parse(JSON.stringify(a.options||{})),this.gates=JSON.parse(JSON.stringify(a.gates||[])),this.customGates=JSON.parse(JSON.stringify(a.customGates||{})),this.cregs=JSON.parse(JSON.stringify(a.cregs||{})),this.options.params=this.options.params||{},this.options.hybrid=this.options.hybrid||!1,this.options.hybridOptions||(this.options.hybridOptions=this.defaultHybridOptions())};var ie=function(a){if(a<=0)throw new Error("Cannot generate the gray code for less than 1 bit.");var e=[0];for(i=0;i<a;i++){var t=[].concat(e).reverse();t.map(function(s){e.push(s+v.pow(2,i))})}var n=[];return e.map(function(s){n.push($t(s,a))}),n};g.prototype.grayCodeChain=function(a,e,t){function n(c,m){for(var q=[],u=0;u<c.length;u++)q.push(c[u]!=m[u]);return q}function s(c,m){for(var q=[],u=0;u<c.length;u++)c[u]==m&&q.push(u);return q}function r(c,m){for(var q=0,u=0;u<c.length;u++)c[u]==m&&q++;return q}for(var o=[],l=0;l<a;l++)o.push(l);var p=a,d=ie(a),f=null,h=[];return d.map(function(c){var m=c.indexOf("1");if(m>=0){f||(f=c);var q=n(c,f),u=q.indexOf(!0);if(u>=0)if(u!=m)h.push({gateName:"cx",wires:[o[u],o[m]],options:null});else for(var Q=s(c,"1"),_=1;_<Q.length;_++)h.push({gateName:"cx",wires:[o[Q[_]],o[m]],options:null});if(r(c,"1")%2)h.push({gateName:e,wires:[o[m],p],options:t});else{var S=null;if(t&&(S=JSON.parse(JSON.stringify(t)),S.params))for(key in S.params){var j=S.params[key];typeof j=="number"?j=0-j:j="-("+j+")",S.params[key]=j}h.push({gateName:e,wires:[o[m],p],options:S})}f=c}}),h},g.prototype.MCU1Circuit=function(a){var e=0,t=[];if(typeof a=="number")e=a;else{e=a.length||0;for(var n=0;n<e;n++)(!a[n]||typeof a[n]=="number"&&a[n]<0)&&t.push(n)}if(e==0)throw new Error("Cannot create multi-controlled gate with zero control qubits.");function s(d,f){f.map(function(h){d.appendGate("x",h)})}var r="lambda / "+v.pow(2,e-1),o={params:{lambda:r}},l=new g;if(e==1)return s(l,t),l.appendGate("cu1",[0,1],o),s(l,t),l;s(l,t);var p=this.grayCodeChain(e,"cu1",o);return p.map(function(d){l.appendGate(d.gateName,d.wires,d.options)}),s(l,t),l},g.prototype.MCXCircuit=function(a){var e=0,t=[];if(typeof a=="number")e=a;else{e=a.length||0;for(var n=0;n<e;n++)(!a[n]||typeof a[n]=="number"&&a[n]<0)&&t.push(n)}var s=new g;if(e==0)throw new Error("Cannot create multi-controlled gate with zero control qubits.");function r(d,f){f.map(function(h){d.appendGate("x",h)})}if(e==1)return r(s,t),s.appendGate("cx",[0,1]),r(s,t),s;if(e==2)return r(s,t),s.appendGate("ccx",[0,1,2]),r(s,t),s;for(var o=s.MCU1Circuit(e),l="mcu1_"+e,p=[],n=0;n<e+1;n++)p.push(n);return s.registerGate(l,o),r(s,t),s.appendGate("h",e),s.appendGate(l,p,{params:{lambda:"pi"}}),r(s,t),s.appendGate("h",e),s},g.prototype.registerGate=function(a,e){if(e instanceof g?this.customGates[a]=e.save():this.customGates[a]=e,this.isMultiControlledGate(a)){var t=this.decodeMultiControlledGateName(a);if(t.numCtrlQubits!=this.customGates[a].numQubits-1){t.numCtrlQubits=this.customGates[a].numQubits-1;for(var n=[],s=0;s<t.numCtrlQubits;s++)n.push(typeof t.ctrlQubits[s]>"u"?!0:t.ctrlQubits[s]);t.ctrlQubits=n}var r=this.basicGates[t.rootName];if(r&&r.drawingInfo&&r.drawingInfo.connectors){this.customGates[a].drawingInfo||(this.customGates[a].drawingInfo={});var o=[];t.ctrlQubits.map(function(l){l?o.push("dot"):o.push("ndot")}),o.push(r.drawingInfo.connectors[r.drawingInfo.connectors.length-1]),this.customGates[a].drawingInfo.connectors=o,this.customGates[a].drawingInfo.root=r.drawingInfo.root}}},g.prototype.registerMCXGate=function(a){var e=this.multiControlledGateName("mcx",a);return this.registerGate(e,this.MCXCircuit(a).save(!0)),e},g.prototype.registerMCU1Gate=function(a){var e=this.multiControlledGateName("mcu1",a);return this.registerGate(e,this.MCU1Circuit(a).save(!0)),e},g.prototype.registerMultiControlledGate=function(a,e){switch(a){case"cx":return this.registerMCXGate(e);case"cu1":return this.registerMCU1Gate(e)}return""},g.prototype.getOrRegisterMultiControlledEquivalent=function(a,e){var t=this.basicGates[a];if(t){if(t.drawingInfo&&(a=="x"||a=="u1"||t.drawingInfo.root=="x"||t.drawingInfo.root=="u1"))if(!this.basicGates["c"+a]||e){for(var n="c"+(t.drawingInfo.root||a),s=v.log2(t.matrix.length),r=[],o=0;o<s-1;o++)r.push(!0);return r.unshift(!e),this.registerMultiControlledGate(n,r)}else return"c"+a;for(var l in this.basicGates){var p=this.basicGates[l];if(p&&p.drawingInfo&&p.drawingInfo.root&&p.drawingInfo.root==a&&!e)return l}return null}if(this.customGates[a]){var d=this.decodeMultiControlledGateName(a);return!d||!d.numCtrlQubits?null:d.rootName=="cx"||d.rootName=="cu1"?(d.ctrlQubits.unshift(!e),this.registerMultiControlledGate(d.rootName,d.ctrlQubits)):null}return null},g.prototype.removeUnusedMultiControlledGates=function(){var a=this.countOps(null,{shallow:!1});for(gateName in this.customGates)a[gateName]||this.isMultiControlledGate(gateName)&&delete this.customGates[gateName]},g.prototype.decodeMultiControlledGateName=function(a){if(!a)return null;var e={},t=a.split("_");if(t.length>0&&(e.name=t[0],e.rootName=e.name.substring(1),e.rootName!="cx"&&e.rootName!="cu1"))return null;if(t.length>1){var n=parseInt(t[1]);!isNaN(n)&&n<=20&&(e.numCtrlQubits=n)}if(e.numCtrlQubits){var s=[];if(t.length>2)for(var r=0;r<t[2].length;r++)t[2][r]=="0"&&s.push(!1),t[2][r]=="1"&&s.push(!0);if(!s.length)for(var r=0;r<n;r++)s.push(!0);e.ctrlQubits=s}return e},g.prototype.multiControlledGateName=function(a,e){var t=a+"_";if(typeof e=="number")t+=e;else{t+=e.length||0;var n="";e.map(function(s){!s||typeof s=="number"&&s<0?n+="0":n+="1"}),n.indexOf("0")<0&&(n=""),n&&(t+="_"+n)}return t},g.prototype.isMultiControlledGate=function(a){var e=this.decodeMultiControlledGateName(a),t=!!this.customGates[a]&&!!e&&!!e.numCtrlQubits;return t},g.prototype.isControllableGate=function(a){var e=this.basicGates[a];if(e){if(e.drawingInfo&&(e.drawingInfo.root=="x"||e.drawingInfo.root=="u1"))return!0;for(var t in this.basicGates){var e=this.basicGates[t];if(e&&e.drawingInfo&&e.drawingInfo.root&&e.drawingInfo.root==a)return!0}}return this.isMultiControlledGate(a)},g.prototype.getGatePosById=function(a){for(var e=this,t=e.numCols(),n=0;n<t;n++)for(var s=0;s<e.numQubits;s++){var r=e.getGateAt(n,s);if(r&&r.id==a)return{wires:r.wires,col:n}}return{wires:[],col:-1}},g.prototype.getGateById=function(a){for(var e=this,t=e.numCols(),n=0;n<t;n++)for(var s=0;s<e.numQubits;s++){var r=e.getGateAt(n,s);if(r&&r.id==a)return r}return null},g.prototype.getGateBefore=function(a,e){for(var t=null,n=a-1;n>=0&&!t;)t=this.getGateAt(n,e),n--;return t},g.prototype.getGateAt=function(a,e){if(!this.gates[e]||!this.gates[e][a])return null;var t=JSON.parse(JSON.stringify(this.gates[e][a]));if(!t)return null;t.column=a,t.wires=[];for(var n=t.id,s=this.gates.length,e=0;e<s;e++){var r=this.gates[e][a];r&&r.id==n&&(t.wires[r.connector]=e)}return t},g.prototype.getGatesAtColumn=function(a){for(var e=[],t=this.gates.length,n=0;n<t;n++){var s=this.getGateAt(a,n);s&&s.connector==0&&e.push(s)}return e},g.prototype.getControllableGatesAtColumn=function(a){for(var e=this.getGatesAtColumn(a),t=[],n=0;n<e.length;n++){var s=e[n];this.isControllableGate(s.name)&&t.push(s)}return t},g.prototype.exportJavaScript=function(a,e,t,n){var s=this,r=null;e?(r=new g,r.load(this.save(!0))):r=this;var o="";if(a){var l=(a||"").split(`
`);l.map(function(A){A.length>=2&&A[0]!="/"&&A[1]!="/"&&(o+="// "),o+=A,o+=`
`})}var p="",d="";if(t)p="    ",d="circ",o+="const "+t+` = function() {
`,o+=p+"const "+d+" = new QuantumCircuit("+r.numQubits+`);

`,r.params&&r.params.length&&(o+=p+d+".params = "+JSON.stringify(r.params)+`

`);else{p="",d="circuit",o+=p+`const QuantumCircuit = require("quantum-circuit");

`,o+=p+"const "+d+" = new QuantumCircuit("+r.numQubits+`);

`;var f=r.usedGates();if(!e){var h=[];f.map(function(A){var b=r.basicGates[A];if(!b){var L=s.customGates[A];if(L){var k=new g;k.load(L),o+=k.exportJavaScript("",!0,A),h.push(A)}}}),h.map(function(A){o+=p+d+'.registerGate("'+A+'", '+A+`());
`}),h.length>0&&(o+=`
`)}}var c=0;for(var m in this.cregs)o+=p+d+'.createCreg("'+m+'", '+(this.cregs[m].length||1)+`);
`,c++;c>0&&(o+=`
`);for(var q=r.numCols(),u=0;u<q;u++)for(var Q=0;Q<this.numQubits;Q++){var _=r.getGateAt(u,Q);if(_&&_.connector==0){var S=_.name;if(S=="measure"&&_.options&&_.options.creg)o+=p+d+".addMeasure("+Q+', "'+_.options.creg.name+'", '+_.options.creg.bit+`);
`;else{if(o+=p+d+'.appendGate("'+_.name+'"',_.wires.length==1)o+=", ",o+=_.wires[0];else{o+=", [";for(var j=0;j<_.wires.length;j++)j>0&&(o+=","),o+=_.wires[j];o+="]"}if(_.options){var O={};for(var C in _.options)if(_.options[C]){var P=_.options[C],y=!1;typeof P=="object"&&Object.keys(P).length===0&&P.constructor===Object&&(y=!0),y||(O[C]=P)}o+=", "+JSON.stringify(O)}o+=`);
`}}}if(t?(o+=`
`,o+=p+"return "+d+`;
`,o+=`};

`):(o+=`
`,o+=p+d+`.run();

`,o+=p+`console.log("Probabilities:");
`,o+=p+`console.log(JSON.stringify(circuit.probabilities()));

`,o+=p+`console.log("Measure all:");
`,o+=p+`console.log(JSON.stringify(circuit.measureAll()));

`,r.cregCount()&&(o+=p+`console.log("Classical registers:");
`,o+=p+`console.log(circuit.cregsAsString());

`)),n){var x={metadata:{kernelspec:{display_name:"Javascript (Node.js)",language:"javascript",name:"javascript"},language_info:{file_extension:".js",mimetype:"application/javascript",name:"javascript"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:o,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(x)}return o},g.prototype.exportQiskit=function(a,e,t,n,s,r,o,l,p,d,f){var h={comment:a,decompose:e,versionStr:n,providerName:s,backendName:r,asJupyter:o,shots:l,hybrid:f};return this.exportToQiskit(h,t,p,d)},g.prototype.exportQuEST=function(a,e,t,n){var s={comment:a,decompose:e};return this.exportToQuEST(s,t,n)},g.prototype.exportQASM=function(a,e,t,n,s,r){var o={comment:a,decompose:e,compatibilityMode:s};return this.exportToQASM(o,t,n,r)},g.prototype.importQASM=function(a,e,t){this.init(),re(this,a,e,t)},g.prototype.exportPyquil=function(a,e,t,n,s,r,o,l,p){var d={comment:a,decompose:e,versionStr:n,lattice:s,asQVM:r,asJupyter:o,shots:l,hybrid:p};return this.exportToPyquil(d,t)},g.prototype.exportQuil=function(a,e,t,n){var s={comment:a,decompose:e,versionStr:n};return this.exportToQuil(s,t)},g.prototype.importQuil=function(a,e,t,n,s,r){var o=this;t=t||{},o.init(),s=s||{},r=r||0;function l(V){if(o.customGates&&o.customGates[V])return{name:V,customGate:o.customGates[V]};for(var G in o.basicGates){var Z=o.basicGates[G];if(Z.exportInfo){if(Z.exportInfo.quil&&Z.exportInfo.quil.name==V)return{name:G,gateDef:Z,quilDef:Z.exportInfo.quil};if(Z.exportInfo.pyquil&&Z.exportInfo.pyquil.name==V)return{name:G,gateDef:Z,quilDef:Z.exportInfo.pyquil}}}return null}var p=a.split(`
`),d=[],f=!1;p.map(function(V,G){if(V=V.split("#")[0],V.length?V=V.trim():f=!1,f){var Z=V.split(";");Z.map(function(ot){ot.trim().length&&d[d.length-1].body.push(ot.trim())})}else if(V.length){var B=V.split(";"),Z=[];B.map(function(U){U.trim().length&&Z.push(U.trim())}),Z.map(function(U){var E=U.split(" "),T=E[E.length-1];if(T.length&&(T[T.length-1]==":"&&(f=!0,T=T.substring(0,T.length-1),E[E.length-1]=T),E.length)){var tt="GATE";(E[0]=="DEFGATE"||E[0]=="DEFCIRCUIT")&&(tt=E[0],E.splice(0,1));var I=E.join(" "),X=[],z=I.indexOf("(");if(z>=0){var J=I.indexOf(")");J>z&&(X=I.substring(z+1,J).split(","),X.map(function(H,ut){for(H=H.trim();H.length&&H[0]=="%";)H=H.slice(1);X[ut]=H}),J+1<=I.length?(tok=I.substring(J+1,I.length).split(" "),E=[],tok.map(function(H){H=H.trim(),H.length&&E.push(H)})):E=[],I=I.substring(0,z).trim())}else I=E.splice(0,1)[0].trim();for(var rt=[],Y=0;Y<E.length;Y++){var et=E[Y];if(n){var D=n.indexOf(et);D>=0?rt.push(D):rt.push(et)}else rt.push(et)}d.push({type:tt,name:I,params:X,args:rt,body:[],line:G,col:0})}})}});for(var h=d.length,c=0;c<h;c++){var m=d[c];switch(s[m.name]&&(m.name=s[m.name]),m.type){case"DEFGATE":if(m.name==m.name.toUpperCase()){var q=m.name.toLowerCase();s[m.name]=q,m.name=q}break;case"DEFCIRCUIT":{if(m.name==m.name.toUpperCase()){var q=m.name.toLowerCase();s[m.name]=q,m.name=q}var u=m.body.join(`
`),Q=m.args,_=new g;_.importQuil(u,e,t,Q,s,m.line+1),_.params=JSON.parse(JSON.stringify(m.params)),o.registerGate(m.name,_.save())}break;case"GATE":switch(m.name){case"DECLARE":break;case"HALT":break;case"PRAGMA":break;default:{var S=l(m.name);if(S){var j={};if(S.gateDef){var O=S.gateDef,C=S.quilDef;if((C.params||[]).length!=(m.params||[]).length){var P="Invalid number of params. Expected "+(C.params||[]).length+" got "+(m.params||[]).length+".";if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}else for(var y=0;y<O.params.length;y++){var x=O.params[y],A=C.params.indexOf(x);if(A<0||A>=m.params.length){var P='Internal error: QUIL definition for gate "'+m.name+" is invalid.";if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}else j[x]=m.params[A]}}else{var O=S.customGate;if((O.params||[]).length!=(m.params||[]).length){var P="Invalid number of params. Expected "+(O.params||[]).length+" got "+(m.params||[]).length+".";if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}else for(var y=0;y<O.params.length;y++){var x=O.params[y];j[x]=m.params[y]}}if(m.name=="MEASURE"){if(m.args.length!=2){var P="Expecting 2 arguments (qubit and target register) but found "+m.args.length+".";if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}}else{var b=1;if(O.numQubits?b=O.numQubits:O.matrix&&O.matrix.length&&(b=v.log2(O.matrix.length)),m.args.length!=b){var P="Expecting "+b+" arguments but found "+m.args.length+".";if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}}for(var L=[],k={},y=0;y<m.args.length;y++){var N=m.args[y];if(m.name=="MEASURE"){var W=N.indexOf("[");if(W>=0){var R=N.indexOf("]");R>W&&(cregBit=N.substring(W+1,R),cregName=N.substring(0,W),k={bit:cregBit,name:cregName})}else{var F=parseInt(N);if(isNaN(F))if(y>0)L.push(N);else{var P='Invalid argument "'+N+'"';if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}L.push(F)}}else{var F=parseInt(N);if(isNaN(F)){var P='Invalid argument "'+N+'"';if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}L.push(F)}}o.appendGate(S.name,L,{params:j,creg:k})}else{var P='Cannot recognize "'+m.name+'".';if(e){e([{msg:P,line:r+m.line,col:m.col}]);return}else throw new Error(P)}}}break}}e&&e([])},g.prototype.importIonq=function(a,e){var t=this,n=a.qubits||1;if(t.init(n),!a.circuit){var s="Invalid file format.";if(e){e([{msg:s,line:-1,col:-1}]);return}else throw new Error(s)}function r(o){if(t.customGates&&t.customGates[o])return{name:o,customGate:t.customGates[o]};for(var l in t.basicGates){var p=t.basicGates[l];if(p.exportInfo&&p.exportInfo.ionq&&(p.exportInfo.ionq.name&&p.exportInfo.ionq.name==o||p.exportInfo.ionq.names&&p.exportInfo.ionq.names.indexOf(o)>=0))return{name:l,gateDef:p}}return null}a.circuit.map(function(o){var l=r(o.gate);if(!l){var p='Unknown gate "'+o.gate+'"';if(e){e([{msg:p,line:-1,col:-1}]);return}else throw new Error(p)}var d=[];typeof o.control<"u"&&d.push(o.control),typeof o.controls<"u"&&(d=d.concat(o.controls)),typeof o.target<"u"&&d.push(o.target),typeof o.targets<"u"&&(d=d.concat(o.targets));var f=[];typeof o.rotation<"u"&&f.push(o.rotation),typeof o.phase<"u"&&f.push(o.phase),typeof o.phases<"u"&&(f=f.concat(o.phases));var h=l.gateDef?l.gateDef.matrix?v.log2(l.gateDef.matrix.length):1:l.customGate.numQubits||1,c=l.gateDef?l.gateDef.params||[]:l.customGate.params||[];if(d.length!=h){var p='Gate "'+o.gate+'": invalid number of qubits. Expected '+h+" but got "+d.length+".";if(e){e([{msg:p,line:-1,col:-1}]);return}else throw new Error(p)}if(f.length!=c.length){var p='Gate "'+o.gate+'": invalid number of params. Expected '+c.length+" but got "+f.length+".";if(e){e([{msg:p,line:-1,col:-1}]);return}else throw new Error(p)}var m={};f.length&&(m.params={},c.map(function(q,u){m.params[q]=o.rotation?f[u]:2*v.pi*f[u]})),t.appendGate(l.name,d,m)}),e&&e([])},g.prototype.exportToIonq=function(a,e){var t=this.options&&this.options.params?this.options.params:{},t=JSON.parse(JSON.stringify(t));for(var n in t)t[n]=v.evaluate(t[n]);var s=new g;s.load(this.save(!0));for(var r={qubits:s.numQubits,circuit:[]},o=s.numCols(),l=0;l<o;l++)for(var p=0;p<s.numQubits;p++){var d=s.getGateAt(l,p);if(d&&d.connector==0){var f=s.getGateDef(d.name);if(f.exportInfo&&f.exportInfo.ionq)if(f.exportInfo.ionq.name||f.exportInfo.ionq.names){var h={gate:f.exportInfo.ionq.name||f.exportInfo.ionq.names[0]};f.params&&f.params.length&&(h[f.exportInfo.ionq.paramsKey]=[],f.params.map(function(c){var m=v.evaluate(d.options.params[c],t);f.exportInfo.ionq.paramsKey!="rotation"&&(m=m/(2*v.pi)),h[f.exportInfo.ionq.paramsKey].push(m)})),r.circuit.push(h)}else{var h={gate:'Export gate "'+d.name+'" to IONQ not supported yet. Comming soon.'};r.circuit.push(h)}else{var h={gate:'Export gate "'+d.name+'" to IONQ not supported yet. Comming soon.'};r.circuit.push(h)}}}return r},g.prototype.exportQuirk=function(a){var e=this,r=null;function t(Y){for(var et=[],D=0;D<Y;D++)et.push(D);return et}function n(Y,et){return et.indexOf(Y)>-1}a=!0;var s=this.save(a),r=new g,o=new g;r.load(s),o.load(s);var l={cols:[],gates:[]},p=null,d=this.options&&this.options.params?this.options.params:{},f=new g,h={};if(!a)for(var c=o.numCols(),m=c-1;m>=0;m--)for(var q=0;q<o.numQubits;q++){var u=o.gates[q][m];if(u&&u.connector==0&&!o.basicGates[u.name]){customDecomposedCircuit=o.decomposeGateAt(m,q);var Q=!1;h[u.name]={info:[],isDecomposeCustomCircuit:null};for(var _=0;_<customDecomposedCircuit.numCols();_++)for(var S=0;S<customDecomposedCircuit.numQubits;S++){var j=customDecomposedCircuit.getGateAt(_,S);if(j){var O=customDecomposedCircuit.basicGates[j.name];O.exportInfo&&!O.exportInfo.quirk&&(Q=Q||!0),j.connector==0&&h[u.name].info.push({gateInCustomCircuit:j,column:m})}h[u.name].isDecomposeCustomCircuit=Q}Q&&r.gates.map(function(Y,et){Y.map(function(D){D&&D.name==u.name&&r.removeGate(D.id)})})}}gateKeys=Object.keys(h);for(var C=0;C<gateKeys.length;C++)if(gateKey=gateKeys[C],h[gateKey].isDecomposeCustomCircuit)for(var P=h[gateKey].info.length-1;P>=0;P--){var y=h[gateKey].info[P],x=y.gateInCustomCircuit;r.insertGate(x.name,y.column,x.wires,x.options)}for(var A=null,b=null,m=0;m<c;m++)for(var q=0;q<r.numQubits;q++){var u=r.getGateAt(m,q);u&&(b&&b.name!=u.name&&b.connector!=0&&A==m&&(r.removeGate(u.id),r.insertGate(u.name,u.column+1,u.wires,u.options)),b=u,A=m)}for(var c=r.numCols(),m=0;m<c;m++){for(var L=[],k=[],N=!1,q=0;q<r.numQubits;q++){var u=r.getGateAt(m,q);if(!u||u.name=="measure"||u.name=="reset")(N||!n(q,k))&&L.push(1);else{var W=r.basicGates[u.name],R=v.max(u.wires),F=v.min(u.wires),V=u.wires.slice(),k=t(R);if(W){var G="",Z=!1;if(N=!0,W.exportInfo&&W.exportInfo.quirk&&(G=W.exportInfo.quirk.name,Z=W.exportInfo.quirk.controlled),W.matrix.length==4&&(G&&u.name=="swap"&&u.connector<u.wires.length-2&&Z||u.name!="swap"&&u.connector<u.wires.length-1&&Z)&&(G="\u2022"),W.matrix.length==8&&(G&&u.name=="cswap"&&u.connector<u.wires.length-2&&Z||u.name!="cswap"&&u.connector<u.wires.length-1&&Z)&&(G="\u2022"),G&&L.push(G),!G){G="~"+u.name,W.params.length&&u.options.params&&W.params.map(function(mt){angle=v.round(v.evaluate(u.options.params[mt],d),7),G+="_"+angle});var B="";B+="{";var ot=e.getRawGate(W,u.options),U=V.sort(),E=[];if(u.wires.map(function(mt){E.push(U.indexOf(mt))}),R-F+1>u.wires.length||u.wires[0]>u.wires[1]?p=r.transformMatrix(R-F+1,ot,E):p=ot,p.map(function(mt,K){K>0&&(B+=","),B+="{",mt.map(function(pt,qt){qt>0&&(B+=","),typeof pt!="object"?pt=v.complex(pt).toString():pt=pt.toString(),B+=pt}),B+="}"}),B+="}",u.connector==0){var T=l.gates.find(function(mt){return mt.id==G});T||l.gates.push({id:G,matrix:B});for(var tt=!1,I=0;I<L.length;I++)L[I]==G&&(tt=!0);tt?L.push(1):L.push(G)}else if(q<u.wires[0]){l.gates.push({id:G,matrix:B});var T=l.gates.find(function(K){return K.id==G});T||l.gates.push({id:G,matrix:B});for(var tt=!1,I=0;I<L.length;I++)L[I]==G&&(tt=!0);tt?L.push(1):L.push(G)}}}else{var X=[];if(N=!1,u.connector==0){var z=f.gates.find(function(mt){return mt&&mt[0]&&mt[0].name==u.name});if(!z){var J=u.wires[0];u.wires.map(function(mt){X.push(mt-J)}),f.registerGate(u.name,e.customGates[u.name]),f.appendGate(u.name,X)}L.push("~"+u.name)}else L.push(1)}}}l.cols.push(L)}if(!a){var rt=r.usedGates();rt.map(function(Y){var et=r.basicGates[Y];if(!et){var D=e.customGates[Y];if(D){var H=new g;for(customCol=0;customCol<f.numCols();customCol++)for(customWire=0;customWire<f.numGates();customWire++){var ut=f.getGateAt(customCol,customWire);ut&&ut.name==Y&&(customGateObj=f.decomposeGateAt(customCol,customWire),H.load(customGateObj))}l.gates.push({id:"~"+Y,circuit:H.exportQuirk(!0)})}}})}return l},g.prototype.exportCirq=function(a,e,t,n,s,r,o){var l={comment:a,decompose:e,versionStr:n,asJupyter:s,shots:r,exportTfq:o};return this.exportToCirq(l,t)},g.prototype.exportQSharp=function(a,e,t,n,s,r,o){var l={comment:a,decompose:e,versionStr:n,asJupyter:s,circuitName:r,indentDepth:o};return this.exportToQSharp(l,t)},g.prototype.exportQobj=function(a,e,t,n){var s={circuitName:a,experimentName:e,numShots:t};return this.exportToQobj(s,n)},g.prototype.importQobj=function(a,e){var t=this;if(this.init(),!a||!a.experiments||!a.experiments.length){e&&e([{msg:"Invalid input file: no experiments found."}]);return}var n=a.experiments[0],s=n.header||{};this.init(parseInt(s.n_qubits||0));var r={};if(s.creg_sizes&&s.creg_sizes.length)for(var o=0,l=0;l<s.creg_sizes.length;l++){var p=s.creg_sizes[l];if(p.length>1){var d=p[0]+"",f=parseInt(p[1]);this.createCreg(d,f);var h=(1<<o+f)-(1<<o);r[d]={mask:h,offset:o},o+=f}}function c(k,N){for(var W in r){var R=r[W];if(R.mask==k)return{creg:W,value:N>>R.offset}}}function m(k){var N=0;for(var W in t.cregs){var R=t.cregs[W];if(N+R.length>k)return{name:W,bit:k-N};N+=R.length}return null}n.instructions;for(var q={},u=0;u<n.instructions.length;u++){var Q=n.instructions[u];switch(Q.name){case"bfunc":{var _=c(parseInt(Q.mask),parseInt(Q.val));if(!_){var S="Invalid classical condition.";if(e){e([{msg:S}]);return}else throw new Error(S)}q[Q.register]=_}break;case"measure":for(var j=0;j<Q.qubits.length;j++){var O=Q.qubits[j],C=Q.memory[j],P=m(C);if(!P){var S="Invalid measurement destination.";if(e){e([{msg:S}]);return}else throw new Error(S)}var y={creg:P};this.appendGate("measure",O,y)}break;case"barrier":break;default:{var y={params:{},condition:{}},x=Q.name;switch(x){case"iden":x="id";break}var A=this.basicGates[x];if(!A){var S='Unknown gate "'+Q.name+'".';if(e){e([{msg:S}]);return}else throw new Error(S)}if(A.params&&A.params.length){if(!Q.params||!Q.params.length||Q.params.length!=A.params.length){var S='Invalid number of params for gate "'+Q.name+'".';if(e){e([{msg:S}]);return}else throw new Error(S)}for(var b=0;b<A.params.length;b++){var L=A.params[b];y.params[L]=Q.params[b]}}if(typeof Q.conditional<"u"){var _=q[Q.conditional];if(!_){var S="Invalid classical condition.";if(e){e([{msg:S}]);return}else throw new Error(S)}y.condition=_}this.appendGate(x,Q.qubits,y)}}}e&&e([])},g.prototype.exportTFQ=function(a,e,t,n,s,r){var o={comment:a,decompose:e,versionStr:n,asJupyter:s,shots:r};return this.exportToTFQ(o,t)},g.prototype.exportBraket=function(a,e,t,n,s,r,o,l){var p={comment:a,decompose:e,versionStr:n,asJupyter:s,shots:r,hybrid:o,indentDepth:l};return this.exportToBraket(p,t)},g.prototype.exportSVG=function(a,e){var t=e||{};return t.embedded=!!a,this.exportToSVG(t)},g.prototype.exportToSVG=function(t){var e=this,t=t||{};t.embedded=t.embedded||!1,t.cellWidth=t.cellWidth||40,t.cellHeight=t.cellHeight||40,t.hSpacing=t.hSpacing||28,t.vSpacing=t.vSpacing||34,t.blackboxPaddingX=t.blackboxPaddingX||2,t.blackboxPaddingY=t.blackboxPaddingY||2,t.blackboxLineColor=t.blackboxLineColor||"black",t.blackboxSelectedLineColor=t.blackboxSelectedLineColor||"black",t.wireColor=t.wireColor||"black",t.gateLineColor=t.gateLineColor||"black",t.gateSelectedLineColor=t.gateSelectedLineColor||"black",t.cWireColor=t.cWireColor||"silver",t.cWireSelectedColor=t.cWireSelectedColor||"silver",t.cArrowSize=t.cArrowSize||10,t.hWireColor=t.hWireColor||"black",t.wireWidth=t.wireWidth||1,t.wireTextHeight=t.wireTextHeight||8,t.wireTextDown=t.wireTextDown||16,t.wireMargin=t.wireMargin||20,t.wireLabelWidth=t.wireLabelWidth||40,t.dotRadius=t.dotRadius||5,t.paramTextHeight=t.paramTextHeight||6,t.selectionPaddingX=t.selectionPaddingX||4,t.selectionPaddingY=t.selectionPaddingY||4,t.selectionLineColor=t.selectionLineColor||"#2185D0",t.drawBlochSpheres=t.drawBlochSpheres||!1,typeof t.drawHybrid>"u"&&(t.drawHybrid=this.options?!!this.options.hybrid:!1);var n=function(M){var $=0;for(var gt in e.cregs){if(gt==M)return $;$++}return $},s=function(M){return t.wireLabelWidth+(t.cellWidth+t.hSpacing)*M+t.hSpacing},r=function(M){return(t.cellHeight+t.vSpacing)*M+t.vSpacing},o=this.numQubits,l=this.numCols(),p=this.cregCount(),d=l;t.drawBlochSpheres&&d++;var f=d;t.drawHybrid&&(d+=2);var h=s(d),c=s(f),m=(t.cellHeight+t.vSpacing)*(o+p+(t.drawHybrid?1:0))+t.vSpacing;(t.cellHeight+t.vSpacing)*(o+p)+t.vSpacing;var q=(t.cellHeight+t.vSpacing)*(o+p)+(t.vSpacing+t.cellHeight/2);function u(M,$,gt,nt){var it=(nt-90)*Math.PI/180;return{x:M+gt*Math.cos(it),y:$+gt*Math.sin(it)}}function Q(M,$,gt,nt,it){var st=u(M,$,gt,it),lt=u(M,$,gt,nt),at="0",ft=["M",st.x,st.y,"A",gt,gt,0,at,0,lt.x,lt.y].join(" ");return ft}var _=function(M){return(t.cellHeight+t.vSpacing)*M+(t.vSpacing+t.cellHeight/2)},S=function(M){return(t.cellHeight+t.vSpacing)*M+t.vSpacing},j=function(M){return(t.cellHeight+t.vSpacing)*(o+n(M))+(t.vSpacing+t.cellHeight/2)};function O(M,$,gt,nt,it){var st=t.cellWidth,lt=t.cellHeight,at="";return at+='<rect class="qc-gate-box" x="'+M+'" y="'+$+'" width="'+st+'" height="'+lt+'" stroke="'+(it?t.gateSelectedLineColor:t.gateLineColor)+'" fill="white" stroke-width="1" />',nt&&(at+='<text class="qc-gate-label" x="'+(M+st/2)+'" y="'+($+lt/2)+'" dominant-baseline="middle" text-anchor="middle" fill="'+(it?t.gateSelectedLineColor:t.gateLineColor)+'">'+nt+"</text>"),at}function C(M,$,gt,nt,it){var st=t.cellWidth*2,lt=t.cellHeight,at="";return at+='<rect class="qc-gate-rect" x="'+M+'" y="'+$+'" width="'+st+'" height="'+lt+'" stroke="'+t.gateLineColor+'" fill="white" stroke-width="1" />',nt&&(at+='<text class="qc-gate-label" x="'+(M+st/2)+'" y="'+($+lt/2)+'" dominant-baseline="middle" text-anchor="middle">'+nt+"</text>"),at}function P(M,$,gt,nt,it){var st=M+t.cellWidth/2,lt=$+t.cellHeight/2,at=t.cellWidth*.8,ft=t.cellHeight*.8,ht=M+(t.cellWidth-at)/2,Nt=$+(t.cellHeight-ft)/2,jt="";return jt+='<ellipse class="qc-gate-not" cx="'+st+'" cy="'+lt+'" rx="'+at/2+'" ry="'+ft/2+'" stroke="'+(it?t.gateSelectedLineColor:t.gateLineColor)+'" fill="white" stroke-width="1" />',nt&&(jt+='<text class="qc-gate-label" x="'+(ht+at/2)+'" y="'+(Nt+ft/2)+'" dominant-baseline="middle" text-anchor="middle">'+nt+"</text>"),jt}function y(M,$,gt,nt){var it=M+t.cellWidth/2,st=$+t.cellHeight/2,lt=t.cellWidth*.8,at=t.cellHeight*.8,ft=M+(t.cellWidth-lt)/2,ht=$+(t.cellHeight-at)/2,Nt="";return Nt+='<ellipse class="qc-gate-not" cx="'+it+'" cy="'+st+'" rx="'+lt/2+'" ry="'+at/2+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" fill="white" stroke-width="1" />',Nt+='<line class="qc-gate-not-line" x1="'+it+'" x2="'+it+'" y1="'+ht+'" y2="'+(ht+at)+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" stroke-width="1" />',Nt+='<line class="qc-gate-not-line" x1="'+ft+'" x2="'+(ft+lt)+'" y1="'+st+'" y2="'+st+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" stroke-width="1" />',Nt}function x(M,$,gt,nt){var it=t.cellWidth,st=t.cellHeight,lt=M+it/2,at=$+st/2,ft=st/5,ht="";return ht+='<rect class="qc-gate-box" x="'+M+'" y="'+$+'" width="'+it+'" height="'+st+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" fill="white" stroke-width="1" />',ht+='<path class="gc-gate-gauge-arc" d="'+Q(lt,at+ft,it/2.3,300,60)+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" fill="none" stroke-width="1" />',ht+='<line class="qc-gate-gauge-scale" x1="'+lt+'" x2="'+(M+it-ft)+'" y1="'+(at+ft)+'" y2="'+($+ft)+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" stroke-width="1" />',ht}function A(M,$,gt,nt){var it=t.cellWidth*.4,st=t.cellHeight*.4,lt=M+(t.cellWidth-it)/2,at=$+(t.cellHeight-st)/2,ft="";return ft+='<line class="qc-gate-x" x1="'+lt+'" x2="'+(lt+it)+'" y1="'+at+'" y2="'+(at+st)+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" stroke-width="1" />',ft+='<line class="qc-gate-x" x1="'+lt+'" x2="'+(lt+it)+'" y1="'+(at+st)+'" y2="'+at+'" stroke="'+(nt?t.gateSelectedLineColor:t.gateLineColor)+'" stroke-width="1" />',ft}function b(M,$,gt,nt){var it=t.cellWidth,st=t.cellHeight,lt=M+it/2,at=$+st/2,ft="";return ft+='<circle class="qc-gate-dot" cx="'+lt+'" cy="'+at+'" r="'+t.dotRadius+'" stroke="'+(nt?t.gateSelectedLineColor:t.wireColor)+'" fill="'+(nt?t.gateSelectedLineColor:t.wireColor)+'" stroke-width="1" />',ft}function L(M,$,gt,nt){var it=t.cellWidth,st=t.cellHeight,lt=M+it/2,at=$+st/2,ft="";return ft+='<circle class="qc-gate-ndot" cx="'+lt+'" cy="'+at+'" r="'+t.dotRadius+'" stroke="'+(nt?t.gateSelectedLineColor:t.wireColor)+'" fill="white" stroke-width="1" />',ft}function k(M,$,gt,nt,it,st,lt){var at="";switch(it!="box"&&st&&(at+=O(M,$,gt,"",lt)),it){case"box":at+=O(M,$,gt,nt,lt);break;case"rect":at+=C(M,$,gt,nt);break;case"circle":at+=P(M,$,gt,nt,lt);break;case"not":at+=y(M,$,gt,lt);break;case"x":at+=A(M,$,gt,lt);break;case"dot":at+=b(M,$,gt,lt);break;case"ndot":at+=L(M,$,gt,lt);break;case"gauge":at+=x(M,$,gt,lt);break}return at}function N(M,$,gt){var nt=e.basicGates[M.name]?e.basicGates[M.name].drawingInfo:null;nt||(nt=e.customGates[M.name]?e.customGates[M.name].drawingInfo:null);var it=!1,st=t&&t.selection&&t.selection.indexOf(M.id)>=0;for(nt||(M.wires.length==1?nt={connectors:["box"]}:(nt={connectors:[]},it=!0));nt.connectors.length<M.wires.length;)nt.connectors.push("box");var lt=Math.min.apply(null,M.wires),at=Math.max.apply(null,M.wires),ft=j(at),ht="";if(ht+='<g class="qc-gate-group" data-id="'+M.id+'" data-gate="'+M.name+'">',it){var Nt=s($)-t.blackboxPaddingX,jt=S(lt)-t.blackboxPaddingY,Jt=t.cellWidth+2*t.blackboxPaddingX,Xt=S(at)+t.cellHeight-jt+t.blackboxPaddingY,ee=Nt+Jt/2;ft=jt+Xt,ht+='<text class="qc-blackbox-label" x="'+ee+'" y="'+(jt-t.wireTextHeight-t.blackboxPaddingY*2)+'" dominant-baseline="hanging" text-anchor="middle" font-size="75%">'+(nt.label||M.name)+"</text>",ht+='<rect class="qc-gate-blackbox" x="'+Nt+'" y="'+jt+'" width="'+Jt+'" height="'+Xt+'" stroke="'+(st?t.blackboxSelectedLineColor:t.blackboxLineColor)+'" fill="transparent" stroke-width="1" />'}if(st){var Nt=s($)-t.selectionPaddingX,jt=S(lt)-t.selectionPaddingY,Jt=t.cellWidth+2*t.selectionPaddingX,Xt=S(at)+t.cellHeight-jt+t.selectionPaddingY,ee=Nt+Jt/2;ft=jt+Xt,ht+='<rect class="qc-gate-selection" x="'+Nt+'" y="'+jt+'" width="'+Jt+'" height="'+Xt+'" stroke="'+t.selectionLineColor+'" fill="transparent" stroke-dasharray="4" stroke-width="1" />'}if(lt!=at&&!it){var Ot=s($)+t.cellWidth/2,Ft=r(lt)+t.cellHeight/2,Tt=r(at)+t.cellHeight/2;ht+='<line class="qc-gate-link" x1="'+Ot+'" x2="'+Ot+'" y1="'+Ft+'" y2="'+Tt+'" stroke="'+(st?t.gateSelectedLineColor:t.wireColor)+'" stroke-width="1" />'}var ne=Math.max.apply(null,M.wires);if(M.wires.map(function(It,Vt){switch(nt.connectors[Vt]){case"box":{var zt=s($),At=r(It);ht=ht+O(zt,At,M.name,it?St(Vt,o):nt.label||M.name,st),!it&&It==at&&(ft=At+t.cellHeight)}break;case"circle":{var zt=s($),At=r(It);if(ht=ht+P(zt,At,M.name,it?St(Vt,o):nt.label||M.name,st),!it&&It==at){var Zt=t.cellHeight*.8;ft=At+Zt+(t.cellHeight-Zt)/2}}break;case"not":{var Wt=s($),Mt=r(It);if(ht=ht+y(Wt,Mt,M.name,st),!it&&It==at){var Zt=t.cellHeight*.8;ft=Mt+Zt+(t.cellHeight-Zt)/2}}break;case"x":{var Wt=s($),Mt=r(It);ht=ht+A(Wt,Mt,M.name,st),!it&&It==at&&(ft=_(at))}break;case"dot":{var Wt=s($),Mt=r(It);ht=ht+b(Wt,Mt,M.name,st),!it&&It==at&&(ft=_(at)+t.dotRadius)}break;case"ndot":{var Wt=s($),Mt=r(It);ht=ht+L(Wt,Mt,M.name,st),!it&&It==at&&(ft=_(at)+t.dotRadius)}break;case"gauge":{var zt=s($),At=r(It);ht=ht+x(zt,At,M.name,st),!it&&It==at&&(ft=At+t.cellHeight)}break}if(M.options&&M.options.params&&It==ne){var zt=s($),At=r(It),se=zt+t.cellWidth/2,Ht="",ae=0;for(var oe in M.options.params){Ht&&(Ht+=", ");var Dt=M.options.params[oe];typeof Dt=="string"&&Dt.match(/^[\+\-]?\d*\.?\d+(?:[Ee][\+\-]?\d+)?$/)&&(Dt=parseFloat(Dt)),typeof Dt=="number"&&(Dt=v.round(Dt,3)),Ht+=Dt,ae++}Ht.length>26&&(Ht="("+ae+" params)"),ht+='<text class="qc-gate-params" x="'+se+'" y="'+(At+t.cellHeight+t.paramTextHeight)+'" dominant-baseline="hanging" text-anchor="middle" font-size="75%">'+Ht+"</text>"}}),M.name=="measure"&&M.options&&M.options.creg&&M.options.creg.name){var Ot=s($)+t.cellWidth/2,Ft=ft,Tt=j(M.options.creg.name);ht+='<line class="qc-gate-link-c" x1="'+Ot+'" x2="'+Ot+'" y1="'+Ft+'" y2="'+Tt+'" stroke="'+(st?t.cWireSelectedColor:t.cWireColor)+'" stroke-width="1" />',ht+='<line class="qc-gate-link-c" x2="'+Ot+'" x1="'+(Ot-t.cArrowSize/2)+'" y1="'+(Tt-t.cArrowSize)+'" y2="'+Tt+'" stroke="'+(st?t.cWireSelectedColor:t.cWireColor)+'" stroke-width="1" />',ht+='<line class="qc-gate-link-c" x2="'+Ot+'" x1="'+(Ot+t.cArrowSize/2)+'" y1="'+(Tt-t.cArrowSize)+'" y2="'+Tt+'" stroke="'+(st?t.cWireSelectedColor:t.cWireColor)+'" stroke-width="1" />',ht+='<text class="qc-wire-label" x="'+Ot+'" y="'+(Tt+t.wireTextHeight)+'" dominant-baseline="hanging" text-anchor="middle" font-size="75%">'+M.options.creg.bit+"</text>"}if(M.options&&M.options.condition&&M.options.condition.creg){var Ot=s($)+t.cellWidth/2,Ft=ft,Tt=j(M.options.condition.creg);ht+='<line class="qc-gate-link-c" x1="'+Ot+'" x2="'+Ot+'" y1="'+Ft+'" y2="'+Tt+'" stroke="'+(st?t.cWireSelectedColor:t.cWireColor)+'" stroke-width="1" />',ht+='<circle class="qc-gate-dot-c" cx="'+Ot+'" cy="'+Tt+'" r="'+t.dotRadius+'" stroke="'+(st?t.cWireSelectedColor:t.cWireColor)+'" fill="'+(st?t.cWireSelectedColor:t.cWireColor)+'" stroke-width="1" />',ht+='<text class="qc-wire-label" x="'+Ot+'" y="'+(Tt+t.wireTextHeight)+'" dominant-baseline="hanging" text-anchor="middle" font-size="75%">== '+M.options.condition.value+"</text>"}return ht+="</g>",ht}function W(M,$){var gt="",nt=t.cellWidth+t.hSpacing,it=t.cellHeight+t.vSpacing,st=s(M)-t.hSpacing,lt=r($)-t.vSpacing;return $==o&&(it=t.vSpacing),M==l&&(nt=t.hSpacing),gt+='<rect class="qc-gate-placeholder" data-row="'+$+'" data-col="'+M+'" x="'+st+'" y="'+lt+'" width="'+nt+'" height="'+it+'" stroke="none" fill="transparent" stroke-width="0" />',gt}function R(M,$,gt){var nt="",it=t.cellWidth,st=t.cellHeight,lt=s($),at=r(gt);return nt+='<rect class="qc-gate-handle" data-id="'+M.id+'" data-gate="'+M.name+'" data-row="'+gt+'" data-col="'+$+'" x="'+lt+'" y="'+at+'" width="'+it+'" height="'+st+'" stroke="none" fill="transparent" stroke-width="0" />',nt}function F(M,$,gt,nt){var it="",st=t.cellWidth,lt=t.cellHeight,at=s(M),ft=r($);return it+='<g class="'+gt+'" data-row="'+$+'">',it+='<rect class="qc-canvas-box" x="'+at+'" y="'+ft+'" width="'+st+'" height="'+lt+'" stroke="transparent" fill="white" stroke-width="1" />',it+='<foreignObject class="qc-canvas-object" x="'+at+'" y="'+ft+'" width="'+st+'" height="'+lt+'">',it+='<div style="position:relative;">',it+='<canvas id="'+nt+"-"+$+'" class="'+nt+'" width="'+st+'" height="'+lt+'">',it+="</canvas>",it+="</div>",it+="</foreignObject>",it+="</g>",it}function V(M){return M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}if(t.gateGallery||t.gateGalleryRaw||t.customGateGallery){var G=[];if(t.gateGallery||t.gateGalleryRaw){var Z=[];for(var B in this.basicGates){var ot=this.basicGates[B],U=JSON.parse(JSON.stringify(ot.drawingInfo||{connectors:["box"]}));if(U.connectors){var E=U.label||B,T=U.connectors?U.connectors[U.connectors.length-1]:"box";t.gateGallery&&(T=="x"||T=="dot")&&(T="box");var tt=E+"|"+T;if(Z.indexOf(tt)<0&&B!="ccx"){Z.push(tt);var I="";t.embedded||(I+='<?xml version="1.0"?>',I+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),I+='<svg class="qc-gate-gallery-item" data-gate="'+V(B)+'" data-content="'+V(ot.description)+'" width="'+t.cellWidth+'" height="'+t.cellHeight+'" version="1.1" xmlns="http://www.w3.org/2000/svg">',I=I+k(0,0,B,E,T,!!t.gateGallery,!1),I+="</svg>",t.gateGallery?G.push(I):G.push({name:B,svg:I})}}}var X="";t.embedded||(X+='<?xml version="1.0"?>',X+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),X+='<svg class="qc-gate-gallery-item" data-gate="dot" data-content="Control" width="'+t.cellWidth+'" height="'+t.cellHeight+'" version="1.1" xmlns="http://www.w3.org/2000/svg">',X=X+k(0,0,"dot","dot","dot",!!t.gateGallery,!1),X+="</svg>",t.gateGallery?G.push(X):G.push({name:"dot",svg:X});var z="";t.embedded||(z+='<?xml version="1.0"?>',z+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),z+='<svg class="qc-gate-gallery-item" data-gate="ndot" data-content="Control" width="'+t.cellWidth+'" height="'+t.cellHeight+'" version="1.1" xmlns="http://www.w3.org/2000/svg">',z=z+k(0,0,"ndot","ndot","ndot",!!t.gateGallery,!1),z+="</svg>",t.gateGallery?G.push(z):G.push({name:"dot",svg:z})}if(t.customGateGallery)for(var B in this.customGates){var I="";t.embedded||(I+='<?xml version="1.0"?>',I+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),I+='<svg class="qc-custom-gate-gallery-item" data-gate="'+B+'" width="'+t.cellWidth*2+'" height="'+t.cellHeight+'" version="1.1" xmlns="http://www.w3.org/2000/svg">',I=I+k(0,0,B,B,"rect",!1,!1),I+="</svg>",G.push(I)}return G}else{var I="";if(t.embedded||(I+='<?xml version="1.0"?>',I+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),I+='<svg class="qc-circuit" width="'+h+'" height="'+m+'" version="1.1" xmlns="http://www.w3.org/2000/svg">',t.placeholders)for(var J=0;J<=l;J++)for(var rt=0;rt<=this.numQubits;rt++)I+=W(J,rt);for(var rt=0;rt<o;rt++){var Y=_(rt),et="0";t.customGate&&(et=St(rt,o)),I+='<text class="qc-wire-init" x="0" y="'+Y+'" dominant-baseline="middle" text-anchor="start">|'+et+"&#x27E9;</text>",I+='<line class="qc-wire" x1="'+t.wireMargin+'" x2="'+c+'" y1="'+Y+'" y2="'+Y+'" stroke="'+t.wireColor+'" stroke-width="'+t.wireWidth+'" />',I+='<text class="qc-wire-label" x="'+t.wireMargin+'" y="'+(Y-t.wireTextHeight*2)+'" dominant-baseline="hanging" text-anchor="start" font-size="75%">q'+rt+"</text>"}for(var D in this.cregs){var Y=j(D);I+='<text class="qc-wire-init" x="0" y="'+Y+'" dominant-baseline="middle" text-anchor="start">0</text>',I+='<line class="qc-wire-c" x1="'+t.wireMargin+'" x2="'+c+'" y1="'+Y+'" y2="'+Y+'" stroke="'+t.cWireColor+'" stroke-width="'+t.wireWidth+'" />',I+='<text class="qc-wire-label" x="'+t.wireMargin+'" y="'+(Y-t.wireTextHeight*2)+'" dominant-baseline="hanging" text-anchor="start" font-size="75%">'+D+"</text>"}for(var J=0;J<l;J++)for(var rt=0;rt<this.numQubits;rt++){var ot=this.getGateAt(J,rt);ot&&ot.connector==0&&(I+=N(ot,J))}for(var J=0;J<l;J++)for(var rt=0;rt<this.numQubits;rt++){var ot=this.getGateAt(J,rt);ot&&t.placeholders&&(I+=R(ot,J,rt))}if(t.drawBlochSpheres){var H=d-1;t.drawHybrid&&(H-=2);for(var rt=0;rt<this.numQubits;rt++)I+=F(H,rt,"qc-bloch-group","qc-bloch-canvas")}if(t.drawHybrid){var H=d-2,ut=H,mt=s(ut)+t.blackboxPaddingX,K=S(0)+t.blackboxPaddingY,pt=t.cellWidth-2*t.blackboxPaddingX,qt=S(o+p-1)+t.cellHeight-K-t.blackboxPaddingY,dt=mt+pt/2,bt=K+qt/2;cLinkTopY=K+qt,I+='<rect class="qc-cost-h" x="'+mt+'" y="'+K+'" width="'+pt+'" height="'+qt+'" stroke="'+t.hWireColor+'" fill="white" stroke-width="1" rx="8" />',I+='<text class="qc-label-h" x="'+dt+'" y="'+bt+'" dominant-baseline="middle" text-anchor="middle" fill="'+t.hWireColor+'" transform="rotate(-90, '+dt+", "+bt+')">Cost</text>';var Gt=s(ut+1)+t.blackboxPaddingX,xt=Gt+pt/2;I+='<marker id="qc-arrow-head" orient="auto" markerWidth="8" markerHeight="10" refX="8" refY="5"><path d="M0,0 V10 L8,5 Z" fill="'+t.hWireColor+'"/></marker>',I+='<line class="qc-link-h" x1="'+(mt+pt)+'" x2="'+Gt+'" y1="'+bt+'" y2="'+bt+'" stroke="'+t.hWireColor+'" stroke-width="'+t.wireWidth+'" marker-end="url(#qc-arrow-head)" />',I+='<rect class="qc-optimizer-h" x="'+Gt+'" y="'+K+'" width="'+pt+'" height="'+qt+'" stroke="'+t.hWireColor+'" fill="white" stroke-width="1" rx="8" />',I+='<text class="qc-label-h" x="'+xt+'" y="'+bt+'" dominant-baseline="middle" text-anchor="middle" fill="'+t.hWireColor+'" transform="rotate(-90, '+xt+", "+bt+')">Optimizer</text>';var kt=xt,Qt=cLinkTopY,Ut=q;I+='<line class="qc-wire-h" x1="'+kt+'" x2="'+kt+'" y1="'+Qt+'" y2="'+Ut+'" stroke="'+t.hWireColor+'" stroke-dasharray="4" stroke-width="1" />';var wt=0,vt=this.findGlobalParams();if(vt.globalParams.length){wt=s(vt.cells[0][0])+t.cellWidth+t.hSpacing/2;for(var ct=0;ct<vt.cells.length;ct++){var Ct=vt.cells[ct],yt=s(Ct[0])+t.cellWidth+t.hSpacing/2,_t=r(Ct[1])+t.cellHeight+t.vSpacing-t.paramTextHeight/2,Pt=q,Rt=s(Ct[0])+t.cellWidth,Et=r(Ct[1])+t.cellHeight+t.paramTextHeight*2+4;I+='<line class="qc-wire-h" x1="'+yt+'" x2="'+yt+'" y1="'+Pt+'" y2="'+_t+'" stroke="'+t.hWireColor+'" stroke-dasharray="4" stroke-width="1" />',I+='<line class="qc-wire-h" x1="'+yt+'" x2="'+Rt+'" y1="'+_t+'" y2="'+Et+'" stroke="'+t.hWireColor+'" stroke-dasharray="4" stroke-width="1" marker-end="url(#qc-arrow-head)" />'}var Y=q;I+='<line class="qc-wire-h" x1="'+wt+'" x2="'+xt+'" y1="'+Y+'" y2="'+Y+'" stroke="'+t.hWireColor+'" stroke-dasharray="4" stroke-width="'+t.wireWidth+'" />'}else{wt=s(f+1);var Y=q;I+='<line class="qc-wire-h" x1="'+xt+'" x2="'+wt+'" y1="'+Y+'" y2="'+Y+'" stroke="'+t.hWireColor+'" stroke-dasharray="4" stroke-width="'+t.wireWidth+'"  marker-end="url(#qc-arrow-head)" />',I+='<text class="qc-warning-params-h" x="'+(wt-5)+'" y="'+Y+'" dominant-baseline="middle" text-anchor="end">(no global params)</text>'}}I+="</svg>"}return I},g.prototype.exportToQiskit=function(a,e,t,n){a=a||{};var s=a.comment,r=a.decompose,o=a.versionStr,l=a.providerName,p=a.backendName,d=a.asJupyter,f=a.shots,h=a.hybrid;typeof h>"u"&&(h=this.options?!!this.options.hybrid:!1);var c=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"",m=this;l=l||"Aer",p=p||"",l=="Aer"&&(p||(h&&c.indexOf("state")>=0?p="statevector_simulator":p="qasm_simulator"),p=="aer_simulator"&&(p="qasm_simulator"),p=="aer_simulator_statevector"&&(p="statevector_simulator")),l=="IONQ"&&(p||(p="ionq_simulator")),f=f||1024;var q=new g;q.load(this.save(r));var u="";if(s){var Q=(s||"").split(`
`);Q.map(function(K){K.length>=1&&K[0]!="#"&&(u+="# "),u+=K,u+=`
`})}var _=function(K,pt){if(K.isSymbolNode){var qt=["pi","sin","cos","tan","asin","acos","atan"];if(qt.indexOf(K.name)>=0)return"np."+K.name;var dt=K.name;if(pt.replaceVars&&typeof pt.replaceVars[dt]<"u")return dt=pt.replaceVars[dt],m.params.indexOf(dt)>=0&&h?"params["+m.params.indexOf(dt)+"]":dt;if(m.params.indexOf(K.name)>=0&&h)return"params["+m.params.indexOf(K.name)+"]"}},S=function(K,pt){var qt="",dt=K.split(`
`),bt=-1;dt.map(function(kt){var Qt=kt.search(/\S/);Qt>=0&&(bt<0||Qt<bt)&&(bt=Qt)}),bt<0&&(bt=0);var Gt="";if(bt<pt.length)for(var xt=0;xt<pt.length-bt;xt++)Gt+=" ";return dt.map(function(kt){qt+=Gt+kt+`
`}),qt};if(e){if(u+="def "+e+"(qc",q.params&&q.params.length)for(var j=0;j<q.params.length;j++)u+=", ",u+=q.params[j];for(var O=0;O<q.numQubits;O++)u+=", ",u+=St(O,q.numQubits);u+=`):
`}else if(!t){var C=q.usedGates();u+=`from qiskit import QuantumCircuit, QuantumRegister, ClassicalRegister
`;var P=!1,y=!1;switch(l){case"Aer":u+="from qiskit import execute, "+l+`
`,h&&c.indexOf("state")>=0&&p!="statevector_simulator"&&(u+=`from qiskit_experiments.library import StateTomography
`);break;case"IBMQ":u+="from qiskit import execute, "+l+`
from qiskit.providers.ibmq import least_busy
`,h&&c.indexOf("state")>=0&&(u+=`from qiskit_experiments.library import StateTomography
`);break;case"IONQ":P=!0,u+=`from qiskit_ionq import IonQProvider
`,h&&c.indexOf("state")>=0&&(u+=`from qiskit_experiments.library import StateTomography
`);break}(C.indexOf("ms")>=0||C.indexOf("gpi")>=0||C.indexOf("gpi2")>=0)&&(P=!0,u+=`from qiskit_ionq import GPIGate, GPI2Gate, MSGate
`),P&&(u+=`from qiskit import transpile
`),h&&(u+=`from scipy.optimize import minimize
`,u+=`from collections import Counter
`),u+=`import numpy as np
`,u+=`
`;var x="";switch(l){case"Aer":u+=x+"backend = Aer.get_backend('"+p+`')
`,u+=`
`;break;case"IBMQ":u+=x+`IBMQ.load_account()
`,u+=x+`provider = IBMQ.get_provider(hub="ibm-q", group="open", project="main")
`,p?u+=x+'backend = provider.get_backend("'+p+`")
`:(u+=x+`backends = provider.backends()
`,u+=x+`backend = least_busy(backends)
`),u+=`
`;break;case"IONQ":{var A=["measure","delay","barrier","reset","snapshot","ms","gpi2","gpi"];y=!0,C.map(function(K){A.indexOf(K)<0&&(y=!1)}),u+=x+`# Requires QISKIT_IONQ_API_TOKEN environment variable to be set
`,u+=x+`provider = IonQProvider()
`,u+=x+'backend = provider.get_backend("'+p+'"',y&&(u+=', gateset="native"'),u+=`)

`}break}f&&(u+="shots = "+f+`
`,u+=`
`);var b=this.options&&this.options.params?this.options.params:{};if(this.params.length){for(var O=0;O<this.params.length;O++){var L=this.params[O],k=v.parse(b[L]),N=k.toString({handler:_});u+=L+" = "+N+`
`}u+=`
`}h&&(u+="tolerance = "+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.tolerance&&this.options.hybridOptions.tolerance||"0.001")+`
`,u+=`
`),r||C.map(function(K){var pt=q.basicGates[K];if(!pt){var qt=m.customGates[K];if(qt){var dt=new g;dt.load(qt);var bt={comment:"",decompose:!0,versionStr:o,providerName:"",backendName:!1,asJupyter:!1,shots:!1,hybrid:null};u+=dt.exportToQiskit(bt,K,t,n)}}}),h&&(x="  ",u+=`def objective_function(params):
`),u+=x+`qc = QuantumCircuit()
`,u+=`
`,u+=x+"q = QuantumRegister("+q.numQubits+`, 'q')
`;for(var W in this.cregs)u+=x+W+" = ClassicalRegister("+(this.cregs[W].length||1)+", '"+W+`')
`;u+=`
`,u+=x+`qc.add_register(q)
`;for(var W in this.cregs)u+=x+"qc.add_register("+W+`)
`;u+=`
`}for(var R=q.numCols(),F=0;F<R;F++)for(var V=0;V<this.numQubits;V++){var G=q.getGateAt(F,V),Z=null,B=null,ot=null;if(G&&G.connector==0){ot=G.options&&G.options.condition&&G.options.condition.creg?G.options.condition:null;var U=q.getGateDef(G.name);if(U&&U.exportInfo&&!y&&(U.exportInfo.qiskit&&U.exportInfo.qiskit.replacement?(Z=U.exportInfo.qiskit.replacement,Z.map(function(K){var pt=new g;if(G.options&&G.options.params){var qt=Object.keys(G.options.params),dt=Object.keys(K.params);qt.map(function(Gt){dt.indexOf(Gt)>-1&&(K.params[Gt]=G.options.params[Gt])})}pt.addGate(K.name,F,G.wires,{params:K.params,condition:ot});var bt={comment:"",decompose:!1,versionStr:!1,providerName:!1,backendName:!1,asJupyter:!1,shots:!1,hybrid:null};u+=S(pt.exportToQiskit(bt,!1,!0,!!e||n),x)})):U.exportInfo.qiskit&&U.exportInfo.qiskit.equivalent&&(B=U.exportInfo.qiskit.equivalent,B.map(function(K){var pt=new g,qt=K.wires.length>1?G.wires:G.wires[K.wires[0]],dt={};if(K.params){var bt={};if(G.options&&G.options.params)for(var Gt in G.options.params){var xt=v.parse(G.options.params[Gt]),kt=xt.toString({handler:_});bt[Gt]=kt}for(var Qt in K.params){var xt=v.parse(K.params[Qt]),kt=xt.toString({handler:_,replaceVars:bt});dt[Qt]=kt}}pt.addGate(K.name,F,qt,{params:dt,condition:ot});var Ut={comment:"",decompose:!1,versionStr:!1,providerName:!1,backendName:!1,asJupyter:!1,shots:!1,hybrid:null};u+=S(pt.exportToQiskit(Ut,!1,!0,!!e||n),x)}))),!Z&&!B&&(e||n||h)&&(u+="  "),!Z&&!B){var E=G.name,T=G.options&&G.options.params?G.options.params:{};p=="statevector_simulator"&&E=="measure"&&h&&(u+="# "),this.basicGates[E]&&(u+="qc."),U&&U.exportInfo&&U.exportInfo.qiskit&&U.exportInfo.qiskit.name?E=U.exportInfo.qiskit.name:E=G.name;var tt=!1,I=!1;E=="ms"&&(tt=!0,I=!0,E="MSGate"),E=="gpi"&&y&&(tt=!0,I=!0,E="GPIGate"),E=="gpi2"&&y&&(tt=!0,I=!0,E="GPI2Gate"),tt&&(u+="append("),u+=E+"(";var X=0;if(T){var U=this.basicGates[G.name];if(U||(U=this.customGates[G.name],u+="qc",X++),U){var z=U.params||[],J=z.length;if(J){for(var rt=0;rt<J;rt++){X>0&&(u+=", ");var Y=z[rt];if(T[Y]||T[Y].toString()){var k=v.parse(T[Y]),et=k.toString({handler:_});I&&(et="("+et+") / (2*np.pi)"),u+=et}X++}E=="cu"&&!T.gamma&&(u+=", 0",X++)}}}if(tt){X&&(u+="), "),u+="[";for(var D=0;D<G.wires.length;D++)D>0&&(u+=", "),e||n?u+=St(G.wires[D],q.numQubits):u+=G.wires[D],X++;u+="]"}else for(var D=0;D<G.wires.length;D++)X>0&&(u+=", "),e||n?u+=St(G.wires[D],q.numQubits):u+="q["+G.wires[D]+"]",X++;E=="measure"&&G.options&&G.options.creg&&(X>0&&(u+=", "),u+=G.options.creg.name+"["+G.options.creg.bit+"]",X++),u+=")",G.options&&G.options.condition&&G.options.condition.creg&&(u+=".c_if("+G.options.condition.creg+", "+G.options.condition.value+")"),u+=`
`}}}if(!t){if(e)u+=`
`;else{u+=`
`,P&&(u+=x+`qc = transpile(qc, backend)
`);var x="";if(h&&(x="  "),l=="Aer"){var H="";H+=x+"job = execute(qc, backend=backend",f&&(H+=", shots=shots"),H+=`)
`,H+=x+`job_result = job.result()
`,h?(p=="statevector_simulator"?(u+=H,u+=x+`state = job_result.get_statevector(qc).data
`,u+=`
`):c.indexOf("state")>=0?(u+=x+`qst = StateTomography(qc)
`,u+=x+`qst_analysis = qst.run(backend).block_for_results()
`,u+=x+`density = qst_analysis.analysis_results("state").value
`,u+=x+`state = np.diag(density)
`):(u+=H,u+=x+`counts = Counter(job_result.get_counts(qc))
`,u+=`
`),c.trim()||(c=`# CALCULATE COST HERE
cost = 0`),u+=S(c,x),u+=`
`,u+=x+`return cost
`):(u+=H,u+=x+`print(job_result.get_counts(qc))
`)}if(l=="IBMQ"){var H="";H+=x+"job = execute(qc, backend=backend",f&&(H+=", shots=shots"),H+=`)
`,H+=x+`job_result = job.result()
`,h?(c.indexOf("state")>=0?(u+=x+`qst = StateTomography(qc)
`,u+=x+`qst_analysis = qst.run(backend).block_for_results()
`,u+=x+`density = qst_analysis.analysis_results("state").value
`,u+=x+`state = np.diag(density)
`,u+=`
`):(u+=H,u+=x+`counts = Counter(job_result.get_counts(qc))
`,u+=`
`),c.trim()||(c=`# CALCULATE COST HERE
cost = 0`),u+=S(c,x),u+=`
`,u+=x+`return cost
`):(u+=H,u+=x+`print(job_result.get_counts(qc))
`)}if(l=="IONQ"){var H="";H+=x+"job = backend.run(qc",f&&(H+=", shots=shots"),H+=`)
`,H+=x+`job_result = job.result()
`,h?(c.indexOf("state")>=0?(u+=x+`qst = StateTomography(qc)
`,u+=x+`qst_analysis = qst.run(backend).block_for_results()
`,u+=x+`density = qst_analysis.analysis_results("state").value
`,u+=x+`state = np.diag(density)
`):(u+=H,u+=x+`counts = Counter(job.get_counts())
`,u+=`
`),c.trim()||(c=`# CALCULATE COST HERE
cost = 0`),u+=S(c,x),u+=`
`,u+=x+`return cost
`):(u+=H,u+=x+`print(job.get_counts())
`)}if(h){var ut="";this.params.map(function(pt,qt){qt>0&&(ut+=", "),ut+=pt}),u+=`
`,u+="params = np.array(["+ut+`])
`,u+=`
`,u+='minimum = minimize(objective_function, params, method="'+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.optimizer?this.options.hybridOptions.optimizer:"Powell")+`", tol=tolerance)
`,u+=`print("cost:", minimum.fun, "params:", minimum.x)
`}}if(d){var mt={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:u,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(mt)}}return u},g.prototype.exportToQuEST=function(a,e,t){a=a||{};var n=a.comment,s=a.decompose,r=this;t=t||[];var l=null,o=["unitary","controlledUnitary"],l=new g;l.load(this.save(s));var p="";if(n){var d=(n||"").split(`
`);d.map(function(N){N.length>=2&&N[0]!="/"&&N[1]!="/"&&(p+="// "),p+=N,p+=`
`})}for(var f=0;f<this.numQubits;f++)for(var h=this.gates[f],c=0;c<h.length;c++){var m=h[c];if(!(!m||!this.basicGates[m.name])&&this.basicGates[m.name].exportInfo&&this.basicGates[m.name].exportInfo.quest){var q=this.basicGates[m.name].exportInfo.quest.name;if(t.includes(m.name))continue;(o.includes(q)||this.basicGates[m.name].exportInfo.quest.func)&&t.push(m.name)}}if(e){p+="Qureg "+e+"(Qureg qubits";for(var f=0;f<l.numQubits;f++)p+=", const int q",p+=f;if(l.params&&l.params.length)for(var f=0;f<l.params.length;f++)p+=", double "+l.params[f];p+=`) {
`}else{p+=`#include <math.h>
#include "QuEST.h"

`,p+=`#ifndef M_PI
#define M_PI 3.14159265
#endif

`;var u=[],Q=l.usedGates();s||Q.map(function(N){var W=l.basicGates[N];if(!W){var R=r.customGates[N];if(R){var F=new g;F.load(R);var V={comment:"",decompose:!1};u.push(F.exportToQuEST(V,N,t))}}});for(var f=0;f<t.length;f++){var _=t[f],q=this.basicGates[_].exportInfo.quest.name;switch(q){case"unitary":case"controlledUnitary":{matrix=this.basicGates[_].exportInfo.quest.matrix;var S=this.basicGates[_].exportInfo.quest.params;if(p+="void "+_+"(Qureg qubits, const int q",q=="controlledUnitary"&&(p+="1, const int q2"),S)for(var c=0;c<S.length;c++)p+=", double "+S[c];p+=`) {
`,p+=`    ComplexMatrix2 u;
`,p+="    u.r0c0 = (Complex) {.real="+matrix[0][0][0]+", .imag= "+matrix[0][0][1]+`};
`,p+="    u.r0c1 = (Complex) {.real="+matrix[0][1][0]+", .imag= "+matrix[0][1][1]+`};
`,p+="    u.r1c0 = (Complex) {.real="+matrix[1][0][0]+", .imag= "+matrix[1][0][1]+`};
`,p+="    u.r1c1 = (Complex) {.real="+matrix[1][1][0]+", .imag= "+matrix[1][1][1]+`};
`,p+="    "+q+"(qubits, q",q=="controlledUnitary"&&(p+="1, q2"),p+=`, u);
}

`}break;default:p+=this.basicGates[_].exportInfo.quest.func+`

`;break}}for(var f=0;f<u.length;f++)p+=u[f];p+=`int main(int argc, char *argv[]) {
`,p+=`    QuESTEnv env = createQuESTEnv();
`,p+="    Qureg qubits = createQureg("+l.numQubits+`, env);
`,p+="    int measured["+l.numQubits+`];

`}p+=`
`;for(var j=l.numCols(),O=0;O<j;O++)for(var C=0;C<this.numQubits;C++){var m=l.getGateAt(O,C);if(m&&m.connector==0){m.options&&m.options.condition&&m.options.condition.creg&&(p+="if("+m.options.condition.creg+"=="+m.options.condition.value+`) {
`);var _=m.name,P=m.options&&m.options.params?m.options.params:{},y=this.basicGates[_];if(_=="measure")p+="    measured["+m.wires[0]+"] = measure(qubits, "+m.wires[0];else if(y){var q=y.exportInfo.quest.name,S=y.exportInfo.quest.params;o.includes(q)?p+="    "+_+"(qubits":p+="    "+q+"(qubits";for(var x=0;x<m.wires.length;x++)e?p+=", q"+m.wires[x]:p+=", "+m.wires[x];if(S)switch(q){case"compactUnitary":p+=", "+S.alpha,p+=", "+S.beta;break;case"phaseShift":case"controlledPhaseShift":S.theta&&(p+=", "+S.theta);break}}else{y=this.customGates[_],p+="    qubits = "+_+"(qubits";for(var x=0;x<m.wires.length;x++)p+=", "+m.wires[x]}if(P){var y=this.basicGates[_];if(y||(y=this.customGates[_]),y){var A=y.params||[],b=A.length;if(b)for(var L=0;L<b;L++){var k=A[L];p+=", "+P[k]}}}p+=`);
`,m.options&&m.options.condition&&m.options.condition.creg&&(p+=`}
`)}}return e?p+=`
    return qubits;
}

`:(p+=`
    destroyQureg(qubits, env);
`,p+=`    destroyQuESTEnv(env);
`,p+=`    return 0;
}
`),p},g.prototype.exportToQASM=function(a,e,t,n){a=a||{};var s=a.comment,r=a.decompose,o=a.compatibilityMode,l=this,p=this.options&&this.options.params?this.options.params:{},d=function(G,Z){if(G.isSymbolNode){var B=G.name;if(Z.replaceVars&&typeof Z.replaceVars[B]<"u"){var B=Z.replaceVars[B];return!o&&l.params.indexOf(B)>=0?"("+p[B]+")":"("+B+")"}if(!o&&l.params.indexOf(G.name)>=0)return p[G.name]}},f=null,f=new g;f.load(this.save(r));var h="";if(s){var c=(s||"").split(`
`);c.map(function(G){G.length>=2&&G[0]!="/"&&G[1]!="/"&&(h+="// "),h+=G,h+=`
`})}if(e){if(h+="gate "+e,f.params&&f.params.length){h+="(";for(var m=0;m<f.params.length;m++)m>0&&(h+=", "),h+=f.params[m];h+=")"}for(var q=0;q<f.numQubits;q++)q==0&&(h+=" "),q>0&&(h+=", "),h+=St(q,f.numQubits);h+=`
{
`}else if(!t){h+=`OPENQASM 2.0;
`,h+=`include "qelib1.inc";
`,h+="qreg q["+f.numQubits+`];
`;for(var u in f.cregs)h+="creg "+u+"["+(f.cregs[u].length||1)+`];
`;var Q=f.usedGates();r||Q.map(function(G){var Z=f.basicGates[G];if(!Z){var B=l.customGates[G];if(B){var ot=new g;ot.load(B);var U={comment:"",decompose:!1,compatibilityMode:o};h+=ot.exportToQASM(U,G,!1,!1)}}})}for(var _=f.numCols(),S=0;S<_;S++)for(var j=0;j<f.numQubits;j++){var O=f.getGateAt(S,j),C=null,P=null;if(O&&O.connector==0){var y=O.name;if(!o){var x=f.getGateDef(O.name);x&&x.exportInfo&&(x.exportInfo.qasm&&x.exportInfo.qasm.name?y=x.exportInfo.qasm.name:x.exportInfo.qasm&&x.exportInfo.qasm.replacement?(C=x.exportInfo.qasm.replacement,C.map(function(G){var Z=new g;if(Z.cregs=JSON.parse(JSON.stringify(l.cregs)),O.options&&O.options.params){var B=Object.keys(O.options.params),ot=Object.keys(G.params);B.map(function(T){ot.indexOf(T)>=0&&(G.params[T]=O.options.params[T])})}var U=O.options&&O.options.condition?O.options.condition:{};Z.addGate(G.name,S,O.wires,{params:G.params,condition:U});var E={comment:"",decompose:!1,compatibilityMode:o};h+=Z.exportToQASM(E,!1,!0,!!e||n)})):x.exportInfo.qasm&&x.exportInfo.qasm.equivalent&&(P=x.exportInfo.qasm.equivalent,P.map(function(G){var Z=new g;Z.cregs=JSON.parse(JSON.stringify(l.cregs));var B=G.wires.length>1?O.wires:O.wires[G.wires[0]],ot={};if(G.params){var U={};if(O.options&&O.options.params)for(var E in O.options.params){var T=v.parse(O.options.params[E]),tt=T.toString({handler:d});U[E]=tt}for(var I in G.params){var T=v.parse(G.params[I]),tt=T.toString({handler:d,replaceVars:U});ot[I]=tt}}var X=O.options&&O.options.condition?O.options.condition:{};Z.addGate(G.name,S,B,{params:ot,condition:X});var z={comment:"",decompose:!1,compatibilityMode:o};h+=Z.exportToQASM(z,"",!0,!!e||n)})))}if(!C&&!P&&((e||n)&&(h+="  "),O.options&&O.options.condition&&O.options.condition.creg&&(h+="if("+O.options.condition.creg+"=="+O.options.condition.value+") ")),!C&&!P||o){var A=O.name,b=O.options&&O.options.params?O.options.params:{};if(h+=o?O.name:y,b){var x=f.basicGates[A];if(x||(x=f.customGates[A]),x){var L=x.params||[],k=L.length;if(k){h+=" (";for(var N=0;N<k;N++){N>0&&(h+=", ");var W=L[N],R=b[W];if(!e&&!n&&!o){var F=v.parse(b[W]);R=F.toString({handler:d})}h+=R}h+=")"}}}for(var V=0;V<O.wires.length;V++)V>0&&(h+=","),e||n?h+=" "+St(O.wires[V],f.numQubits):h+=" q["+O.wires[V]+"]";A=="measure"&&O.options&&O.options.creg&&(h+=" -> ",h+=O.options.creg.name+"["+O.options.creg.bit+"]"),h+=`;
`}}}return e&&(h+=`}

`),h},g.prototype.exportToPyquil=function(a,e){a=a||{};var t=a.comment,n=a.decompose,s=a.versionStr,r=a.lattice,o=a.asQVM,l=a.asJupyter,p=a.shots,d=a.hybrid,f=this,h=parseFloat(s||"2.12");isNaN(h)&&(h=2.1),p||(p=1024),typeof d>"u"&&(d=this.options?!!this.options.hybrid:!1);var c=new g;c.load(this.save(n));var m=function(wt,vt){if(wt.isSymbolNode){var ct=["pi","sin","cos","tan","asin","acos","atan"];if(ct.indexOf(wt.name)>=0)return"np."+wt.name;if(f.params.indexOf(wt.name)>=0&&d)return"params["+f.params.indexOf(wt.name)+"]"}},q=function(wt,vt){var ct="",Ct=wt.split(`
`),yt=-1;Ct.map(function(Rt){var Et=Rt.search(/\S/);Et>=0&&(yt<0||Et<yt)&&(yt=Et)}),yt<0&&(yt=0);var _t="";if(yt<vt.length)for(var Pt=0;Pt<vt.length-yt;Pt++)_t+=" ";return Ct.map(function(Rt){ct+=_t+Rt+`
`}),ct},u="",Q=[],_="",S="",j="",O=c.usedGates(),C=c.gotMeasurement(),P=[],y=[];O.map(function(wt){var vt=c.basicGates[wt];if(vt){if(vt.exportInfo&&vt.exportInfo.pyquil){var ct=vt.exportInfo.pyquil;if(ct.array){var Ct="";ct.params&&(Ct+=", [",ct.params.map(function(Pt,Rt){Rt>0&&(Ct+=", "),Ct+="p_"+Pt;var Et="p_"+Pt+" = Parameter('"+Pt+"')";Q.indexOf(Et)<0&&Q.push(Et)}),Ct+="]"),S+="p.inst("+ct.name+`_defgate)
`,j+=ct.name+"_array = np.array("+ct.array+`)
`,_+=ct.name+"_defgate = DefGate('"+ct.name+"', "+ct.name+"_array"+Ct+`)
`,_+=ct.name+" = "+ct.name+`_defgate.get_constructor()
`,P.push(ct.name)}else{var yt="";if(ct.replacement){var _t=c.basicGates[ct.replacement.name];_t&&_t.exportInfo&&(_t.exportInfo.pyquil?yt=_t.exportInfo.pyquil.name:_t.exportInfo.quil&&(yt=_t.exportInfo.quil.name))}else yt=ct.name;yt&&(u&&(u+=", "),u+=yt)}}else if(vt.exportInfo&&vt.exportInfo.quil){var ct=vt.exportInfo.quil;if(!ct.defgate){var yt="";if(ct.replacement){var _t=c.basicGates[ct.replacement.name];_t&&_t.exportInfo&&(_t.exportInfo.pyquil?yt=_t.exportInfo.pyquil.name:_t.exportInfo.quil&&(yt=_t.exportInfo.quil.name))}else yt=ct.name;yt&&(u&&(u+=", "),u+=yt)}}}});var x=c.gotClassicalControl();x&&(u&&(u+=", "),h<2?u+="FALSE, NOT, OR, AND":u+="MOVE, NOT, IOR, AND");var A="";_&&(h<2.12?A=`from pyquil.parameters import Parameter, quil_sin, quil_cos, quil_sqrt, quil_exp, quil_cis
from pyquil.quilbase import DefGate`:A=`from pyquil.quilatom import Parameter, quil_sin, quil_cos, quil_sqrt, quil_exp, quil_cis
from pyquil.quilbase import DefGate`);var b="";if(t){var L=(t||"").split(`
`);L.map(function(wt){wt.length>=1&&wt[0]!="#"&&(b+="# "),b+=wt,b+=`
`})}var k="";if(e){for(var N="",W=0,R=0;R<c.params.length;R++)W>0&&(N+=", "),N+=c.params[R],W++;for(var R=0;R<c.numQubits;R++)W>0&&(N+=", "),N+="q"+R,W++;b+="def "+e+(N?"("+N+")":"")+`:
`,k="  "}else{h<2?(b+=`from pyquil.api import QVMConnection
`,b+=`from pyquil.quil import Program
`):b+=`from pyquil import Program, get_qc
`,u&&(b+="from pyquil.gates import "+u+`
`),A&&(b+=A+`
`),b+=`from functools import reduce
`,d&&(b+=`from scipy.optimize import minimize
`,b+=`from collections import Counter
`),b+=`import numpy as np
`,p&&(b+=`
`,b+="shots = "+p+`
`);var F=this.options&&this.options.params?this.options.params:{};if(this.params.length){b+=`
`;for(var R=0;R<this.params.length;R++){var V=this.params[R],G=v.parse(F[V]),Z=G.toString({handler:m});b+=V+" = "+Z+`
`}b+=`
`}d&&(b+="tolerance = "+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.tolerance&&this.options.hybridOptions.tolerance||"0.001")+`
`,b+=`
`),_&&(Q.map(function(vt,ct){ct==0&&(b+=`
`),b+=vt+`
`}),b+=`
`,b+=j+`
`,b+=`
`,b+=_+`
`),b+=`
`;var O=c.usedGates();n||O.map(function(vt){var ct=c.basicGates[vt];if(!ct){var Ct=f.customGates[vt];if(Ct){var yt=new g;yt.load(Ct);var _t={comment:"",decompose:!1,versionStr:s};b+=yt.exportToPyquil(_t,vt),y.push(vt)}}})}if(d&&(k+="  ",b+=`def objective_function(params):
`),h>=2&&!e){o||r?b+=k+`p = Program('PRAGMA INITIAL_REWIRING "PARTIAL"')

`:b+=k+`p = Program()

`;var B=c.cregTotalBits();x&&(B+=1),B&&(b+=k+"ro = p.declare('ro', memory_type='BIT', memory_size="+B+`)
`,b+=`
`)}else b+=k+`p = Program()

`;b+=S?k+S+`
`:"";for(var ot=0;ot<c.numCols();ot++)for(var U=0;U<c.numQubits;U++){var E=c.getGateAt(ot,U);if(E&&E.connector==0){var T=c.getGateDef(E.name),tt=tt=E.options&&E.options.params?E.options.params:{},I=null;if(T){T.exportInfo&&(T.exportInfo.pyquil&&T.exportInfo.pyquil.replacement?(T.exportInfo.pyquil.replacement.params&&(tt=T.exportInfo.pyquil.replacement.params),T=c.getGateDef(T.exportInfo.pyquil.replacement.name)):T.exportInfo.quil&&T.exportInfo.quil.replacement&&(T.exportInfo.quil.replacement.params&&(tt=T.exportInfo.quil.replacement.params),T=c.getGateDef(T.exportInfo.quil.replacement.name)),T&&T.exportInfo&&(T.exportInfo.pyquil?I=T.exportInfo.pyquil:T.exportInfo.quil&&(I=T.exportInfo.quil)));var X=!1;I?(X=P.indexOf(I.name)>=0,y.indexOf(I.name)>=0):(X=P.indexOf(E.name)>=0,y.indexOf(E.name)>=0);var z=!1;if(E.options&&E.options.condition&&E.options.condition.creg){z=!0,b+=`
`;var J=f.cregTotalBits(),rt=E.options.condition,Y=rt.value||0,et=f.cregBase(rt.creg);if(Y==0){var D=f.cregs[rt.creg].length;if(h<2){b+=k+"p.inst(FALSE("+J+`))
`;for(var H=0;H<D;H++)b+=k+"p.inst(OR("+(H+et)+", "+J+`))
`;b+=k+"p.inst(NOT("+J+`))
`,b+=k+"p.if_then("+J+", Program("}else{b+=k+"p.inst(MOVE(ro["+J+`], 0))
`;for(var H=0;H<D;H++)b+=k+"p.inst(IOR(ro["+J+"], ro["+(H+et)+`]))
`;b+=k+"p.inst(NOT(ro["+J+`]))
`,b+=k+"p.if_then(ro["+J+"], Program("}}else{var ut=Y.toString(2).split("").reverse(),mt=0,K=0;if(ut.map(function(wt,vt){var ct=parseInt(wt);ut[vt]=ct,ct&&(mt++,K=vt)}),mt==1)h<2?b+=k+"p.if_then("+(K+et)+", Program(":b+=k+"p.if_then(ro["+(K+et)+"], Program(";else if(h<2){b+=k+"p.inst(FALSE("+J+`))
`;var pt=!0;ut.map(function(wt,vt){wt&&(pt?(pt=!1,b+=k+"p.inst(OR("+(vt+et)+", "+J+`))
`):b+=k+"p.inst(AND("+(vt+et)+", "+J+`))
`)}),b+=k+"p.if_then("+J+", Program("}else{b+=k+"p.inst(MOVE(ro["+J+`], 0))
`;var pt=!0;ut.map(function(vt,ct){vt&&(pt?(pt=!1,b+=k+"p.inst(IOR(ro["+J+"], ro["+(ct+et)+`]))
`):b+=k+"p.inst(AND(ro["+J+"], ro["+(ct+et)+`]))
`)}),b+=k+"p.if_then(ro["+J+"], Program("}}}else b+=k+"p.inst(";I?b+=I.name:b+=E.name;var qt=!1;if(I&&I.params&&I.params.length){var W=0;b+="(",qt=!0;for(var dt=0;dt<I.params.length;dt++){if(W>0&&(b+=", "),typeof tt[I.params[dt]]<"u"){var G=v.parse(tt[I.params[dt]]);b+=G.toString({handler:m})}W++}h<2||X?b+=")":b+=", "}else if(T&&T.params&&T.params.length){var W=0;b+="(",qt=!0;for(var dt=0;dt<T.params.length;dt++){if(W>0&&(b+=", "),typeof tt[T.params[dt]]<"u"){var G=v.parse(tt[T.params[dt]]);b+=G.toString({handler:m})}W++}h<2||X?b+=")":b+=", "}if(E.wires.length){var W=0;(h<2||!qt||X)&&(b+="(",qt=!0);for(var bt=0;bt<E.wires.length;bt++)W>0&&(b+=", "),e?b+="q"+E.wires[bt]:b+=""+E.wires[bt],W++;if(E.name=="measure"&&E.options&&E.options.creg){var Gt=parseInt(E.options.creg.bit)||0;isNaN(Gt)&&(Gt=0),W>0&&(b+=", "),h<2?b+=Gt+f.cregBase(E.options.creg.name):b+="ro["+(Gt+f.cregBase(E.options.creg.name))+"]",W++}b+=")"}b+=")",z&&(b+=`)
`),b+=`
`}else b+=k+'# Export to pyquil WARNING: unknown gate "'+E.name+'".'}}if(e)b+=k+`return p
`,b+=`
`;else{if(b+=`
`,h<2)if(b+=k+`qvm = QVMConnection()
`,d){b+=`
`,b+=k+`# CALCULATE COST HERE
`;var xt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";xt.trim()||(xt="cost = 0"),b+=q(xt,k),b+=`
`,b+=k+`return cost
`}else b+=k+`print(qvm.run(p))
`;else{p&&(b+=k+`p.wrap_in_numshots_loop(shots)
`,b+=`
`);var kt=r;if(kt||(h<2.1?kt=this.numQubits+"q-generic-qvm":kt=this.numQubits+"q-qvm"),b+=k+"qc = get_qc('"+kt+"'"+(r?", as_qvm="+(o?"True":"False"):"")+`)
`,r)if(b+=k+`ep = qc.compile(p)
`,C)if(b+=k+`results_list = qc.run(ep).readout_data.get("ro")
`,b+=k+`results = list(map(lambda arr: reduce(lambda x, y: str(x) + str(y), arr[::-1], ""), results_list))
`,d){b+=k+`counts = Counter(dict(zip(results,[results.count(i) for i in results])))
`,b+=`
`,b+=k+`# CALCULATE COST HERE
`;var xt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";xt.trim()||(xt="cost = 0"),b+=q(xt,k),b+=`
`,b+=k+`return cost
`}else b+=k+`counts = dict(zip(results,[results.count(i) for i in results]))
`,b+=k+`print(counts)
`;else if(d){b+=k+`counts = Counter(dict(zip(results,[results.count(i) for i in results])))
`,b+=`
`,b+=k+`# CALCULATE COST HERE
`;var xt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";xt.trim()||(xt="cost = 0"),b+=q(xt,k),b+=`
`,b+=k+`return cost
`}else b+=k+`print(qc.run(ep).readout_data.get("ro"))
`;else if(C)if(b+=k+`results_list = qc.run(p).readout_data.get("ro")
`,b+=k+`results = list(map(lambda arr: reduce(lambda x, y: str(x) + str(y), arr[::-1], ""), results_list))
`,d){b+=k+`counts = Counter(dict(zip(results,[results.count(i) for i in results])))
`,b+=`
`,b+=k+`# CALCULATE COST HERE
`;var xt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";xt.trim()||(xt="cost = 0"),b+=q(xt,k),b+=`
`,b+=k+`return cost
`}else b+=k+`counts = dict(zip(results,[results.count(i) for i in results]))
`,b+=k+`print(counts)
`;else if(b+=k+`results_list = qc.run(p).readout_data.get("ro")
`,b+=k+`results = list(map(lambda arr: reduce(lambda x, y: str(x) + str(y), arr[::-1], ""), results_list))
`,d){b+=k+`counts = Counter(dict(zip(results,[results.count(i) for i in results])))
`,b+=`
`,b+=k+`# CALCULATE COST HERE
`;var xt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";xt.trim()||(xt="cost = 0"),b+=q(xt,k),b+=`
`,b+=k+`return cost
`}else b+=k+`print(results)
`}if(d){var Qt="";this.params.map(function(wt,vt){vt>0&&(Qt+=", "),Qt+=wt}),b+=`
`,b+="params = np.array(["+Qt+`])
`,b+=`
`,b+='minimum = minimize(objective_function, params, method="'+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.optimizer?this.options.hybridOptions.optimizer:"Powell")+`", tol=tolerance)
`,b+=`print("cost:", minimum.fun, "params:", minimum.x)
`}}if(l){var Ut={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:b,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(Ut)}return b},g.prototype.exportToQuil=function(a,e){a=a||{};var t=a.comment,n=!0,s=a.versionStr,r=this,o=parseFloat(s||"2.0");isNaN(o)&&(o=2);var l=new g;l.load(this.save(n));var p="";if(t){var d=(t||"").split(`
`);d.map(function(X){X.length>=1&&X[0]!="#"&&(p+="# "),p+=X,p+=`
`})}var f=l.usedGates();f.map(function(X){var z=l.basicGates[X];z&&z.exportInfo&&z.exportInfo.quil&&z.exportInfo.quil.defgate&&(p+=z.exportInfo.quil.defgate,p+=`

`)});var h=this.gotClassicalControl(),c="";if(e){var m="";if(l.params.length){m+="(";for(var q=0;q<l.params.length;q++)q>0&&(m+=", "),m+="%"+l.params[q];m+=")"}for(var u="",q=0;q<l.numQubits;q++)q>0&&(u+=" "),u+="q"+q;p+="DEFCIRCUIT "+e+(m?" "+m:"")+(u?" "+u:"")+`:
`,c="    "}else{if(p+=`
`,o>=2){var Q=l.cregTotalBits();h&&(Q+=1),Q&&(p+="DECLARE ro BIT["+Q+`]
`)}var _=this.options&&this.options.params?this.options.params:{};if(this.params.length){p+=`
`;for(var q=0;q<this.params.length;q++){var S=this.params[q],j=v.parse(_[S]);j.toString({handler:O}),p+="DECLARE "+S+` REAL[1]
`}p+=`
`}var f=l.usedGates()}for(var O=function(X,z){if(X.isSymbolNode&&l.params.indexOf(X.name)>=0)return"%"+X.name},C=1,P=0;P<l.numCols();P++)for(var y=0;y<l.numQubits;y++){var x=l.getGateAt(P,y);if(x&&x.connector==0){var A=l.getGateDef(x.name),b=x.options&&x.options.params?x.options.params:{},L=null;if(A){A.exportInfo&&(A.exportInfo.quil&&A.exportInfo.quil.replacement&&(A.exportInfo.quil.replacement.params&&(b=A.exportInfo.quil.replacement.params),A=l.getGateDef(A.exportInfo.quil.replacement.name)),L=A&&A.exportInfo&&A.exportInfo.quil?A.exportInfo.quil:null);var k=!1;if(x.options&&x.options.condition&&x.options.condition.creg){k=!0,p+=`
`;var N=r.cregTotalBits(),W=x.options.condition,R=W.value||0,F=r.cregBase(W.creg);if(R==0){var V=r.cregs[W.creg].length;if(o<2){p+=c+"FALSE ["+N+`]
`;for(var G=0;G<V;G++)p+=c+"OR ["+(G+F)+"] ["+N+`]
`;p+=c+"NOT ["+N+`]
`,p+="JUMP-WHEN @THEN"+C+" ["+N+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`}else{p+=c+"FALSE ro["+N+`]
`;for(var G=0;G<V;G++)p+=c+"OR ro["+(G+F)+"] ro["+N+`]
`;p+=c+"NOT ro["+N+`]
`,p+="JUMP-WHEN @THEN"+C+" ro["+N+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`}}else{var Z=R.toString(2).split("").reverse(),B=0,ot=0;if(Z.map(function(X,z){var J=parseInt(X);Z[z]=J,J&&(B++,ot=z)}),B==1)o<2?(p+="JUMP-WHEN @THEN"+C+" ["+(ot+F)+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`):(p+="JUMP-WHEN @THEN"+C+" ro["+(ot+F)+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`);else if(o<2){p+=c+"FALSE ["+N+`]
`;var U=!0;Z.map(function(X,z){X&&(U?(U=!1,p+=c+"OR ["+(z+F)+"] ["+N+`]
`):p+=c+"AND ["+(z+F)+"] ["+N+`]
`)}),p+="JUMP-WHEN @THEN"+C+" ["+N+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`}else{p+=c+"FALSE ro["+N+`]
`;var U=!0;Z.map(function(z,J){z&&(U?(U=!1,p+=c+"OR ro["+(J+F)+"] ro["+N+`]
`):p+=c+"AND ro["+(J+F)+"] ro["+N+`]
`)}),p+="JUMP-WHEN @THEN"+C+" ro["+N+`]
`,p+="JUMP @END"+(C+1)+`
`,p+="LABEL @THEN"+C+`
`}}}L?p+=c+L.name:p+=c+x.name,p+=" ";var E=0;if(L&&L.params&&L.params.length){p+="(";for(var T=0;T<L.params.length;T++){if(E>0&&(p+=", "),typeof b[L.params[T]]<"u"){var j=v.parse(b[L.params[T]]);p+=j.toString({handler:O})}E++}p+=")"}else if(A&&A.params&&A.params.length){p+="(";for(var T=0;T<A.params.length;T++){if(E>0&&(p+=", "),typeof b[A.params[T]]<"u"){var j=v.parse(b[A.params[T]]);p+=j.toString({handler:O})}E++}p+=")"}for(var tt=0;tt<x.wires.length;tt++)E>0&&(p+=" "),e?p+="q"+x.wires[tt]:p+=""+x.wires[tt],E++;if(x.name=="measure"&&x.options&&x.options.creg){var I=parseInt(x.options.creg.bit)||0;isNaN(I)&&(I=0),E>0&&(p+=" "),o<2?p+="["+(I+r.cregBase(x.options.creg.name))+"]":p+="ro["+(I+r.cregBase(x.options.creg.name))+"]",E++}p+=`
`,k&&(p+="LABEL @END"+(C+1)+`
`,p+=`
`,C+=2)}else console.log("unknown gate",x.name)}}return e&&(p+=`
`),p},g.prototype.exportToAQASM=function(a,e,t,n){var s=this;a=a||{},a.comment;var r=a.decompose,o=a.asJupyter,l=a.shots,p=e?a.hybrid:!1,d=null,f=null;l=l||1024,typeof p>"u"&&(p=this.options?!!this.options.hybrid:!1);var h=this.save(!!r);d=new g,f=new g,d.load(h),f.load(h);var c=function(D,H){if(D.isSymbolNode){var ut=["pi"];if(ut.indexOf(D.name)>=0)return"np."+D.name;var mt=D.name;if(H.replaceVars&&typeof H.replaceVars[mt]<"u"){var mt=H.replaceVars[mt];return s.params.indexOf(mt)>=0?"("+V[mt]+")":"("+mt+")"}if(s.params.indexOf(D.name)>=0)return V[D.name]}},m=function(D,H){var ut="",mt=D.split(`
`),K=-1;mt.map(function(dt){var bt=dt.search(/\S/);bt>=0&&(K<0||bt<K)&&(K=bt)}),K<0&&(K=0);var pt="";if(K<H.length)for(var qt=0;qt<H.length-K;qt++)pt+=" ";return mt.map(function(dt){ut+=pt+dt+`
`}),ut},q=function(D){for(var H="",ut=0;ut<D;ut++)H+="    ";return H};n=n||0;var u=[];if(!e){if(!r)for(var Q=f.numCols(),_=Q-1;_>=0;_--)for(var S=0;S<f.numQubits;S++){var j=f.gates[S][_];if(j&&j.connector==0&&!f.basicGates[j.name]){customDecomposedCircuit=f.decomposeGateAt(_,S);for(var O=0;O<customDecomposedCircuit.numCols();O++)for(var C=0;C<customDecomposedCircuit.numQubits;C++){var P=customDecomposedCircuit.getGateAt(O,C);P&&P.connector==0&&u.push(P),d.gates.map(function(D,H){D.map(function(ut){ut&&ut.name==j.name&&d.removeGate(ut.id)})})}}}u.map(function(D){D&&d.insertGate(D.name,D.column,D.wires,D.options)})}var y="",x=q(n),A=d.usedGates(),b=d.numQubits;if(e)if(t){for(var L="",k=0,N=0;N<d.params.length;N++)k>0&&(L+=", "),L+=d.params[N],k++;for(var N=0;N<d.numQubits;N++)k>0&&(L+=", "),L+=St(N,d.numQubits),k++}else{y+=x+`from qat.lang.AQASM import *
`,y+=x+`from qat.qpus import get_default_qpu
`,y+=x+`from collections import Counter
`,p&&(y+=x+`from scipy.optimize import minimize
`),y+=x+`import numpy as np
`,y+=`
`;var W="",R=0;A.map(function(D){var H=d.basicGates[D];if(H){if(!r&&d.basicGates[D].exportInfo.aqasm&&d.basicGates[D].exportInfo.aqasm.array){if(unsupportedAqasmInfo=d.basicGates[D].exportInfo.aqasm,gateUnitary=D+"_gate",y+=x+"def "+gateUnitary+"(",unsupportedAqasmInfo.params&&unsupportedAqasmInfo.params.length){var ut=0;unsupportedAqasmInfo.params.map(function(bt){ut>0&&(y+=", "),y+=x+"p_"+bt,ut++})}y+=`):
`,y+=q(n+1)+"return np.array("+unsupportedAqasmInfo.array+`)

`,W+=D+' = AbstractGate("'+D+'", [';var mt=0;if(unsupportedAqasmInfo.params)for(var K=0;K<unsupportedAqasmInfo.params.length;K++)mt>0&&(W+=", "),W+="float",mt++;H.matrix&&(arity=v.log2(H.matrix.length)),W+="], matrix_generator="+gateUnitary+", arity="+arity+`)
`}}else{var pt=s.customGates[D];if(pt){var qt=new g;qt.load(pt);var dt={comment:"",decompose:!0,asJupyter:!1,shots:null,hybrid:!1};y+=qt.exportToAQASM(dt,e,D,n),R++}}}),y+=W,y+=`
`,l&&(y+=x+"shots = "+l+`
`,y+=`
`),y+=x+`program = Program()
`,y+=x+"qubits_reg = program.qalloc("+d.numQubits+`)
`;for(var F in d.cregs)y+=x+F+" = program.calloc("+d.cregs[F].length+`)
`;y+=`
`;var V=this.options&&this.options.params?this.options.params:{};if(this.params.length){for(var N=0;N<this.params.length;N++){var G=this.params[N],Z=v.parse(V[G]),B=Z.toString({handler:c});y+=G+" = "+B+`
`}y+=`
`}p&&(y+=x+"tolerance = "+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.tolerance&&this.options.hybridOptions.tolerance||"0.001")+`
`,y+=`
`)}else if(y+=x+`BEGIN
`,y+=x+"qubits "+b+`
`,d.cregs){var ot=0;for(var U in d.cregs)ot+=d.cregs[U].length;y+=x+"cbits "+ot+`
`}t?(y+="def "+t+(L?"("+L+")":"")+`:
`,n++,x=q(n),y+=x+`circuit = QRoutine()
`):p&&(y+=`def objective_function(params):
`,n++,x=q(n)),t||R&&(y+=`
`,A.map(function(D){!d.basicGates[D]&&d.customGates[D]&&(y+=x+D+"(")}));for(var _=0;_<d.numCols();_++)for(var S=0;S<d.numQubits;S++){var j=d.getGateAt(_,S);if(j&&j.connector==0){var E=d.getGateDef(j.name),T="";if(j.options&&j.options.params&&(gateParams=j.options.params),j.name=="measure"&&(e?T+="program.measure":T+="MEAS"),j.name=="reset"&&(e?T+="program.reset":T+="RESET"),E&&E.exportInfo){if(E.exportInfo.aqasm){var tt=E.exportInfo.aqasm,I="";if(tt.name)E.params.length?E.params.map(function(mt){var K=v.parse(gateParams[mt]),pt=K.toString({handler:c});I=tt.name,e?I+="("+pt+")":I+="["+pt+"]"}):I+=tt.name,tt.controlled&&tt.dagger?e?T+=I+".dag().ctrl()":T+="CTRL(DAG("+I+"))":tt.controlled?e?T+=I+".ctrl()":T+="CTRL("+I+")":tt.dagger?e?T+=I+".dag()":T+="DAG("+I+")":T+=I;else if(tt.matrix)if(e){T+=j.name+"(";var X=0;E.params.map(function(mt){X>0&&(T+=", ");var K=v.parse(gateParams[mt]),pt=K.toString({handler:c});T+=pt,X++}),T+=")"}else{T="[";for(var z=0;z<tt.matrix.length;z++){row=tt.matrix[z],T+="[";for(var N=0;N<row.length;N++)T+="(",row_element=row[N],tt.params&&tt.params.map(function(K){var pt=gateParams[K];row_element.toString().indexOf(K)>0&&(row_element=row_element.replace(K,pt))}),evaluated_expression=v.evaluate(row_element,s.options.params),matrix_element=v.complex(evaluated_expression),matrix_element_real=matrix_element.re,matrix_element_im=matrix_element.im,T+=matrix_element_real+", "+matrix_element_im+")",N<row.length-1&&(T+=" ");T+="]",z<tt.matrix.length-1&&(T+=" ")}T+="]"}}y+=x+T,e?y+="(":y+=" "}for(var k=0,J=0;J<j.wires.length;J++)k>0&&(y+=", "),e?t?y+=St(j.wires[J],d.numQubits):y+="qubits_reg["+j.wires[J]+"]":y+="q["+j.wires[J]+"]",k=k+1;j.options&&j.options.creg&&(y+=", "+j.options.creg.name+"["+j.options.creg.bit+"]"),e&&(y+=")"),y+=`
`}}if(t&&(y+=x+`return circuit

`),!e)y+="END";else if(!t)if(y+=x+`
`,y+=x+`circuit = program.to_circ()
`,y+=x+`job = circuit.to_job(nbshots=shots, aggregate_data=False)
`,y+=x+`qpu = get_default_qpu()
`,y+=x+`job_result = qpu.submit(job)
`,y+=x+`counts = Counter()

`,y+=x+`for state in job_result:
`,y+=x+`    string_state = str(state.state)
`,y+=x+`    string_state = string_state[string_state.find('|') + 1: string_state.find('>')]
`,y+=x+`    string_state = string_state[::-1]
`,y+=x+`    counts[string_state] += 1

`,p){y+=x+`# CALCULATE COST HERE
`;var rt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";if(rt.trim()||(rt="cost = 0"),y+=m(rt,x),y+=`
`,y+=x+`return cost
`,n--,x=q(n),p){var Y="";this.params.map(function(D,H){H>0&&(Y+=", "),Y+=D}),y+=`
`,y+="params = np.array(["+Y+`])
`,y+=`
`,y+='minimum = minimize(objective_function, params, method="'+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.optimizer?this.options.hybridOptions.optimizer:"Powell")+`", tol=tolerance)
`,y+=`print("cost:", minimum.fun, "params:", minimum.x)
`}}else y+=x+"print(counts)";if(o&&e){var et={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:y,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(et)}return y},g.prototype.exportAQASM=function(a,e,t,n,s,r,o,l){var p={comment:a,decompose:e,asJupyter:s,shots:r,hybrid:o};return this.exportToAQASM(p,t,n,l)},g.prototype.exportToPyAQASM=function(a,e){return this.exportToAQASM(a,!0,e)},g.prototype.exportPyAQASM=function(a,e,t,n,s,r){var o={comment:a,decompose:e,asJupyter:n,shots:s,hybrid:r};return this.exportToPyAQASM(o,t)},g.prototype.exportToCirq=function(a,e){a=a||{};var t=a.comment,n=a.decompose,s=a.versionStr,r=a.asJupyter,o=a.shots,l=a.exportTfq,p=this,d="";l?d="TFQ":d="cirq";var f=parseFloat(s||"0.7");isNaN(f)&&(f=.7),typeof o>"u"&&(o=1024);var h=new g;h.load(this.save(n));var c="",m="";if(t){var q=(t||"").split(`
`);q.map(function(Y){Y.length>=1&&Y[0]!="#"&&(c+="# "),c+=Y,c+=`
`})}var u=function(Y,et){if(Y.isSymbolNode){var D=["pi","sin","cos","tan","asin","acos","atan"];if(D.indexOf(Y.name)>=0)return"np."+Y.name}};if(e){for(var Q="",_=0,S=0;S<h.params.length;S++)_>0&&(Q+=", "),Q+=h.params[S],_++;for(var S=0;S<h.numQubits;S++)_>0&&(Q+=", "),Q+=St(S,h.numQubits),_++;c+="def "+e+(Q?"("+Q+")":"")+`:
`,c+=`    return [
`,m="        "}else{l&&(c+=`import tensorflow_quantum as tfq
`),c+=`import cirq
`,c+=`import numpy as np
`,c+=`from functools import reduce
`,c+=`
`;var j=this.options&&this.options.params?this.options.params:{};if(this.params.length){for(var S=0;S<this.params.length;S++){var O=this.params[S],C=v.parse(j[O]),P=C.toString({handler:u});c+=O+" = "+P+`
`}c+=`
`}var x=h.usedGates();n||x.map(function(Y){var et=h.basicGates[Y];if(!et){var D=p.customGates[Y];if(D){var H=new g;H.load(D);var ut={comment:"",decompose:!0,versionStr:s};c+=H.exportToCirq(ut,e)}}});var y="",x=h.usedGates();x.map(function(Y){var et=h.basicGates[Y];if(et&&et.exportInfo&&et.exportInfo.cirq){var D=et.exportInfo.cirq,H=!1;if(D.replacement){var ut=h.getGateDef(D.replacement.name);D=ut.exportInfo.cirq,H=!0}if(D.array&&!l){var mt=H?D.name:Y;if(y.indexOf(mt)<0){if(y+="def "+mt+"(",D.params&&D.params.map(function(K,pt){pt>0&&(y+=", "),y+="p_"+K}),y+=`):
`,et.matrix&&et.matrix.length)if(f<.7)switch(et.matrix.length){case 2:y+="    return cirq.SingleQubitMatrixGate(np.array("+D.array+`))
`;break;case 4:y+="    return cirq.TwoQubitMatrixGate(np.array("+D.array+`))
`;break;default:y+="    # Export to "+d+" WARNING: Cannot define "+et.matrix.length+" x "+et.matrix.length+` matrix gate
`}else y+="    return cirq.MatrixGate(np.array("+D.array+`))
`;y+=`
`}}}}),c+=y,l?c+="q = cirq.GridQubit.rect(1, "+h.numQubits+`)
`:c+="q = [cirq.NamedQubit('q' + str(i)) for i in range("+h.numQubits+`)]
`,c+=`
`,f<.7?c+=`circuit = cirq.Circuit.from_ops(
`:c+=`circuit = cirq.Circuit(
`,m="    "}for(var A=h.numCols(),b=0,L="",k=!1,N=0;N<A;N++)for(var W=0;W<this.numQubits;W++){var R=h.getGateAt(N,W);if(R&&R.connector==0){b>0&&(c+=",",l&&k&&(c+=m+"# Export to TFQ WARNING: Gate not yet supported by Tensorflow Quantum"),c+=`
`);var F=h.getGateDef(R.name),V=R.options&&R.options.params?R.options.params:{},G=null,Z=!1,B=!!h.basicGates[R.name];if(F){F.exportInfo&&(k=!!F.exportInfo.cirq.notTfqSupported,F.exportInfo.cirq&&F.exportInfo.cirq.replacement&&(F.exportInfo.cirq.replacement.params&&(V=F.exportInfo.cirq.replacement.params),Z=!!(F.exportInfo.cirq.replacement.type&&F.exportInfo.cirq.replacement.type=="controlled"),k=!!F.exportInfo.cirq.replacement.notTfqSupported,F=h.getGateDef(F.exportInfo.cirq.replacement.name)),G=F&&F.exportInfo&&F.exportInfo.cirq?F.exportInfo.cirq:null),b++,R.options&&R.options.condition&&R.options.condition.creg&&(c+=m+"# Export to "+d+` WARNING: classical control not implemented yet.
`);var ot=0,U="";if(V){var E=F.params||[];R.name=="yy"&&(E=[]);var T=E.length;if(T)for(var tt=0;tt<T;tt++){ot==0&&(U+="("),ot>0&&(U+=", ");var I=E[tt];if(V[I]){var C=v.parse(V[I]);if(!C.args)for(var X in R.options.params)C=v.parse(R.options.params[X]);U+=C.toString({handler:u})}ot==T-1&&(B?U+=")":U+=", "),ot++}}if(G){var z=G.name.indexOf("**")>=0;c+=m,z&&(c+="("),G.array||(c+="cirq."),l&&G.tfqReplacement&&G.tfqReplacement.name?c+="cirq."+G.tfqReplacement.name:c+=G.name,z&&(c+=")")}else c+=m+R.name;c+=U,Z?c+=".controlled().on(":B&&(c+="(");for(var _=0,J=0;J<R.wires.length;J++)_>0&&(c+=", "),e?c+=St(R.wires[J],h.numQubits):c+="q["+R.wires[J]+"]",_++;R.name=="measure"&&R.options&&R.options.creg&&(_>0&&(c+=", key="),c+="'"+R.options.creg.name+R.options.creg.bit+"'",N==A-1&&W==this.numQubits-1?L+="'"+R.options.creg.name+R.options.creg.bit+"'":L+="'"+R.options.creg.name+R.options.creg.bit+"', ",_++),c+=")"}else c+=m+"# Export to "+d+' WARNING: unknown gate "'+R.name+'".'}}if(l&&k&&(c+=m+"# Export to TFQ WARNING: Gate not yet supported by Tensorflow Quantu"),e?(c+=`
    ]
`,c+=`
`):(c+=`
)
`,c+=`
`,l||(c+=`simulator = cirq.Simulator()
`,c+="result = simulator.run(circuit, repetitions="+o+`)
`,c+="result_dict = dict(result.multi_measurement_histogram(keys=["+L+`]))
`,c+=`keys = list(map(lambda arr: reduce(lambda x, y: str(x) + str(y), arr[::-1]), result_dict.keys()))
`,c+=`counts = dict(zip(keys,[value for value in result_dict.values()]))
`,c+="print(counts)")),r){var rt={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:c,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(rt)}return c},g.prototype.exportToTFQ=function(a,e){a=a||{};var t=a.comment,n=a.decompose,s=a.versionStr,r=a.asJupyter,o=a.shots;typeof o>"u"&&(o=1024);var l=new g;l.load(this.save(n));var p="";if(t){var d=(t||"").split(`
`);d.map(function(c){c.length>=1&&c[0]!="#"&&(cirq+="# "),cirq+=c,cirq+=`
`})}var f={comment:t,decompose:n,versionStr:s,asJupyter:!1,shots:o,exportTfq:!0};if(p+=l.exportToCirq(f,e),p+="results_list = tfq.layers.Sample()(circuit, repetitions="+o+`).to_list()[0]
`,p+=`results = list(map(lambda arr: reduce(lambda x, y: str(x) + str(y), arr[::-1]), results_list))
`,p+=`counts = dict(zip(results,[results.count(i) for i in results]))
`,p+="print(counts)",r){var h={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:p,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(h)}return p},g.prototype.exportToQSharp=function(a,e){a=a||{},a.comment;var t=a.decompose,n=a.versionStr,s=a.asJupyter,r=a.circuitName,o=a.indentDepth,l=this,p=function(U,E){if(U.isSymbolNode){var T={pi:"PI()"};if(T[U.name])return T[U.name]}if(U.isConstantNode&&Number.isInteger(U.value))return U.value.toFixed(1)},d=r||"Circuit";o=o||0;function f(U){for(var E="",T=0;T<U;T++)E+="    ";return E}var h=new g;h.load(this.save(t));var c="",m=f(o);if(e||(s||(c+=`namespace Quantum {
`,o++,m=f(o)),c+=m+`open Microsoft.Quantum.Intrinsic;
`,c+=m+`open Microsoft.Quantum.Canon;
`,c+=m+`open Microsoft.Quantum.Math;
`,c+=m+`open Microsoft.Quantum.Convert;
`,c+=`
`,c+=m+`function SetBitValue(reg: Int, bit: Int, value: Bool): Int {
`,c+=m+`    if(value) {
`,c+=m+`        return reg ||| (1 <<< bit);
`,c+=m+`    } else {
`,c+=m+`        return reg &&& ~~~(1 <<< bit);
`,c+=m+`    }
`,c+=m+`}
`,c+=m+`
`),e){for(var q="",u=0,Q=0;Q<h.params.length;Q++)u>0&&(q+=", "),q+=h.params[Q],u++;for(var Q=0;Q<h.numQubits;Q++)u>0&&(q+=", "),q+=St(Q,h.numQubits)+": Qubit",u++;c+=m+"operation "+e+(q?"("+q+")":"")}else{var _=h.usedGates();t||_.map(function(U){var E=h.basicGates[U];if(!E){var T=l.customGates[U];if(T){var tt=new g;tt.load(T);var I={comment:"",decompose:!0,versionStr:n,asJupyter:!1,circuitName:null,indentDepth:o};c+=tt.exportToQSharp(I,e)}}}),c+=m+"operation "+d+"()"}o++,m=f(o);var S=0;for(cregName in h.cregs)S++;var j="";if(S){c+=" : (";for(cregName in h.cregs)j&&(c+=", ",j+=", "),c+="Int",j+=cregName;c+=")"}else c+=" : Unit";if(c+=` {
`,S)for(cregName in h.cregs)c+=m+"mutable "+cregName+` = 0;
`;qreg_name="qubits",e||(c+=m+"using(",c+=qreg_name+" = Qubit["+h.numQubits+"]",c+=`) {
`,o++,m=f(o));for(var _=h.usedGates(),O=h.numCols(),C=0;C<O;C++)for(var P=0;P<h.numQubits;P++){var y=h.getGateAt(C,P);if(y&&y.connector==0){var x=h.getGateDef(y.name);x||(x=h.customGates[y.name]);var A=y.options&&y.options.params?y.options.params:{},b=null,L=!1,k=0;if(x){x.exportInfo&&(x.exportInfo.qsharp&&x.exportInfo.qsharp.replacement&&(x.exportInfo.qsharp.replacement.params&&(A=x.exportInfo.qsharp.replacement.params),x=h.getGateDef(x.exportInfo.qsharp.replacement.name)),b=x&&x.exportInfo&&x.exportInfo.qsharp?x.exportInfo.qsharp:null),x.drawingInfo&&x.drawingInfo.root&&y.name!="cx"&&y.name!="ccx"&&(L=!0);var N=0,W="";if(A){var R=x.params||[],F=R.length;if(F)for(var V=0;V<F;V++){N>0&&(W+=", ");var G=R[V];if(A[G]){var Z=v.parse(A[G]);W+=Z.toString({handler:p})}N++}}if(y.name=="measure")y.options&&y.options.creg?(c+=m+"set "+y.options.creg.name+" = SetBitValue("+y.options.creg.name+", "+y.options.creg.bit+", ResultAsBool(M(",e?c+=St(y.wires[0],h.numQubits)+`)));
`:c+=qreg_name+"["+y.wires[0]+`])));
`):c+=m+`// Export to qsharp WARNING: missing destination register
`;else{c+=m,y.options&&y.options.condition&&y.options.condition.creg&&(c+="if("+y.options.condition.creg+" == "+y.options.condition.value+`) {
`,o++,m=f(o),c+=m),b?c+=b.name+"(":c+=y.name+"(",L?(e?c+="["+St(y.wires[0],h.numQubits)+"], (":c+="["+qreg_name+"["+y.wires[0]+"]], (",k=1):k=0,W&&(c+=W+", ");for(var u=0,B=k;B<y.wires.length;B++)u>0&&(c+=", "),e?c+=St(y.wires[B],h.numQubits):c+=qreg_name+"["+y.wires[B]+"]",u++;L&&(c+=")"),c+=`);
`,y.options&&y.options.condition&&y.options.condition.creg&&(o--,m=f(o),c+=m+`}
`)}}}}if(e||(c+=m+"ResetAll("+qreg_name+`);
`,o--,m=f(o),c+=m+`}
`),S&&(c+=m+"return ("+j+`);
`),o--,m=f(o),c+=m+`}
`,e?c+=`
`:s||(c+=`}
`),s){var ot={metadata:{kernelspec:{display_name:"Q#",language:"qsharp",name:"iqsharp"},language_info:{name:""}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:c,metadata:{},outputs:[],execution_count:null},{cell_type:"code",source:"%simulate "+d,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(ot)}return c},g.prototype.exportToBraket=function(a,e){a=a||{},a.comment;var t=a.decompose,n=a.versionStr,s=a.asJupyter,r=a.shots,o=a.hybrid,l=a.indentDepth,p=this;r=r||1024,typeof o>"u"&&(o=this.options?!!this.options.hybrid:!1);var d=new g;d.load(this.save(t));var f=function(z,J){if(z.isSymbolNode){var rt=["pi","sin","cos","tan","asin","acos","atan"];if(rt.indexOf(z.name)>=0)return"np."+z.name;if(p.params.indexOf(z.name)>=0&&o)return"params["+p.params.indexOf(z.name)+"]"}},h=function(z,J){var rt="",Y=z.split(`
`),et=-1;Y.map(function(ut){var mt=ut.search(/\S/);mt>=0&&(et<0||mt<et)&&(et=mt)}),et<0&&(et=0);var D="";if(et<J.length)for(var H=0;H<J.length-et;H++)D+=" ";return Y.map(function(ut){rt+=D+ut+`
`}),rt},c=function(z){for(var J="",rt=0;rt<z;rt++)J+="    ";return J};l=l||0;var m="",q=c(l),u=d.usedGates();u.map(function(z){d.basicGates[z]});var Q="",_=0;if(e){for(var S=0;S<d.numQubits;S++)_>0&&(Q+=", "),Q+=St(S,d.numQubits),_++;for(var S=0;S<d.params.length;S++)_>0&&(Q+=", "),Q+=d.params[S],_++}else{m+=q+`import numpy as np
`,m+=q+`from braket.devices import LocalSimulator
`,m+=q+`from braket.circuits import Circuit
`,m+=q+`from collections import Counter
`,o&&(m+=q+`from scipy.optimize import minimize
`),m+=`
`,r&&(m+=q+"shots = "+r+`
`,m+=`
`);var j=this.options&&this.options.params?this.options.params:{};if(this.params.length){for(var S=0;S<this.params.length;S++){var O=this.params[S],C=v.parse(j[O]),P=C.toString({handler:f});m+=O+" = "+P+`
`}m+=`
`}o&&(m+=q+"tolerance = "+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.tolerance&&this.options.hybridOptions.tolerance||"0.001")+`
`,m+=`
`)}var y=null,x=null,A=0;u.map(function(z){var J=d.basicGates[z];if(J){if(!t&&d.basicGates[z].exportInfo.braket&&d.basicGates[z].exportInfo.braket.array){if(y=d.basicGates[z].exportInfo.braket,y.name=="unitary"&&(x=z+"_unitary",m+=q+"def "+x+"("),y.params&&y.params.length){var rt=0;y.params.map(function(D){rt>0&&(m+=", "),m+=q+"p_"+D,rt++})}m+=`):
`,m+=c(l+1)+"return np.array("+y.array+`);

`}}else{var Y=p.customGates[z];if(Y){var et=new g;et.load(Y),m+=et.exportBraket("",!0,z,n,!1,null,!1,l),A++}}}),e?(m+="def "+e+(Q?"("+Q+")":"")+`:
`,l++,q=c(l)):o&&(m+=`def objective_function(params):
`,l++,q=c(l)),m+=q+`circuit = Circuit()
`,e||A&&(m+=`
`,u.map(function(z){!d.basicGates[z]&&d.customGates[z]&&(m+=q+"circuit.register_subroutine("+z+`)
`)}),m+=`
`);for(var b=d.numCols(),L=0;L<b;L++)for(var k=0;k<d.numQubits;k++){var N=d.getGateAt(L,k);if(N&&N.connector==0){var W=d.getGateDef(N.name),R=N.options&&N.options.params?N.options.params:{},F=W.params||[],V=null,G=N.name,Z="",B=!1;if(W&&W.exportInfo&&W.exportInfo.braket&&(V=W.exportInfo.braket,V.params&&(Array.isArray(V.params)?F=V.params:(R=V.params,F=Object.keys(R))),V.name=="unitary"?B=!0:G=V.name),!V&&!d.customGates[N.name])m+=q+'# Unsupported gate "'+N.name+`".
`;else{var ot=0;if(R){var U=F.length;if(U)for(var E=0;E<U;E++){ot>0&&(Z+=", ");var T=F[E];if(typeof R[T]<"u"){var C=v.parse(R[T]);Z+=C.toString({handler:f})}ot++}}m+=q+"circuit.",B?m+="unitary(matrix="+G+"_unitary("+Z+"), targets=[":m+=G+"(";var _=0;for(w=0;w<N.wires.length;w++)_>0&&(m+=", "),e?m+=St(N.wires[w],d.numQubits):m+=N.wires[w],_++;B?m+="]":Z&&(m+=", ",m+=Z),m+=")",m+=`
`}}}if(e&&(m+=q+"return circuit"),m+=`

`,!e)if(m+=q+`local_sim = LocalSimulator()
`,m+=q+`result = local_sim.run(circuit, shots=shots).result()
`,m+=q+`counts = Counter({ "".join(reversed(k)): v for k, v in result.measurement_counts.items() })
`,m+=`
`,o){m+=q+`# CALCULATE COST HERE
`;var tt=this.options&&this.options.hybridOptions&&this.options.hybridOptions.costFunction&&this.options.hybridOptions.costFunction.python||"";if(tt.trim()||(tt="cost = 0"),m+=h(tt,q),m+=`
`,m+=q+`return cost
`,l--,q=c(l),o){var I="";this.params.map(function(z,J){J>0&&(I+=", "),I+=z}),m+=`
`,m+="params = np.array(["+I+`])
`,m+=`
`,m+='minimum = minimize(objective_function, params, method="'+(this.options&&this.options.hybridOptions&&this.options.hybridOptions.optimizer?this.options.hybridOptions.optimizer:"Powell")+`", tol=tolerance)
`,m+=`print("cost:", minimum.fun, "params:", minimum.x)
`}}else m+=q+"print(counts)";if(s){var X={metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"}},nbformat:4,nbformat_minor:0,cells:[{cell_type:"code",source:m,metadata:{},outputs:[],execution_count:null}]};return JSON.stringify(X)}return m},g.prototype.exportToQobj=function(a,e){a=a||{};var t=a.circuitName,n=a.experimentName,s=a.numShots,r=this,o=this.options&&this.options.params?this.options.params:{},o=JSON.parse(JSON.stringify(o));for(var l in o)o[l]=v.evaluate(o[l]);t=t||"",n=n||"",s=s||1;var p=new g;p.load(this.save(!0));var d=this.randomString(),f={qobj_id:"qobj_"+d,type:"QASM",schema_version:"1.0",experiments:[],header:{description:t},config:{shots:s,memory_slots:0}},h={header:{memory_slots:0,n_qubits:0,qreg_sizes:[],qubit_labels:[],creg_sizes:[],clbit_labels:[],name:"circuit0"},config:{n_qubits:0,memory_slots:0},instructions:[]},c=Object.keys(p.cregs),m=function(I,X){if(I.isSymbolNode){var z=I.name;if(X.replaceVars&&typeof X.replaceVars[z]<"u"){var z=X.replaceVars[z];return r.params.indexOf(z)>=0?"("+o[z]+")":"("+z+")"}if(r.params.indexOf(I.name)>=0)return o[I.name]}};if(!e){n&&(h.header.description=n);for(cregName in p.cregs){var q=p.cregs[cregName].length;f.config.memory_slots+=q,h.header.creg_sizes.push([cregName,q]);for(var u=0;u<q;u++)h.header.clbit_labels.push([cregName,u])}h.header.memory_slots=f.config.memory_slots,h.header.n_qubits=p.numQubits,h.config.memory_slots=f.config.memory_slots,h.config.n_qubits=p.numQubits,h.header.qreg_sizes.push(["q",p.numQubits])}var Q=f.config.memory_slots,_=p.usedGates();_.map(function(I){var X=p.basicGates[I];if(!X){var z=r.customGates[I];if(z){customCircuit=new g,customCircuit.load(z);var J={circuitName:t,experimentName:n,numShots:s};f+=customCircuit.exportToQobj(J,!1)}}});for(var S=p.numCols(),j=0;j<S;j++)for(var O=0;O<p.numQubits;O++){var C=p.getGateAt(j,O),P={name:"",qubits:[]},y=null,x=null;if(j==0&&h.header.qubit_labels.push(["q",O]),C&&C.connector==0){var A=p.getGateDef(C.name);if(A&&A.exportInfo&&(A.exportInfo.qasm&&A.exportInfo.qasm.replacement?(y=A.exportInfo.qasm.replacement,y.map(function(I){var X=new g;if(X.cregs=JSON.parse(JSON.stringify(r.cregs)),C.options&&C.options.params){var z=Object.keys(C.options.params),J=Object.keys(I.params);z.map(function(et){J.indexOf(et)>-1&&(I.params[et]=C.options.params[et])})}var rt=C.options&&C.options.condition?C.options.condition:{};X.addGate(I.name,j,C.wires,{params:I.params,condition:rt});var Y={circuitName:"",experimentName:"",numShots:""};h.instructions=h.instructions.concat(X.exportToQobj(Y,!0))})):A.exportInfo.qasm&&A.exportInfo.qasm.equivalent&&(x=A.exportInfo.qasm.equivalent,x.map(function(I){var X=new g;X.cregs=JSON.parse(JSON.stringify(r.cregs));var z=I.wires.length>1?C.wires:C.wires[I.wires[0]],J={};if(I.params){var rt={};if(C.options&&C.options.params)for(var Y in C.options.params){var et=v.parse(C.options.params[Y]),D=et.toString({handler:m});rt[Y]=D}for(var H in I.params){var et=v.parse(I.params[H]),D=et.toString({handler:m,replaceVars:rt});J[H]=D}}var ut=C.options&&C.options.condition?C.options.condition:{};X.addGate(I.name,j,z,{params:J,condition:ut});var mt={circuitName:"",experimentName:"",numShots:""};h.instructions=h.instructions.concat(X.exportToQobj(mt,!0))}))),!y&&!x){var b=C.name,L=C.options&&C.options.params?C.options.params:{};if(this.basicGates[b]){switch(b){case"id":b="iden";break}if(P.name=b,P.qubits=C.wires,C.options&&C.options.condition&&C.options.condition.creg){for(var k={name:"",register:Q,relation:"==",mask:"",val:""},N=p.cregs[C.options.condition.creg].length,W=0,R=0,F="",V="",G=c.indexOf(C.options.condition.creg),u=0;u<G;u++)W+=p.cregs[c[u]].length;var Z=C.options.condition.value%Math.pow(2,N)*Math.pow(2,W);if(V="0x"+Z.toString(16).toUpperCase(),W>0){for(var B=Math.pow(2,W),ot=0;ot<N;ot++)R+=B,B*=2;F="0x"+R.toString(16).toUpperCase()}else F="0x"+(Math.pow(2,N)-1).toString(16).toUpperCase();k.name="bfunc",P.conditional=Q,k.mask=F,k.val=V,h.instructions.push(k),Q+=1}if(b=="measure"&&C.options&&C.options.creg){P.memory=[],P.register=[];for(var U=0,G=c.indexOf(C.options.creg.name),u=0;u<G;u++)U+=p.cregs[c[u]].length;var E=U+C.options.creg.bit;P.memory.push(E),P.register.push(E)}if(L&&(A=this.basicGates[b],A||(A=this.customGates[b]),A&&(paramDef=A.params||[],paramCount=paramDef.length,paramCount))){P.params=[];for(var T=0;T<paramCount;T++)if(paramName=paramDef[T],L[paramName]||L[paramName].toString()){var tt=v.evaluate(L[paramName],o);P.params.push(tt)}}h.instructions.push(P)}}}}return e?h.instructions:(h.instructions.length&&f.experiments.push(h),f)},g.prototype.clearPartitions=function(){this.partitionMap=[],this.partitionCount=0,this.partitionInfo={};for(var a=this.numCols(),e=0;e<this.numQubits;e++){this.partitionMap.push([]);for(var t=0;t<a;t++)this.partitionMap[e].push(-1)}},g.prototype.createPartitions=function(){this.clearPartitions();for(var a=[],e=0;e<this.numQubits;e++)a.push(-1);for(var t=0,n=this.numCols(),s=0;s<n;s++){for(var r=0;r<this.numQubits;r++){var o=this.getGateAt(s,r);if(o&&o.wires){for(var l=[],p=0;p<o.wires.length;p++){var d=o.wires[p],f=a[d];l.indexOf(f)<0&&l.push(f)}var h=-1;l.length!=1||l[0]==-1?h=t++:h=l[0];for(var p=0;p<o.wires.length;p++){var d=o.wires[p];if(oldPartition=a[d],oldPartition==-1)a[d]=h;else for(var e=0;e<this.numQubits;e++)a[e]==oldPartition&&(a[e]=h)}}}for(var r=0;r<this.numQubits;r++)this.partitionMap[r][s]=a[r]}this.partitionCount=t;for(var h=0;h<t;h++)this.partitionInfo[h]=this.partitionBounds(h)},g.prototype.printPartitions=function(){for(var a=this.numCols(),e=0;e<this.numQubits;e++){for(var t="",n=0;n<a;n++){var s=this.partitionMap[e][n];for(s==-1&&(s=" "),this.getGateAt(n,e)?s=s+"*":s=s+" ";s.length<4;)s=" "+s;t+=s}for(var r=e+"";r.length<2;)r="0"+r;t="q"+r+t,console.log(t)}},g.prototype.partitionBounds=function(a){for(var e={wire:{top:-1,bottom:-1},column:{left:-1,right:-1},wireMap:{},parents:{}},t=!1,n=this.numCols(),s=0;s<n;s++)for(var r=0;r<this.numQubits;r++){var o=this.partitionMap[r][s];o==a&&(t=!0,e.wire.top<0&&(e.wire.top=r),e.wire.bottom<r&&(e.wire.bottom=r),e.column.left<0&&(e.column.left=s),e.column.right<s&&(e.column.right=s))}if(!t)return null;for(var l=0,r=e.wire.top;r<=e.wire.bottom;r++){var o=this.partitionMap[r][e.column.left];o==a&&(e.wireMap[r]=l,l++)}if(e.numQubits=l,e.column.left>0)for(var r in e.wireMap){var p=this.partitionMap[r][e.column.left-1];if(p>=0){e.parents[p]||(e.parents[p]={},e.parents[p].links=[]);var d=this.partitionInfo[p];for(var f in d.wireMap)f==r&&e.parents[p].links.push(e.wireMap[r])}}return e},g.prototype.partitionCircuit=function(a){var e=this.partitionInfo[a];if(!e)return null;var t=[],n=[];for(var s in e.parents){var r={};r.circuit=this.partitionCache[s],r.wires=[],r.wires=e.parents[s].links,n=n.concat(r.wires),t.push(r)}var o=new g;if(t.length>0){if(e.numQubits>n.length){var r={};r.circuit=new g(e.numQubits-n.length),r.wires=[];for(var l=0;l<e.numQubits;l++)n.indexOf(l)<0&&r.wires.push(l);t.push(r)}o.setCombinedState(t)}for(var p=e.column.left;p<=e.column.right;p++)for(var d=e.wire.top;d<=e.wire.bottom;d++){var f=this.partitionMap[d][p];if(f==a){var h=this.getGateAt(p,d);if(h&&h.connector==0){for(var c=[],m=0;m<h.wires.length;m++){var q=h.wires[m];c.push(e.wireMap[q])}o.addGate(h.name,p-e.column.left,c,h.options)}}}return o},g.prototype.run=function(a,e){if(e=e||{},this.measureResetsQubit=!!e.strictMode,e.continue||(this.initState(),this.stats.duration=0),e.initialState){if(Array.isArray(e.initialState)){this.state={};for(var t=0;t<e.initialState.length;t++){var n=e.initialState[t];Array.isArray(n)&&n.length==2&&(n=v.complex(n[0],n[1])),typeof n=="string"&&(n=this.evalMathString(n)),typeof n=="number"&&(n=v.complex(n,0)),this.state[t+""]=n}}else this.state=e.initialState;this.stateBits=0;for(var s in this.state)this.stateBits|=parseInt(s)}this.stats.start=new Date;var r=new g;if(r.load(this.save(!0)),a){r.insertColumn(0);for(var o=0;o<r.numQubits;o++)a[o]&&r.addGate("x",0,o,{})}var l=e.partitioning;l&&r.createPartitions();for(var p=r.numCols(),d=0,f=0;f<p;f++){for(var o=0;o<r.numQubits;o++){var h=r.getGateAt(f,o);if(h&&h.connector==0){d++;var c=!0;if(h.options&&h.options.condition&&h.options.condition.creg){var m=this.getCregValue(h.options.condition.creg);c=m===h.options.condition.value}if(c)if(l){var q=r.partitionMap[o][f];r.partitionCache[q]||(r.partitionCache[q]=r.partitionCircuit(q));var u=r.partitionCache[q],Q=r.partitionInfo[q],_=f-Q.column.left,S=u.getGateAt(_,Q.wireMap[o]);u.cregs=JSON.parse(JSON.stringify(this.cregs)),u.applyGate(S.name,_,S.wires,S.options),this.cregs=JSON.parse(JSON.stringify(u.cregs))}else this.applyGate(h.name,f,h.wires,h.options);e&&e.onGate&&e.onGate(f,o,d)}}e&&e.onColumn&&e.onColumn(f)}if(l){for(var j=[],o=0;o<r.numQubits;o++){var q=r.partitionMap[o][p-1];q>=0&&j.indexOf(q)<0&&j.push(q)}if(j.length)if(j.length==1)this.state=r.partitionCache[j[0]].state,this.stateBits=r.partitionCache[j[0]].stateBits;else{for(var O=this.stats.start,C=[],P=0;P<j.length;P++){var y=j[P],x={};x.circuit=r.partitionCache[y],x.wires=[];var A=r.partitionInfo[y];for(var o in A.wireMap)x.wires.push(parseInt(o));C.push(x)}this.setCombinedState(C),this.stats.start=O}}this.stats.end=new Date,this.stats.duration+=this.stats.end-this.stats.start},g.prototype.continue=function(){this.run(null,{continue:!0})},g.prototype.stateAsArray=function(a,e,t,n){var s=[],r=this.numAmplitudes();e=e||0,t=t||(a?this.numAmplitudes(a):r);for(var o=0,l=0;l<r;l++){var p=l;n&&(p=te(l,this.numQubits));var d=v.round(this.state[p]||v.complex(0,0),14);if(!a||d.re||d.im){if(o>=e){for(var f=l.toString(2);f.length<this.numQubits;)f="0"+f;var h=this.formatComplex(d,{fixedWidth:!0,decimalPlaces:8,iotaChar:"i"}),c=v.pow(v.abs(d),2),m=c*100,q=m.toFixed(5),u=v.arg(d),Q=u.toFixed(5);s.push({index:l,indexBinStr:f,amplitude:d,amplitudeStr:h,magnitude:c,chance:m,chanceStr:q,phase:u,phaseStr:Q})}if(o++,s.length==t)return s}}return s},g.prototype.stateAsSimpleArray=function(a){var e=this.numAmplitudes();if(!this.state)return[];for(var t=[],n=0;n<e;n++){var s=n;a&&(s=te(n,this.numQubits)),t.push(v.round(this.state[s]||v.complex(0,0),14))}return t},g.prototype.stateAsString=function(a){var e=this.numAmplitudes();if(!this.state)return"Error: circuit is not initialized. Please call initState() or run() method.";for(var t="",n=0;n<e;n++){var s=v.round(this.state[n]||v.complex(0,0),14);if(!a||s.re||s.im){for(var r=v.pow(v.abs(s),2)*100,o=n.toString(2);o.length<this.numQubits;)o="0"+o;for(var l=r.toFixed(5);l.length<9;)l=" "+l;t+=this.formatComplex(s,{fixedWidth:!0,decimalPlaces:8,iotaChar:"i"})+"|"+o+">	"+l+`%
`}}return t},g.prototype.print=function(a){console.log(this.stateAsString(a))},g.prototype.gotClassicalControl=function(){for(var a=0;a<this.numCols();a++)for(var e=0;e<this.numQubits;e++){var t=this.getGateAt(a,e);if(t&&t.connector==0&&t.options&&t.options.condition&&t.options.condition.creg)return!0}return!1},g.prototype.gotMeasurement=function(){for(var a=0;a<this.numCols();a++)for(var e=0;e<this.numQubits;e++){var t=this.getGateAt(a,e);if(t&&t.connector==0&&t.name=="measure")return!0}return!1},g.prototype.cregCount=function(){var a=0;for(var e in this.cregs)a++;return a},g.prototype.getCregs=function(){var a={};for(var e in this.cregs)a[e]=this.getCregValue(e);return a},g.prototype.cregsAsString=function(){var a=`reg	bin	dec
`;for(var e in this.cregs){for(var t=this.getCregValue(e),n=t.toString(2),s=this.cregs[e]&&this.cregs[e].length||1;n.length<s;)n="0"+n;a+=e+"	"+n+"	"+t+`
`}return a},g.prototype.createCreg=function(a,e){for(this.cregs[a]=[];this.cregs[a].length<(e||1);)this.cregs[a].push(0)},g.prototype.removeCreg=function(a){for(var e=this.numCols(),t=[],n=0;n<e;n++)for(var s=0;s<this.numQubits;s++){var r=this.gates[s][n];r&&r.options&&(r.options.creg&&r.options.creg.name&&r.options.creg.name==a&&t.indexOf(r.id)<0&&t.push(r.id),r.options.condition&&r.options.condition.creg&&r.options.condition.creg==a&&delete r.options.condition)}delete this.cregs[a];for(var o=0;o<t.length;o++)this.removeGate(t[o])},g.prototype.renameCreg=function(a,e){for(var t=this.numCols(),n=0;n<t;n++)for(var s=0;s<this.numQubits;s++){var r=this.gates[s][n];r&&r.options&&(r.options.creg&&r.options.creg.name&&r.options.creg.name==a&&(r.options.creg.name=e),r.options.condition&&r.options.condition.creg&&r.options.condition.creg==a&&(r.options.condition.creg=e))}this.cregs[e]=JSON.parse(JSON.stringify(this.cregs[a])),delete this.cregs[a]},g.prototype.minCregSize=function(a){for(var e=0,t=this.numCols(),n=0;n<t;n++)for(var s=0;s<this.numQubits;s++){var r=this.gates[s][n];if(r&&r.options){if(r.options.creg&&r.options.creg.name&&r.options.creg.name==a){var o=parseInt(r.options.creg.bit||0);isNaN(o)&&(o=0),o>e&&(e=o)}if(r.options.condition&&r.options.condition.creg&&r.options.condition.creg==a){var l=Math.floor(Math.log2(r.options.condition.value));l>e&&(e=l)}}}return e+1},g.prototype.resizeCreg=function(a,e){if(!(e<this.minCregSize(a))){for(;this.cregs[a].length<e;)this.cregs[a].push(0);for(;this.cregs[a].length>e;)this.cregs[a].pop()}},g.prototype.getCreg=function(a){return this.cregs[a]},g.prototype.setCregBit=function(a,e,t){var n=parseInt(e);if(isNaN(n))throw'Error: invalid "cbit" argument to "setCregBit" method: expected "integer" got "'+typeof e+'".';for(this.cregs[a]||(this.cregs[a]=[]);n>=this.cregs[a].length;)this.cregs[a].push(0);this.cregs[a][n]=t?1:0},g.prototype.getCregBit=function(a,e){if(!this.cregs[a])throw'Error: "getCregBit": unknown register "'+a+'".';var t=parseInt(e);if(isNaN(t)||t>=this.cregs[a].length)throw'Error: "getCregBit": bit "'+e+'" not found.';return this.cregs[a][t]},g.prototype.cregBase=function(a){if(!this.cregs[a])throw'Error: "getCregBit": unknown register "'+a+'".';var e=0;for(var t in this.cregs){if(t==a)return e;e+=this.cregs[t].length}},g.prototype.cregTotalBits=function(){var a=0;for(var e in this.cregs)a+=this.cregs[e].length;return a},g.prototype.getCregValue=function(a){if(!this.cregs[a])throw'Error: "getCregBit": unknown register "'+a+'".';for(var e=this.cregs[a].length,t=0,n=0;n<e;n++)this.cregs[a][n]&&(t+=v.pow(2,n));return t},g.prototype.measureAll=function(a){if(this.collapsed&&this.collapsed.length==this.numQubits&&!a)return this.collapsed;this.collapsed=[];var e=Math.random();for(var t in this.state){var n=v.round(this.state[t],14);if(n.re||n.im){var s=v.round(v.pow(v.abs(n),2),14);if(e-=s,e<=0){var r=parseInt(t);if(this.reverseBitOrder)for(var o=this.numQubits-1;o>=0;o--)this.collapsed.push(1<<o&r?1:0);else for(var o=0;o<this.numQubits;o++)this.collapsed.push(1<<o&r?1:0);return this.collapsed}}}if(!this.collapsed.length)for(;this.collapsed.length<this.numQubits;)this.collapsed.push(0);return this.collapsed},g.prototype.measureAllMultishot=function(a){a=a||1;for(var e={},t=[],n=0;n<a;n++)t.push(Math.random());var s=0;do for(var r in this.state){var o=v.round(this.state[r],14);if(o.re||o.im){for(var l=v.round(v.pow(v.abs(o),2),14),p=0;p<a;p++)if(t[p]>0&&(t[p]-=l,t[p]<=0)){for(var d=parseInt(r).toString(2);d.length<this.numQubits;)d="0"+d;if(e[d]?e[d]++:e[d]=1,s++,s==a)return e}}}while(s<a)},g.prototype.measure=function(a,e,t,n){(n||!this.collapsed||this.collapsed.length!=this.numQubits)&&this.measureAll(n);var s=this.collapsed[a];return e&&typeof t<"u"&&this.setCregBit(e,t,s),s},g.prototype.probabilities=function(){this.prob=[];for(var a=0;a<this.numQubits;a++)this.prob.push(0);for(var e in this.state)for(var t=parseInt(e),a=0;a<this.numQubits;a++){var n=null;if(this.reverseBitOrder?n=v.pow(2,this.numQubits-1-a):n=v.pow(2,a),t&n){var s=this.state[e];(s.re||s.im)&&(this.prob[a]+=v.pow(v.abs(s),2))}}for(var a=0;a<this.numQubits;a++)this.prob[a]=v.round(this.prob[a],14);return this.prob},g.prototype.probability=function(a){return(!this.prob||this.prob.length!=this.numQubits)&&this.probabilities(),this.prob[a]},g.prototype.densityMatrix=function(){var a=[],e=this.numAmplitudes();for(row=0;row<e;row++){for(var t=[],n=this.state[row]||v.complex(0,0),s=0;s<e;s++){var r=this.state[s]||v.complex(0,0);(r.re||r.im)&&(r=v.conj(r)),t.push(v.multiply(n,r))}a.push(t)}return a},g.prototype.partialTrace=function(a){function e(f,h,c){var u=f<<1,m=(2<<h)-1,q=1<<h,u=u^(u^f)&m|q;return c||(u=u^q),u}var t=[],n=this.numQubits-1,s=v.pow(2,n),r=null;this.reverseBitOrder?r=this.numQubits-1-a:r=a;for(var o=0;o<4;o++){t.push(v.complex(0,0));for(var l=s;l--;){var p=e(l,r,o&2?1:0);if(this.state[p]){var d=e(l,r,o&1?1:0);this.state[d]&&(t[o]=v.add(t[o],v.multiply(this.state[p],v.conj(this.state[d]))))}}}return[[t[0],t[1]],[t[2],t[3]]]},g.prototype.angles=function(){for(var a=[],e=0;e<this.numQubits;e++)a.push({theta:0,phi:0});for(var e=0;e<this.numQubits;e++){var t=this.partialTrace(e),n=v.round(v.sqrt(t[0][0]),12),s=v.round(v.multiply(t[1][0],v.sqrt(2)),12),r=v.round(v.abs(v.sqrt(2*v.abs(v.trace(v.pow(t,2)))-1)),12),o=v.multiply(2,v.acos(n)),l=0;v.round(s.re,8)==0&&v.round(s.im,8)==0||(l=v.multiply(v.complex(0,-1),v.log(v.multiply(s,v.csc(v.divide(o,2))))).re,isNaN(l)&&(l=0)),a[e].theta=v.round(v.abs(o),12),a[e].phi=v.round(l,12),a[e].thetaDeg=v.round(v.multiply(v.abs(o),180/v.pi),7),a[e].phiDeg=v.round(v.multiply(l,180/v.pi),7),a[e].radius=v.round(r,7)}return a},g.prototype.randomCircuit=function(a,e,t){this.init(a),t=t||{};var n=t.useGates&&t.useGates.length?t.useGates:Object.keys(this.basicGates);t.noMeasure&&n.indexOf("measure")>=0&&n.splice(n.indexOf("measure"),1),t.noReset&&n.indexOf("reset")>=0&&n.splice(n.indexOf("reset"),1);for(var s=0;s<e;){var r=n[Math.floor(Math.random()*n.length)],o=this.basicGates[r];if(o){var l=o.matrix&&o.matrix.length?v.log2(o.matrix.length):1;if(l<=a){for(var p=[];p.length<l;){var d=-1;do d=Math.floor(Math.random()*a);while(p.indexOf(d)>=0);p.push(d)}var f={};if(o.params&&o.params.length){var h={};o.params.map(function(m){h[m]=Math.PI*2*Math.random(),h[m]>Math.PI&&(h[m]=Math.PI-h[m])}),f.params=h}if(r=="measure")f.creg={name:"c",bit:p[0]};else if(!t.noClassicControl&&Math.floor(Math.random()*4)==0){var c=this.cregTotalBits();c&&(f.condition={creg:"c",value:Math.floor(Math.random()*v.pow(2,c))})}this.appendGate(r,p,f),s++}}}},g.prototype.randomUnitary=function(a){var e=new g;return e.randomCircuit(a||1,(a||1)*8,{useGates:["rx","rz","cz"],noMeasure:!0,noReset:!0,noClassicControl:!0}),e.circuitMatrix()},g.prototype.eulerAnglesZYZ=function(a){var e={theta:null,phi:null,lambda:null,phase:null},t=v.pow(v.det(a),-.5);e.phase=-1*v.complex(t).toPolar().phi;var n=v.multiply(t,a);e.theta=2*v.atan2(v.abs(n[1][0]),v.abs(n[0][0]));var s=2*v.complex(n[1][1]).toPolar().phi,r=2*v.complex(n[1][0]).toPolar().phi;return e.phi=(s+r)/2,e.lambda=(s-r)/2,e},Lt.exports=g});export default me();
